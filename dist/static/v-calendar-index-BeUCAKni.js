import{_ as j,a as se}from"./v-calendar-week-DsTdJ7Tz.js";import{r as p,x as ae,q as ne,u as le,y as N,b as oe,z as re,o as a,c as l,e as $,w as Z,l as de,d as t,h as u,n as D,F as m,A as h,j as c,B as ce,C as ie,D as _e,E as ue,G as C,f as A}from"./index-4RuHJQwr.js";import{_ as ve}from"./v-modals-container-BGlL2ukJ.js";import{u as me}from"./useIsMobile-mX6yTQnW.js";import"./arrow-right-finance-Dbx55g6C.js";const he="data:image/svg+xml,%3csvg%20width='16'%20height='16'%20viewBox='0%200%2016%2016'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3ccircle%20cx='8'%20cy='8'%20r='8'%20fill='transperent'/%3e%3cpath%20d='M5%207.5H7.5V5H8.5V7.5H11V8.5H8.5V11H7.5V8.5H5V7.5Z'%20fill='%231D4ECC'/%3e%3c/svg%3e",ye="data:image/svg+xml,%3csvg%20width='16'%20height='16'%20viewBox='0%200%2016%2016'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3ccircle%20cx='8'%20cy='8'%20r='8'%20fill='transperent'/%3e%3cpath%20d='M5%207.5H7.5V5H8.5V7.5H11V8.5H8.5V11H7.5V8.5H5V7.5Z'%20fill='%23b5f5bf'/%3e%3c/svg%3e",pe={class:"wrapper"},fe={key:0,class:"v-calendar-month"},ge={class:"container"},ke={class:"v-calendar-month__container layout"},be={key:0,class:"scroll-container"},we={class:"v-calendar-month__content"},Me={key:0,class:"sec-hidden-content showing"},De={class:"calendar-header"},Se={class:"calendar-header__item"},Ve=["onDrop"],$e={class:"calendar-row__item-container"},xe={key:0,class:"calendar-row__item-content calendar-card"},Le={class:"calendar-card__num"},He=["onClick","onDragstart"],Ce={class:"calendar-card__lesson-time"},Be={class:"calendar-card__lesson-name"},Oe={key:0,class:"calendar-card__lesson break"},qe={key:1,class:"loader-container"},Ee={key:1,class:"v-calendar-month-mob mob-page"},Pe={class:"container"},je={class:"v-calendar-month-mob__container layout"},Ne={class:"v-calendar-month-mob__table calendar"},Ze={class:"calendar-header"},Ae={class:"calendar-header__item"},Fe=["onClick"],Ie={key:0,class:"calendar-row__item-content calendar-card"},Re={class:"calendar-card__num"},ze={class:"calendar-card__content"},Te={key:0,class:"calendar-card__lesson break"},We={key:0,class:"v-calendar-month-mob__info lesson-info"},Ye={class:"v-calendar-month-mob__day day"},Ge={class:"day__header"},Je={class:"day__date"},Ue={class:"day__lesson-time"},Ke={class:"day__lesson-name"},Qe={key:0,class:"day__lesson break"},Xe={class:"day__lesson-block"},et={class:"day__lesson-time"},tt={key:0},st={__name:"v-calendar-month",setup(F){const g=p([{days_week:"Пн",id:1},{days_week:"Вт",id:2},{days_week:"Ср",id:3},{days_week:"Чт",id:4},{days_week:"Пт",id:5},{days_week:"Сб",id:6},{days_week:"Вс",id:7}]),L=p(new Date),k=p(L.value.getMonth()+1),S=p(L.value.getFullYear()),B=ae(),O=ne(),o=p({}),b=p(),H=p(),{isMobile:I}=me(),q=le("modalsContainer"),R=n=>{const e=O.query.selected_date;return`${n.toString().padStart(2,"0")}.${e}`},z=n=>{const e=O.query.selected_date;return e&&_e(e,n)},T=n=>{b.value=n},W=(n,e,i,s,_)=>{H.value={lesson:e,fromColumnIndex:s,fromRowIndex:i,fromLessonIndex:_}},Y=(n,e,i)=>{const{lesson:s,fromColumnIndex:_,fromRowIndex:d,fromLessonIndex:r}=H.value;if(_!==e||d!==i)if(!o.value.schedule[i][e])alert("Интерактивным способом вы можете переносить урок только в пределах месяца");else{const f=o.value.schedule[d][_].lessons,y=o.value.schedule[i][e].lessons,w=M=>{const[V,x]=M.split(":").map(Number);return V*60+x},K=w(s.start_time),Q=w(s.end_time);for(let M of y){const V=w(M.start_time);if(!(w(M.end_time)<=K||V>=Q)){alert("В этот день уже есть занятие на данное время");return}}f.splice(r,1),y.push(s),y.sort((M,V)=>{const x=w(M.start_time),te=w(V.start_time);return x-te});const X=String(o.value.schedule[i][e].day),ee={day_of_week_id:e,start_time:s.start_time+":00.001Z",end_time:s.end_time+":00.001Z",conducted_date:`${S.value}-${k.value}-${X.padStart(2,0)}`,in_rule:!1};ue(s.lesson_id,ee).then(()=>{}),H.value=null}},G=n=>{q.value.toggleLessonModals("buttons",n)},J=n=>{B.push({query:{selected_date:`${String(n.month+1).padStart(2,"0")}.${n.year}`}}),k.value=n.month,S.value=n.year,C(n.year,n.month+1).then(e=>{o.value=e})},E=n=>{C(n.year,n.month).then(e=>{o.value=e,b.value=[]})},U=()=>{const n=new URLSearchParams(window.location.search),e=Object.fromEntries(n.entries());"selected_date"in e?(k.value=e.selected_date.split(".")[0],S.value=e.selected_date.split(".")[1]):B.push({query:{selected_date:`${String(k.value).padStart(2,"0")}.${S.value}`}}),C(S.value,parseInt(k.value)).then(i=>{o.value=i})},v=N(()=>{if(b.value&&o.value.schedule){const n=Object.values(o.value.schedule).flatMap(e=>Object.values(e).filter(i=>i.day==b.value));if(console.log(),n)return n[0]}return null}),P=N(()=>{if(o.value&&o.value.schedule){for(let n in o.value.schedule){const e=o.value.schedule[n];for(let i in e)if(e[i].lessons.length)return!1}return!0}return!1});return oe(()=>{U(),localStorage.setItem("activePage","home");const n=new Date;b.value=JSON.parse(n.getDate())||[]}),(n,e)=>{const i=re("router-link");return a(),l("div",pe,[$(ie,null,{default:Z(()=>[de(I)?(a(),l("section",Ee,[t("div",Pe,[t("div",je,[$(j,{type:"home",onPaginateMonth:E}),t("table",Ne,[t("thead",null,[t("tr",Ze,[(a(!0),l(m,null,h(g.value,s=>(a(),l("th",{key:s.id},[t("div",Ae,c(s.days_week),1)]))),128))])]),t("tbody",null,[(a(!0),l(m,null,h(o.value.schedule,(s,_)=>(a(),l("tr",{class:"calendar-row",key:_},[(a(),l(m,null,h(7,d=>{var r;return t("td",{onClick:f=>{var y;return T((y=s[d])==null?void 0:y.day)},key:d},[t("div",{class:D(["calendar-row__item",{active:((r=s[d])==null?void 0:r.day)===b.value}])},[s[d]?(a(),l("div",Ie,[t("div",Re,c(s[d].day),1),t("div",ze,[(a(!0),l(m,null,h(s[d].lessons,f=>(a(),l("div",{class:D(["calendar-card__lesson",{trial:f.trial}]),key:f.lesson_id},null,2))),128)),s[d].breaks&&s[d].breaks[n.lesson.lesson_id]?(a(),l("div",Te)):u("",!0)])])):u("",!0)],2)],8,Fe)}),64))]))),128))])])]),v.value?(a(),l("div",We,[$(i,{to:{name:"calendar-day",query:{date:R(v.value.day)}}},{default:Z(()=>[t("div",Ye,[t("div",Ge,[t("p",Je,c(z(v.value.day)),1),e[3]||(e[3]=t("svg",{class:"opacity-50",width:"20",height:"20",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M4.66663 11.3333L11.3333 4.66663M11.3333 4.66663H4.66663M11.3333 4.66663V11.3333",stroke:"#717680","stroke-width":"1.67","stroke-linecap":"round","stroke-linejoin":"round"})],-1))]),(a(!0),l(m,null,h(v.value.lessons,s=>(a(),l("div",{class:"day__content",key:s.id},[t("div",{class:D(["day__lesson",{trial:s.trial}])},[e[5]||(e[5]=t("h4",{class:"day__lesson-name"}," Петров ",-1)),t("div",Ue,[t("p",null,c(s.start_time),1),e[4]||(e[4]=t("p",null,"-",-1)),t("p",null,c(s.end_time),1)]),t("div",Ke,c(s.student_name),1)],2),v.value.breaks&&v.value.breaks[s.lesson_id]?(a(),l("div",Qe,[t("div",Xe,[e[7]||(e[7]=t("img",{src:he,class:"day-el",alt:""},null,-1)),e[8]||(e[8]=t("img",{src:ye,class:"night-el",alt:""},null,-1)),t("div",et,[t("p",null,c(v.value.breaks[s.lesson_id].start_time),1),e[6]||(e[6]=t("p",null,"-",-1)),t("p",null,c(v.value.breaks[s.lesson_id].end_time),1)])]),e[9]||(e[9]=t("div",{class:"day__lesson-name"},"Перерыв",-1))])):u("",!0)]))),128)),v.value.lessons.length?u("",!0):(a(),l("div",tt,e[10]||(e[10]=[t("h2",{class:"title pb-7"},"В этот день у вас нет уроков",-1)])))])]),_:1},8,["to"])])):u("",!0)])])):(a(),l("section",fe,[t("div",ge,[t("div",ke,[$(j,{type:"home",onSetMonth:J,onPaginateMonth:E}),o.value.schedule&&g.value?(a(),l("div",be,[t("div",we,[P.value?(a(),l("div",Me,e[1]||(e[1]=[t("h1",{class:"text-title"},"Еще не запланировано ни одного занятия!",-1)]))):u("",!0),t("table",{class:D(["v-calendar-month__table calendar",{blur:P.value}])},[t("thead",null,[t("tr",De,[(a(!0),l(m,null,h(g.value,s=>(a(),l("th",{key:s.id},[t("div",Se,c(s.days_week),1)]))),128))])]),t("tbody",null,[(a(!0),l(m,null,h(o.value.schedule,(s,_)=>(a(),l("tr",{class:"calendar-row",key:_},[(a(),l(m,null,h(7,d=>t("td",{class:"calendar-row__item",key:d,onDragover:e[0]||(e[0]=ce(()=>{},["prevent"])),onDrop:r=>Y(r,d,_)},[t("div",$e,[s[d]?(a(),l("div",xe,[t("div",Le,c(s[d].day),1),(a(!0),l(m,null,h(s[d].lessons,(r,f)=>(a(),l("div",{class:D(["calendar-card__content",{completed:r.completed}]),key:r.lesson_id,onClick:()=>G(r),draggable:"true",onDragstart:y=>W(y,r,_,d,f)},[t("div",{class:D(["calendar-card__lesson",{trial:r.trial}])},[t("p",Ce,c(r.start_time)+" - "+c(r.end_time),1),t("p",Be,c(r.student_name||"Артём"),1)],2),o.value.breaks&&o.value.breaks[r.lesson_id]&&o.value.breaks[r.lesson_id].start_time!==o.value.breaks[r.lesson_id].end_time?(a(),l("div",Oe,c(o.value.breaks[r.lesson_id].start_time)+" - "+c(o.value.breaks[r.lesson_id].end_time)+" "+c(r.student_name),1)):u("",!0)],42,He))),128))])):u("",!0)])],40,Ve)),64))]))),128))])],2)])])):(a(),l("div",qe,e[2]||(e[2]=[t("div",{class:"loader"},null,-1)])))])])])),$(ve,{ref_key:"modalsContainer",ref:q},null,512)]),_:1})])}}},at={class:"v-calendar"},ct={__name:"v-calendar-index",setup(F){const g=p(localStorage.getItem("activePage")||"home");return(L,k)=>(a(),l("div",at,[g.value==="home"?(a(),A(st,{key:0})):u("",!0),g.value==="calendar-week"?(a(),A(se,{key:1})):u("",!0)]))}};export{ct as default};

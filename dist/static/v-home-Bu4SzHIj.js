import{r as _,o as l,c as a,d as s,av as j,n as P,e as d,w as g,h as L,T as I,b as x,k as y,F as f,A as C,j as h,aw as X,ax as Y,ay as ss,y as es,R as ts,az as os,aA as ls,i as ns,L as A,Q as E,C as as,f as is,aB as cs,aC as rs,aD as _s,aE as ds,au as us,aF as ms,aG as hs,aH as vs,aI as ps}from"./index-CogWQqZT.js";import{_ as F,a as V,b as z,c as gs,d as ws}from"./v-homework-c7oOZd1k.js";import{_ as fs}from"./cross-CfRcZe3L.js";import"./v-files-handler-C4GihQTY.js";const ks="data:image/svg+xml,%3csvg%20width='20'%20height='20'%20viewBox='0%200%2020%2020'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20clip-path='url(%23clip0_8739_1092)'%3e%3cpath%20d='M15.0754%208.51667L9.24207%2018.0333C9.1276%2018.2183%208.92624%2018.3316%208.70874%2018.3333H8.54207C8.42535%2018.3331%208.31385%2018.2849%208.23374%2018.2C8.15404%2018.1148%208.11461%2017.9995%208.12541%2017.8833L8.59207%2012.5H5.61707C5.39324%2012.4976%205.18731%2012.3772%205.07541%2012.1833L4.91707%2011.9083C4.83754%2011.7778%204.83754%2011.6138%204.91707%2011.4833L10.7504%201.96667C10.868%201.77664%2011.077%201.66264%2011.3004%201.66667H11.4671C11.5838%201.66688%2011.6953%201.7151%2011.7754%201.8C11.8551%201.88523%2011.8945%202.00048%2011.8837%202.11667L11.4087%207.5H14.3837C14.6076%207.50242%2014.8135%207.62281%2014.9254%207.81667L15.0837%208.09167C15.1607%208.22373%2015.1575%208.38773%2015.0754%208.51667Z'%20fill='%23FF3A3A'/%3e%3c/g%3e%3cdefs%3e%3cclipPath%20id='clip0_8739_1092'%3e%3crect%20width='20'%20height='20'%20fill='white'/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e",bs="data:image/svg+xml,%3csvg%20width='20'%20height='20'%20viewBox='0%200%2020%2020'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M15%2012.5L10%207.5L5%2012.5'%20stroke='%23717680'%20stroke-width='1.66667'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",Cs={class:"home-right-sec"},ys={class:"subtitle"},$s={key:0,class:"home-right-sec__container"},M={__name:"v-home-right-sec-base",setup(k){const o=_(!0),u=()=>{o.value=!o.value};return(c,i)=>(l(),a("div",Cs,[s("div",{class:P(["home-right-sec__header",{clicked:!o.value}]),onClick:u},[s("h2",ys,[j(c.$slots,"title")]),s("img",{class:P({"rotate-180":!o.value}),src:bs,alt:""},null,2)],2),d(I,{name:"slide-fade"},{default:g(()=>[o.value?(l(),a("div",$s,[j(c.$slots,"container")])):L("",!0)]),_:3})]))}},Ls={class:"v-home-tasks"},xs={class:"v-home-tasks__list"},Ts={class:"task__title"},Ps=["onClick"],Fs={__name:"v-home-tasks",setup(k){const o=_([]),u=_(null),c=r=>{if(console.log(r),r){const m={title:r};o.value.push(m),u.value="",X(m)}},i=async()=>{const r=await Y();o.value=r||[]},v=r=>{o.value=o.value.filter(m=>m.id!==r)};return x(()=>{i()}),(r,m)=>(l(),a("div",Ls,[d(M,null,{title:g(()=>m[0]||(m[0]=[y(" Актуальные задачи ")])),container:g(()=>[s("ul",xs,[(l(!0),a(f,null,C(o.value,p=>(l(),a("li",{class:"v-home-tasks__list-item task",key:p.id},[s("h3",Ts,h(p.title),1),s("div",{onClick:()=>v(p.id),class:"task__close"},m[1]||(m[1]=[s("img",{src:fs,alt:""},null,-1)]),8,Ps)]))),128))]),d(F,{placeholder:"Тема занятий",onSubmit:c})]),_:1})]))}},Ms={class:"v-home-schedule"},Bs={class:"caption"},Ss={class:"v-home-schedule__list"},Hs={__name:"v-home-schedule",setup(k){const o=_([]),u=async()=>{const c=await ss();o.value=c||[]};return x(()=>{u()}),(c,i)=>(l(),a("div",Ms,[d(M,null,{title:g(()=>i[0]||(i[0]=[y("Расписание занятий")])),container:g(()=>[i[2]||(i[2]=s("div",{class:"v-home-schedule__progress progress-bar"},[s("div",{class:"progress-bar__completed",style:{width:"50%"}})],-1)),s("p",Bs,h(o.value.completed_lessons)+"/"+h(o.value.total_lessons)+" занятий проведены ",1),s("ul",Ss,[(l(!0),a(f,null,C(o.value.lessons,v=>(l(),a("li",{class:P([{completed:v.status==="completed"},"v-home-schedule-list-item schedule-item"]),key:v.id},i[1]||(i[1]=[s("div",{class:"flex gap-2"},[s("div",{class:"schedule-item__img"},[s("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none"},[s("path",{d:"M16.3999 17.2001V15.6C16.3999 14.7514 16.0627 13.9374 15.4626 13.3373C14.8625 12.7372 14.0485 12.4 13.1999 12.4H6.79985C5.95116 12.4 5.13723 12.7372 4.53711 13.3373C3.937 13.9374 3.59985 14.7514 3.59985 15.6V17.2001M13.1999 6.00005C13.1999 7.76736 11.7672 9.20005 9.99985 9.20005C8.23254 9.20005 6.79985 7.76736 6.79985 6.00005C6.79985 4.23274 8.23254 2.80005 9.99985 2.80005C11.7672 2.80005 13.1999 4.23274 13.1999 6.00005Z",stroke:"#717680","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})])]),s("h3",{class:"schedule-item__description"},"Дарья / 3000р")],-1),s("h3",{class:"schedule-item__description"},"18:00",-1)]),2))),128))])]),_:1})]))}},Ds={class:"v-home-earnings"},js={class:"v-home-earnings__progress progress-bar"},As={class:"caption"},Es={__name:"v-home-earnings",setup(k){const o=_({}),u=es(()=>parseFloat(o.value.actual_earning)?`${o.value.actual_earning/parseInt(o.value.potential_earning)*100}%`:0),c=async()=>{o.value=await os()};return x(()=>{c()}),(i,v)=>(l(),a("div",Ds,[d(M,null,{title:g(()=>v[0]||(v[0]=[y("Заработок за день")])),container:g(()=>[s("div",js,[s("div",{class:"progress-bar__completed",style:ts({width:u.value})},null,4)]),s("div",As,h(o.value.actual_earning)+"р/"+h(o.value.potential_earning)+"р заработано ",1)]),_:1})]))}},Vs={class:"v-home-right"},zs={class:"v-home-right__container"},Is={class:"v-home-right__block"},Ns={__name:"v-home-right",setup(k){return(o,u)=>(l(),a("div",Vs,[s("div",zs,[s("div",Is,[d(Hs),d(Es)]),d(Fs)])]))}},Us={class:"v-home"},Ws={class:"container"},Ks={class:"loader-container"},Os={key:0,class:"v-home__container layout"},Zs={class:"v-home__left"},Gs={class:"v-home__lesson"},Qs={class:"v-home__lesson-info"},Rs={class:"v-home__lesson-title"},qs={class:"v-home__lesson-time"},Js={class:"v-home__lesson-container"},Xs={class:"v-home__lesson-block"},Ys={key:0,class:"v-home__lesson-problems v-home__lesson-sec"},se={class:"v-home__lesson-problems-list"},ee={class:"v-home__lesson-themes v-home__lesson-sec"},te={class:"v-home__lesson-themes-list"},oe=["data-theme-id"],le={class:"theme__title"},ne=["onClick"],ae={class:"v-home__lesson-current-problems v-home__lesson-sec"},ie={class:"v-home__lesson-themes-list"},ce={class:"theme__title"},re=["onClick"],_e={class:"layout"},ve={__name:"v-home",setup(k){const o=_([]),u=_(null),c=_([]),i=_([]),v=_(null),r=_(),m=_(!1);let p=null;const $=_([]),w=_(null),b=_(!1),B=_({files:!1}),S=()=>{const e=window.innerHeight;window.addEventListener("resize",()=>{m.value=window.innerHeight<e})},H=()=>{B.value.files=!1},N=async e=>{i.value=i.value.filter(t=>t.id!==e),await cs(e)},U=async e=>{c.value=c.value.filter(t=>t.id!==e),await rs(e)},W=async e=>{if(e){const t=c.value.length>0?Math.max(...c.value.map(T=>T.id)):0;c.value.push({id:t+1,name:e});const n={lesson_id:w.value,name:e};await _s(n),v.value=""}},K=async e=>{if(e){console.log(e);const t=i.value.length>0?Math.max(...i.value.map(T=>T.id)):0;i.value.push({id:t+1,problem_text:e});const n={lesson_id:w.value,problems:[e]};await ds(n)}},O=e=>{o.value=[...e],u.value.internalFiles=e,us(()=>{var t,n;(n=(t=u.value)==null?void 0:t.$forceUpdate)==null||n.call(t)}),H()},Z=async()=>{const e=await ms();if(e.permanent_lessons.length){const[t,n]=Object.entries(e.permanent_lessons[0])[0];r.value=n,w.value=t}else r.value=null;console.log(e)},G=async()=>{const e=await hs(w.value);$.value=e},Q=async()=>{const e=await vs(w.value);i.value=e||[]},R=async()=>{const e=await ps(w.value);c.value=e||[]},q=async()=>{b.value=!0,await Z(),w.value&&await Promise.all([Q(),R(),G()]),b.value=!1};function D(){p=new WebSocket("wss://test-api.teacherplanner.ru/ws/lesson_notifications/"),p.onmessage=e=>{e.data!=="ping"&&console.log("Новое сообщение:",e.data)},p.onclose=()=>{console.log("Соединение закрыто, переподключение..."),setTimeout(D,1e3)},p.onerror=e=>{console.log("Ошибка сокета:",e),p.close()}}const J=()=>{D()};return x(()=>{S(),q(),J()}),ls(()=>{window.removeEventListener("resize",S)}),ns(()=>{}),(e,t)=>(l(),a(f,null,[d(as,null,{default:g(()=>[s("section",Us,[s("div",Ws,[A(s("div",Ks,t[0]||(t[0]=[s("div",{class:"loader"},null,-1)]),512),[[E,b.value]]),r.value&&!b.value?(l(),a("div",Os,[s("div",Zs,[s("div",Gs,[s("div",Qs,[s("h1",Rs,[t[1]||(t[1]=y(" Текущее занятие: ")),s("span",null,[y(h(r.value.student_name)+" ",1),s("span",qs,h(r.value.start_time)+" - "+h(r.value.end_time),1)])]),t[2]||(t[2]=s("div",{class:"flex gap-3"},[s("img",{class:"rotate-180 day-el",src:V,alt:""}),s("img",{class:"rotate-180 night-el",src:z,alt:""}),s("img",{class:"day-el",src:V,alt:""}),s("img",{class:"night-el",src:z,alt:""})],-1))]),s("div",Js,[s("div",Xs,[$.value&&$.value.length?(l(),a("div",Ys,[t[4]||(t[4]=s("h2",{class:"v-home__subtitle subtitle"},"Проблемы прошлого занятия",-1)),s("ul",se,[(l(!0),a(f,null,C($.value,n=>(l(),a("li",{class:"v-home__lesson-problems-list-item problem",key:n.id},t[3]||(t[3]=[s("div",{class:"problem__close"},[s("img",{src:ks,alt:""})],-1),s("span",{class:"problem__title"}," Не выполненно домашнее задание прошлого занятия ",-1)])))),128))])])):L("",!0),s("div",ee,[t[6]||(t[6]=s("h2",{class:"v-home__subtitle subtitle"},"Темы текущего занятия",-1)),s("ul",te,[(l(!0),a(f,null,C(c.value,n=>(l(),a("li",{class:"v-home__lesson-themes-list-item theme","data-theme-id":n.id,key:n.id},[s("span",le,h(n.name),1),s("div",{class:"theme__close",onClick:()=>U(n.id)},t[5]||(t[5]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 12 12",fill:"none"},[s("path",{d:"M9 3L3 9M3 3L9 9",stroke:"#1D4ECC","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"})],-1)]),8,ne)],8,oe))),128))]),d(F,{placeholder:"Тема занятия",onSubmit:W})])]),s("div",ae,[t[8]||(t[8]=s("h2",{class:"v-home__subtitle subtitle"},"Проблемы текущего занятия",-1)),s("ul",ie,[(l(!0),a(f,null,C(i.value,n=>(l(),a("li",{class:"v-home__lesson-themes-list-item theme",key:n.id},[s("span",ce,h(n.problem_text),1),s("div",{class:"theme__close",onClick:()=>N(n.id)},t[7]||(t[7]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 12 12",fill:"none"},[s("path",{d:"M9 3L3 9M3 3L9 9",stroke:"#FF3A3A","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"})],-1)]),8,re)]))),128))]),d(F,{onSubmit:K,placeholder:"Проблема"})]),d(gs)])])]),d(Ns)])):L("",!0),A(s("div",_e,t[9]||(t[9]=[s("div",{class:"null-screen"},[s("h1",null,"Ещё не добавлено ни одного занятия")],-1)]),512),[[E,!r.value&&!b.value]])])])]),_:1}),d(I,{name:"fade"},{default:g(()=>[B.value.files?(l(),is(ws,{key:0,onClose:H,onSaveFiles:O})):L("",!0)]),_:1})],64))}};export{ve as default};

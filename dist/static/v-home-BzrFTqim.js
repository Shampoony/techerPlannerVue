import{r as _,o as l,c as i,d as s,aA as A,n as M,e as d,w as g,h as L,T as I,b as x,k as y,F as f,A as C,j as p,aB as ss,aC as es,y as W,X as K,aD as ts,aE as os,aF as ls,i as ns,Q as E,W as N,C as as,f as is,aG as cs,aH as rs,aI as _s,aJ as ds,az as us,aK as hs,aL as ms,aM as vs,aN as ps}from"./index-BBvMqIIN.js";import{_ as P,a as V,b as z,c as gs,d as ws}from"./v-homework-dQl0BVJS.js";import{_ as fs}from"./cross-CfRcZe3L.js";import"./v-files-handler-CjmgChRI.js";const ks="data:image/svg+xml,%3csvg%20width='20'%20height='20'%20viewBox='0%200%2020%2020'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20clip-path='url(%23clip0_8739_1092)'%3e%3cpath%20d='M15.0754%208.51667L9.24207%2018.0333C9.1276%2018.2183%208.92624%2018.3316%208.70874%2018.3333H8.54207C8.42535%2018.3331%208.31385%2018.2849%208.23374%2018.2C8.15404%2018.1148%208.11461%2017.9995%208.12541%2017.8833L8.59207%2012.5H5.61707C5.39324%2012.4976%205.18731%2012.3772%205.07541%2012.1833L4.91707%2011.9083C4.83754%2011.7778%204.83754%2011.6138%204.91707%2011.4833L10.7504%201.96667C10.868%201.77664%2011.077%201.66264%2011.3004%201.66667H11.4671C11.5838%201.66688%2011.6953%201.7151%2011.7754%201.8C11.8551%201.88523%2011.8945%202.00048%2011.8837%202.11667L11.4087%207.5H14.3837C14.6076%207.50242%2014.8135%207.62281%2014.9254%207.81667L15.0837%208.09167C15.1607%208.22373%2015.1575%208.38773%2015.0754%208.51667Z'%20fill='%23FF3A3A'/%3e%3c/g%3e%3cdefs%3e%3cclipPath%20id='clip0_8739_1092'%3e%3crect%20width='20'%20height='20'%20fill='white'/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e",bs="data:image/svg+xml,%3csvg%20width='20'%20height='20'%20viewBox='0%200%2020%2020'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M15%2012.5L10%207.5L5%2012.5'%20stroke='%23717680'%20stroke-width='1.66667'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",Cs={class:"home-right-sec"},ys={class:"subtitle"},$s={key:0,class:"home-right-sec__container"},F={__name:"v-home-right-sec-base",setup(k){const o=_(!0),u=()=>{o.value=!o.value};return(r,c)=>(l(),i("div",Cs,[s("div",{class:M(["home-right-sec__header",{clicked:!o.value}]),onClick:u},[s("h2",ys,[A(r.$slots,"title")]),s("img",{class:M({"rotate-180":!o.value}),src:bs,alt:""},null,2)],2),d(I,{name:"fade"},{default:g(()=>[o.value?(l(),i("div",$s,[A(r.$slots,"container")])):L("",!0)]),_:3})]))}},Ls={class:"v-home-tasks"},xs={class:"v-home-tasks__list"},Ts={class:"task__title"},Ms=["onClick"],Ps={__name:"v-home-tasks",setup(k){const o=_([]),u=_(null),r=n=>{if(n){const m={title:n};o.value.push(m),u.value="",ss(m)}},c=async()=>{const n=await es();console.log(n),o.value=n||[]},h=n=>{o.value=o.value.filter(m=>m.id!==n)};return x(()=>{c()}),(n,m)=>(l(),i("div",Ls,[d(F,null,{title:g(()=>m[0]||(m[0]=[y(" Актуальные задачи ")])),container:g(()=>[s("ul",xs,[(l(!0),i(f,null,C(o.value,v=>(l(),i("li",{class:"v-home-tasks__list-item task",key:v.id},[s("h3",Ts,p(v.title),1),s("div",{onClick:()=>h(v.id),class:"task__close"},m[1]||(m[1]=[s("img",{src:fs,alt:""},null,-1)]),8,Ms)]))),128))]),d(P,{placeholder:"Тема занятий",onSubmit:r})]),_:1})]))}},Fs={class:"v-home-schedule"},Bs={class:"v-home-schedule__progress progress-bar"},Ss={class:"caption"},Hs={class:"v-home-schedule__list"},Ds={__name:"v-home-schedule",setup(k){const o=_([]),u=async()=>{const c=await ts();o.value=c||[]},r=W(()=>{const c=Math.floor(o.value.completed_lessons/o.value.total_lessons)*100;return c?`${c}%`:"0%"});return x(()=>{u()}),(c,h)=>(l(),i("div",Fs,[d(F,null,{title:g(()=>h[0]||(h[0]=[y("Расписание занятий")])),container:g(()=>[s("div",Bs,[s("div",{class:"progress-bar__completed",style:K({width:r.value})},null,4)]),s("p",Ss,p(o.value.completed_lessons)+"/"+p(o.value.total_lessons)+" занятий проведены ",1),s("ul",Hs,[(l(!0),i(f,null,C(o.value.lessons,n=>(l(),i("li",{class:M([{completed:n.status==="completed"},"v-home-schedule-list-item schedule-item"]),key:n.id},h[1]||(h[1]=[s("div",{class:"flex gap-2"},[s("div",{class:"schedule-item__img"},[s("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none"},[s("path",{d:"M16.3999 17.2001V15.6C16.3999 14.7514 16.0627 13.9374 15.4626 13.3373C14.8625 12.7372 14.0485 12.4 13.1999 12.4H6.79985C5.95116 12.4 5.13723 12.7372 4.53711 13.3373C3.937 13.9374 3.59985 14.7514 3.59985 15.6V17.2001M13.1999 6.00005C13.1999 7.76736 11.7672 9.20005 9.99985 9.20005C8.23254 9.20005 6.79985 7.76736 6.79985 6.00005C6.79985 4.23274 8.23254 2.80005 9.99985 2.80005C11.7672 2.80005 13.1999 4.23274 13.1999 6.00005Z",stroke:"#717680","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})])]),s("h3",{class:"schedule-item__description"},"Дарья / 3000р")],-1),s("h3",{class:"schedule-item__description"},"18:00",-1)]),2))),128))])]),_:1})]))}},js={class:"v-home-earnings"},As={class:"v-home-earnings__progress progress-bar"},Es={class:"caption"},Ns={__name:"v-home-earnings",setup(k){const o=_({}),u=W(()=>parseFloat(o.value.actual_earning)?`${o.value.actual_earning/parseInt(o.value.potential_earning)*100}%`:0),r=async()=>{o.value=await os()};return x(()=>{r()}),(c,h)=>(l(),i("div",js,[d(F,null,{title:g(()=>h[0]||(h[0]=[y("Заработок за день")])),container:g(()=>[s("div",As,[s("div",{class:"progress-bar__completed",style:K({width:u.value})},null,4)]),s("div",Es,p(o.value.actual_earning)+"р/"+p(o.value.potential_earning)+"р заработано ",1)]),_:1})]))}},Vs={class:"v-home-right"},zs={class:"v-home-right__container"},Is={class:"v-home-right__block"},Ws={__name:"v-home-right",setup(k){return(o,u)=>(l(),i("div",Vs,[s("div",zs,[s("div",Is,[d(Ds),d(Ns)]),d(Ps)])]))}},Ks={class:"v-home"},Us={class:"container"},Os={class:"loader-container"},Zs={key:0,class:"v-home__container layout"},Gs={class:"v-home__left"},Js={class:"v-home__lesson"},Qs={class:"v-home__lesson-info"},Xs={class:"v-home__lesson-title"},qs={class:"v-home__lesson-time"},Rs={class:"v-home__lesson-container"},Ys={class:"v-home__lesson-block"},se={key:0,class:"v-home__lesson-problems v-home__lesson-sec"},ee={class:"v-home__lesson-problems-list"},te={class:"v-home__lesson-themes v-home__lesson-sec"},oe={class:"v-home__lesson-themes-list"},le=["data-theme-id"],ne={class:"theme__title"},ae=["onClick"],ie={class:"v-home__lesson-current-problems v-home__lesson-sec"},ce={class:"v-home__lesson-themes-list"},re={class:"theme__title"},_e=["onClick"],de={class:"layout"},pe={__name:"v-home",setup(k){const o=_([]),u=_(null),r=_([]),c=_([]),h=_(null),n=_(),m=_(!1);let v=null;const $=_([]),w=_(null),b=_(!1),B=_({files:!1}),S=()=>{const e=window.innerHeight;window.addEventListener("resize",()=>{m.value=window.innerHeight<e})},H=()=>{B.value.files=!1},U=async e=>{c.value=c.value.filter(t=>t.id!==e),await cs(e)},O=async e=>{r.value=r.value.filter(t=>t.id!==e),await rs(e)},Z=async e=>{if(e){const t=r.value.length>0?Math.max(...r.value.map(T=>T.id)):0;r.value.push({id:t+1,name:e});const a={lesson_id:w.value,name:e};await _s(a),h.value=""}},G=async e=>{if(e){console.log(e);const t=c.value.length>0?Math.max(...c.value.map(T=>T.id)):0;c.value.push({id:t+1,problem_text:e});const a={lesson_id:w.value,problems:[e]};await ds(a)}},J=e=>{o.value=[...e],u.value.internalFiles=e,us(()=>{var t,a;(a=(t=u.value)==null?void 0:t.$forceUpdate)==null||a.call(t)}),H()},Q=async()=>{const e=await hs();if(e.permanent_lessons.length){const[t,a]=Object.entries(e.permanent_lessons[0])[0];n.value=a,w.value=t}else n.value=null;console.log(e)},X=async()=>{const e=await ms(w.value);$.value=e},q=async()=>{const e=await vs(w.value);c.value=e||[]},R=async()=>{const e=await ps(w.value);r.value=e||[]},D=async()=>{console.log("Зашли в функцию"),b.value=!0,await Q(),console.log("загрузили уроки"),w.value&&await Promise.all([q(),R(),X()]),b.value=!1};function j(){v=new WebSocket("wss://test-api.teacherplanner.ru/ws/lesson_notifications/"),v.onmessage=e=>{e.data!=="ping"&&console.log("Новое сообщение:",e.data),(e.data.includes("lesson_started")||e.data.includes("lesson_ended"))&&D()},v.onopen=()=>{console.log("Подключились к вебсокету")},v.onclose=()=>{console.log("Соединение закрыто, переподключение..."),setTimeout(j,1e3)},v.onerror=e=>{console.log("Ошибка сокета:",e),v.close()}}const Y=()=>{j()};return x(()=>{S(),D(),Y()}),ls(()=>{window.removeEventListener("resize",S)}),ns(()=>{}),(e,t)=>(l(),i(f,null,[d(as,null,{default:g(()=>[s("section",Ks,[s("div",Us,[E(s("div",Os,t[0]||(t[0]=[s("div",{class:"loader"},null,-1)]),512),[[N,b.value]]),n.value&&!b.value?(l(),i("div",Zs,[s("div",Gs,[s("div",Js,[s("div",Qs,[s("h1",Xs,[t[1]||(t[1]=y(" Текущее занятие: ")),s("span",null,[y(p(n.value.student_name)+" ",1),s("span",qs,p(n.value.start_time)+" - "+p(n.value.end_time),1)])]),t[2]||(t[2]=s("div",{class:"flex gap-3"},[s("img",{class:"rotate-180 day-el",src:V,alt:""}),s("img",{class:"rotate-180 night-el",src:z,alt:""}),s("img",{class:"day-el",src:V,alt:""}),s("img",{class:"night-el",src:z,alt:""})],-1))]),s("div",Rs,[s("div",Ys,[$.value&&$.value.length?(l(),i("div",se,[t[4]||(t[4]=s("h2",{class:"v-home__subtitle subtitle"},"Проблемы прошлого занятия",-1)),s("ul",ee,[(l(!0),i(f,null,C($.value,a=>(l(),i("li",{class:"v-home__lesson-problems-list-item problem",key:a.id},t[3]||(t[3]=[s("div",{class:"problem__close"},[s("img",{src:ks,alt:""})],-1),s("span",{class:"problem__title"}," Не выполненно домашнее задание прошлого занятия ",-1)])))),128))])])):L("",!0),s("div",te,[t[6]||(t[6]=s("h2",{class:"v-home__subtitle subtitle"},"Темы текущего занятия",-1)),s("ul",oe,[(l(!0),i(f,null,C(r.value,a=>(l(),i("li",{class:"v-home__lesson-themes-list-item theme","data-theme-id":a.id,key:a.id},[s("span",ne,p(a.name),1),s("div",{class:"theme__close",onClick:()=>O(a.id)},t[5]||(t[5]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 12 12",fill:"none"},[s("path",{d:"M9 3L3 9M3 3L9 9",stroke:"#1D4ECC","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"})],-1)]),8,ae)],8,le))),128))]),d(P,{placeholder:"Тема занятия",onSubmit:Z})])]),s("div",ie,[t[8]||(t[8]=s("h2",{class:"v-home__subtitle subtitle"},"Проблемы текущего занятия",-1)),s("ul",ce,[(l(!0),i(f,null,C(c.value,a=>(l(),i("li",{class:"v-home__lesson-themes-list-item theme",key:a.id},[s("span",re,p(a.problem_text),1),s("div",{class:"theme__close",onClick:()=>U(a.id)},t[7]||(t[7]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 12 12",fill:"none"},[s("path",{d:"M9 3L3 9M3 3L9 9",stroke:"#FF3A3A","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"})],-1)]),8,_e)]))),128))]),d(P,{onSubmit:G,placeholder:"Проблема"})]),d(gs)])])]),d(Ws)])):L("",!0),E(s("div",de,t[9]||(t[9]=[s("div",{class:"null-screen"},[s("h1",null,"Ещё не добавлено ни одного занятия")],-1)]),512),[[N,!n.value&&!b.value]])])])]),_:1}),d(I,{name:"fade"},{default:g(()=>[B.value.files?(l(),is(ws,{key:0,onClose:H,onSaveFiles:J})):L("",!0)]),_:1})],64))}};export{pe as default};

import{_ as F,a as ee,b as te,c as se}from"./v-calendar-week-BFWZS0Ij.js";import{r as p,k as ae,j as ne,u as le,l as I,o as oe,m as re,b as a,c as n,e as M,d as t,i as de,h as u,n as $,F as v,p as h,t as c,q as ce,w as ie,g as R}from"./index-C1EUZadC.js";import{_ as _e,a as ue,b as me,c as ve}from"./v-modals-container-CSCT5CD1.js";import{v as he}from"./v-footer-6uYwgdfh.js";import{u as ye}from"./useIsMobile-w5W-TQcH.js";import{a as pe,b as O}from"./v-lesson-modal-Dz1-hITs.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ke={class:"wrapper"},fe={key:0,class:"v-calendar-month"},ge={class:"v-calendar-month__container container"},be={key:0,class:"v-calendar-month__content scroll-container"},we={key:0,class:"sec-hidden-content showing"},Se={class:"calendar-header"},Me=["onDrop"],$e={class:"calendar-row__item-container"},Le={key:0,class:"calendar-row__item-content calendar-card"},De={class:"calendar-card__num"},Ce=["onClick","onDragstart"],qe={key:0,class:"calendar-card__lesson break"},Be={key:1,class:"loader-container"},Oe={key:1,class:"v-calendar-month-mob mob-page"},Pe={class:"container"},Ee={class:"v-calendar-month-mob__container"},xe={class:"v-calendar-month-mob__table calendar"},Ne={class:"calendar-header"},je=["onClick"],Fe={key:0,class:"calendar-row__item-content calendar-card"},Ie={class:"calendar-card__num"},Re={class:"calendar-card__content"},Ve={key:0,class:"calendar-card__lesson break"},Ae={key:0,class:"v-calendar-month-mob__info lesson-info"},Te={class:"v-calendar-month-mob__day day"},Ye={class:"day__header"},Ze={class:"day__date"},ze={class:"day__lesson"},Je={class:"day__lesson-name"},Ue={key:0,class:"day__lesson break"},We={class:"day__lesson-block"},Ge={class:"day__lesson-time"},He={key:0},Ke={__name:"v-calendar-month",setup(V){const f=p([{days_week:"Пн",id:1},{days_week:"Вт",id:2},{days_week:"Ср",id:3},{days_week:"Чт",id:4},{days_week:"Пт",id:5},{days_week:"Сб",id:6},{days_week:"Вс",id:7}]),q=p(new Date),g=p(q.value.getMonth()+1),L=p(q.value.getFullYear()),P=ae(),A=ne(),o=p({}),b=p(),B=p(),{isMobile:T}=ye(),E=le("modalsContainer"),x=l=>{const e=A.query.selected_date;return`${String(l).padStart(2,0)}.${e}`},Y=l=>{b.value=l},Z=(l,e,i,s,_)=>{B.value={lesson:e,fromColumnIndex:s,fromRowIndex:i,fromLessonIndex:_}},z=(l,e,i)=>{const{lesson:s,fromColumnIndex:_,fromRowIndex:d,fromLessonIndex:r}=B.value;if(_!==e||d!==i)if(!o.value.schedule[i][e])alert("Интерактивным способом вы можете переносить урок только в пределах месяца");else{const k=o.value.schedule[d][_].lessons,y=o.value.schedule[i][e].lessons,w=S=>{const[D,C]=S.split(":").map(Number);return D*60+C},G=w(s.start_time),H=w(s.end_time);for(let S of y){const D=w(S.start_time);if(!(w(S.end_time)<=G||D>=H)){alert("В этот день уже есть занятие на данное время");return}}k.splice(r,1),y.push(s),y.sort((S,D)=>{const C=w(S.start_time),X=w(D.start_time);return C-X});const K=String(o.value.schedule[i][e].day),Q={day_of_week_id:e,start_time:s.start_time+":00.001Z",end_time:s.end_time+":00.001Z",conducted_date:`${L.value}-${g.value}-${K.padStart(2,0)}`,in_rule:!1};pe(s.lesson_id,Q).then(()=>{}),B.value=null}},J=l=>{E.value.toggleLessonModals("buttons",l)},U=l=>{P.push({query:{selected_date:`${String(l.month+1).padStart(2,"0")}.${l.year}`}}),g.value=l.month,L.value=l.year,O(l.year,l.month+1).then(e=>{o.value=e})},N=l=>{O(l.year,l.month).then(e=>{o.value=e,b.value=[]})},W=()=>{const l=new URLSearchParams(window.location.search),e=Object.fromEntries(l.entries());"selected_date"in e?(g.value=e.selected_date.split(".")[0],L.value=e.selected_date.split(".")[1]):P.push({query:{selected_date:`${String(g.value).padStart(2,"0")}.${L.value}`}}),O(L.value,parseInt(g.value)).then(i=>{o.value=i})},m=I(()=>{if(b.value&&o.value.schedule){const l=Object.values(o.value.schedule).flatMap(e=>Object.values(e).filter(i=>i.day==b.value));if(console.log(),l)return l[0]}return null}),j=I(()=>{if(o.value&&o.value.schedule){for(let l in o.value.schedule){const e=o.value.schedule[l];for(let i in e)if(e[i].lessons.length)return!1}return!0}return!1});return oe(()=>{W(),localStorage.setItem("upd",1),localStorage.setItem("activePage","month");const l=new Date;b.value=JSON.parse(l.getDate())||[]}),(l,e)=>{const i=re("router-link");return a(),n("div",ke,[M(_e),t("main",null,[de(T)?(a(),n("section",Oe,[t("div",Pe,[t("div",Ee,[M(F,{type:"month",onPaginateMonth:N}),t("table",xe,[t("thead",null,[t("tr",Ne,[(a(!0),n(v,null,h(f.value,s=>(a(),n("th",{class:"calendar-header__item",key:s.id},c(s.days_week),1))),128))])]),t("tbody",null,[(a(!0),n(v,null,h(o.value.schedule,(s,_)=>(a(),n("tr",{class:"calendar-row",key:_},[(a(),n(v,null,h(7,d=>{var r;return t("td",{class:$(["calendar-row__item",{active:((r=s[d])==null?void 0:r.day)===b.value}]),onClick:k=>{var y;return Y((y=s[d])==null?void 0:y.day)},key:d},[s[d]?(a(),n("div",Fe,[t("div",Ie,c(s[d].day),1),t("div",Re,[(a(!0),n(v,null,h(s[d].lessons,k=>(a(),n("div",{class:$(["calendar-card__lesson",{trial:k.trial}]),key:k.lesson_id},null,2))),128)),s[d].breaks&&s[d].breaks[l.lesson.lesson_id]?(a(),n("div",Ve)):u("",!0)])])):u("",!0)],10,je)}),64))]))),128))])])]),m.value?(a(),n("div",Ae,[M(i,{to:{name:"calendar-day",query:{date:x(m.value.day)}}},{default:ie(()=>[t("div",Te,[t("div",Ye,[t("p",Ze,c(x(m.value.day)),1),e[3]||(e[3]=t("img",{src:ue,class:"day-el",alt:""},null,-1)),e[4]||(e[4]=t("img",{src:me,class:"night-el",alt:""},null,-1))]),(a(!0),n(v,null,h(m.value.lessons,s=>(a(),n("div",{class:"day__content",key:s.id},[t("div",ze,[t("div",{class:$(["day__lesson-time",{trial:s.trial}])},[e[5]||(e[5]=t("div",{class:"day__lesson-circle"},null,-1)),t("p",null,c(s.start_time),1),e[6]||(e[6]=t("p",null,"-",-1)),t("p",null,c(s.end_time),1)],2),t("div",Je,c(s.student_name),1)]),m.value.breaks&&m.value.breaks[s.lesson_id]?(a(),n("div",Ue,[t("div",We,[e[8]||(e[8]=t("img",{src:ee,class:"day-el",alt:""},null,-1)),e[9]||(e[9]=t("img",{src:te,class:"night-el",alt:""},null,-1)),t("div",Ge,[t("p",null,c(m.value.breaks[s.lesson_id].start_time),1),e[7]||(e[7]=t("p",null,"-",-1)),t("p",null,c(m.value.breaks[s.lesson_id].end_time),1)])]),e[10]||(e[10]=t("div",{class:"day__lesson-name"},"Перерыв",-1))])):u("",!0)]))),128)),m.value.lessons.length?u("",!0):(a(),n("div",He,e[11]||(e[11]=[t("h2",{class:"title pb-7"},"В этот день у вас нет уроков",-1)])))])]),_:1},8,["to"])])):u("",!0)])])):(a(),n("section",fe,[t("div",ge,[M(F,{type:"month",onSetMonth:U,onPaginateMonth:N}),o.value.schedule&&f.value?(a(),n("div",be,[j.value?(a(),n("div",we,e[1]||(e[1]=[t("h1",{class:"text-title text-blue"},"Еще не запланировано ни одного занятия!",-1)]))):u("",!0),t("table",{class:$(["v-calendar-month__table calendar",{blur:j.value}])},[t("thead",null,[t("tr",Se,[(a(!0),n(v,null,h(f.value,s=>(a(),n("th",{class:"calendar-header__item",key:s.id},c(s.days_week),1))),128))])]),t("tbody",null,[(a(!0),n(v,null,h(o.value.schedule,(s,_)=>(a(),n("tr",{class:"calendar-row",key:_},[(a(),n(v,null,h(7,d=>t("td",{class:"calendar-row__item",key:d,onDragover:e[0]||(e[0]=ce(()=>{},["prevent"])),onDrop:r=>z(r,d,_)},[t("div",$e,[s[d]?(a(),n("div",Le,[t("div",De,c(s[d].day),1),(a(!0),n(v,null,h(s[d].lessons,(r,k)=>(a(),n("div",{class:$(["calendar-card__content",{completed:r.completed}]),key:r.lesson_id,onClick:()=>J(r),draggable:"true",onDragstart:y=>Z(y,r,_,d,k)},[t("div",{class:$(["calendar-card__lesson",{trial:r.trial}])},c(r.start_time)+" - "+c(r.end_time)+" "+c(r.student_name),3),o.value.breaks&&o.value.breaks[r.lesson_id]&&o.value.breaks[r.lesson_id].start_time!==o.value.breaks[r.lesson_id].end_time?(a(),n("div",qe,c(o.value.breaks[r.lesson_id].start_time)+" - "+c(o.value.breaks[r.lesson_id].end_time)+" "+c(r.student_name),1)):u("",!0)],42,Ce))),128))])):u("",!0)])],40,Me)),64))]))),128))])],2)])):(a(),n("div",Be,e[2]||(e[2]=[t("div",{class:"loader"},null,-1)])))])]))]),M(ve,{ref_key:"modalsContainer",ref:E},null,512),M(he)])}}},Qe={class:"v-calendar"},ot={__name:"v-calendar-index",setup(V){const f=p(localStorage.getItem("activePage")||"month");return(q,g)=>(a(),n("div",Qe,[f.value==="month"?(a(),R(Ke,{key:0})):u("",!0),f.value==="week"?(a(),R(se,{key:1})):u("",!0)]))}};export{ot as default};

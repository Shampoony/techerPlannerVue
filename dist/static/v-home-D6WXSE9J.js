import{r as c,o as a,c as i,e,at as I,n as F,f as u,w as f,j as x,T as U,au as se,I as L,av as j,z as E,a as te,F as y,as as O,b as M,h as T,y as $,g,aw as oe,ax as le,ay as ne,s as ae,O as ie,az as re,aA as ce,d as de,N,aB as _e,i as ue,aC as he,aD as ve,aE as me,aF as pe,aG as ge,aH as we,aI as fe,aJ as ke}from"./index-BaLNjqNl.js";import{_ as z,a as A,b as be,c as ye}from"./v-homework-PzJjRyjN.js";import{_ as Ce}from"./cross-CfRcZe3L.js";import"./v-files-handler-CqXg-tKU.js";import"./v-styled-select-F_7OuZBd.js";const xe="data:image/svg+xml,%3csvg%20width='20'%20height='20'%20viewBox='0%200%2020%2020'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20clip-path='url(%23clip0_8739_1092)'%3e%3cpath%20d='M15.0754%208.51667L9.24207%2018.0333C9.1276%2018.2183%208.92624%2018.3316%208.70874%2018.3333H8.54207C8.42535%2018.3331%208.31385%2018.2849%208.23374%2018.2C8.15404%2018.1148%208.11461%2017.9995%208.12541%2017.8833L8.59207%2012.5H5.61707C5.39324%2012.4976%205.18731%2012.3772%205.07541%2012.1833L4.91707%2011.9083C4.83754%2011.7778%204.83754%2011.6138%204.91707%2011.4833L10.7504%201.96667C10.868%201.77664%2011.077%201.66264%2011.3004%201.66667H11.4671C11.5838%201.66688%2011.6953%201.7151%2011.7754%201.8C11.8551%201.88523%2011.8945%202.00048%2011.8837%202.11667L11.4087%207.5H14.3837C14.6076%207.50242%2014.8135%207.62281%2014.9254%207.81667L15.0837%208.09167C15.1607%208.22373%2015.1575%208.38773%2015.0754%208.51667Z'%20fill='%23FF3A3A'/%3e%3c/g%3e%3cdefs%3e%3cclipPath%20id='clip0_8739_1092'%3e%3crect%20width='20'%20height='20'%20fill='white'/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e",Le="data:image/svg+xml,%3csvg%20width='20'%20height='20'%20viewBox='0%200%2020%2020'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M15%2012.5L10%207.5L5%2012.5'%20stroke='%23717680'%20stroke-width='1.66667'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",$e={class:"home-right-sec"},Te={class:"subtitle"},Me={key:0,class:"home-right-sec__container"},V={__name:"v-home-right-sec-base",setup(k){const o=c(!0),h=()=>{o.value=!o.value};return(n,l)=>(a(),i("div",$e,[e("div",{class:F(["home-right-sec__header",{clicked:!o.value}]),onClick:h},[e("h2",Te,[I(n.$slots,"title")]),e("img",{class:F({"rotate-180":!o.value}),src:Le,alt:""},null,2)],2),u(U,{name:"slide-fade"},{default:f(()=>[o.value?(a(),i("div",Me,[I(n.$slots,"container")])):x("",!0)]),_:3})]))}},Se={class:"input-field"},Fe=["placeholder"],Pe={key:0,class:"add-field__field"},Ve={class:"add-field__block"},Be=["placeholder"],P={__name:"v-add-field",props:{placeholder:{type:String,default:"Введите значение"}},emits:["submit"],setup(k,{emit:o}){const h=o,n=c(!1),l=c(""),p=c(null),d=()=>{n.value=!n.value,n.value&&O(()=>{const w=document.querySelector(".add-field__input");w&&w.focus()})},v=w=>{n.value=!1},m=()=>{l.value.trim()&&(h("submit",l.value.trim()),l.value="",n.value=!1)};return(w,_)=>{const b=se("click-outside");return a(),i(y,null,[e("form",{onSubmit:E(m,["prevent"])},[e("div",Se,[L(e("input",{class:"input-field__input",type:"text",placeholder:k.placeholder,"onUpdate:modelValue":_[0]||(_[0]=C=>l.value=C)},null,8,Fe),[[j,l.value]]),_[2]||(_[2]=e("button",{type:"submit",class:"input-field__submit"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16",fill:"none"},[e("path",{d:"M7.99975 12.2424V3.75751M7.99975 3.75751L3.75732 7.99993M7.99975 3.75751L12.2422 7.99993",stroke:"#717680","stroke-width":"1.85556","stroke-linecap":"round","stroke-linejoin":"round"})])],-1))])],32),L((a(),i("div",{class:"add-field",ref_key:"addFieldRef",ref:p},[e("button",{class:"add-field__button custom-btn light-blue",onClick:d}," Добавить "),n.value?(a(),i("div",Pe,[e("form",{method:"POST",onSubmit:E(m,["prevent"])},[e("div",Ve,[L(e("input",{class:"add-field__input",type:"text",placeholder:k.placeholder,"onUpdate:modelValue":_[1]||(_[1]=C=>l.value=C)},null,8,Be),[[j,l.value]]),_[3]||(_[3]=te('<button type="submit"><svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 28 28" fill="none"><rect width="28" height="28" rx="14" fill="#1D4ECC"></rect><path d="M14 6L14 22" stroke="white" stroke-width="2" stroke-linecap="round"></path><path d="M13.6572 6L8.00037 11.6569" stroke="white" stroke-width="2" stroke-linecap="round"></path><path d="M14 6L19.6569 11.6569" stroke="white" stroke-width="2" stroke-linecap="round"></path><path d="M14 18L14 22" stroke="white" stroke-width="2" stroke-linecap="round"></path><path d="M14 18L14 22" stroke="white" stroke-width="2" stroke-linecap="round"></path></svg></button>',1))])],32)])):x("",!0)])),[[b,v]])],64)}}},De={class:"v-home-tasks"},He={class:"v-home-tasks__list"},Ie={class:"task__title"},je=["onClick"],Ee={__name:"v-home-tasks",setup(k){const o=c([]),h=c(null),n=d=>{if(console.log(d),d){const v={title:d};o.value.push(v),h.value="",oe(v)}},l=async()=>{const d=await le();o.value=d||[]},p=d=>{o.value=o.value.filter(v=>v.id!==d)};return M(()=>{l()}),(d,v)=>(a(),i("div",De,[u(V,null,{title:f(()=>v[0]||(v[0]=[T(" Актуальные задачи ")])),container:f(()=>[e("ul",He,[(a(!0),i(y,null,$(o.value,m=>(a(),i("li",{class:"v-home-tasks__list-item task",key:m.id},[e("h3",Ie,g(m.title),1),e("div",{onClick:()=>p(m.id),class:"task__close"},v[1]||(v[1]=[e("img",{src:Ce,alt:""},null,-1)]),8,je)]))),128))]),u(P,{placeholder:"Тема занятий",onSubmit:n})]),_:1})]))}},Ne={class:"v-home-schedule"},ze={class:"caption"},Ae={class:"v-home-schedule__list"},Ue={__name:"v-home-schedule",setup(k){const o=c([]),h=async()=>{const n=await ne();o.value=n||[]};return M(()=>{h()}),(n,l)=>(a(),i("div",Ne,[u(V,null,{title:f(()=>l[0]||(l[0]=[T("Расписание занятий")])),container:f(()=>[l[2]||(l[2]=e("div",{class:"v-home-schedule__progress progress-bar"},[e("div",{class:"progress-bar__completed",style:{width:"50%"}})],-1)),e("p",ze,g(o.value.completed_lessons)+"/"+g(o.value.total_lessons)+" занятий проведены ",1),e("ul",Ae,[(a(!0),i(y,null,$(o.value.lessons,p=>(a(),i("li",{class:F([{completed:p.status==="completed"},"v-home-schedule-list-item schedule-item"]),key:p.id},l[1]||(l[1]=[e("div",{class:"flex gap-2"},[e("div",{class:"schedule-item__img"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none"},[e("path",{d:"M16.3999 17.2001V15.6C16.3999 14.7514 16.0627 13.9374 15.4626 13.3373C14.8625 12.7372 14.0485 12.4 13.1999 12.4H6.79985C5.95116 12.4 5.13723 12.7372 4.53711 13.3373C3.937 13.9374 3.59985 14.7514 3.59985 15.6V17.2001M13.1999 6.00005C13.1999 7.76736 11.7672 9.20005 9.99985 9.20005C8.23254 9.20005 6.79985 7.76736 6.79985 6.00005C6.79985 4.23274 8.23254 2.80005 9.99985 2.80005C11.7672 2.80005 13.1999 4.23274 13.1999 6.00005Z",stroke:"#717680","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})])]),e("h3",{class:"schedule-item__description"},"Дарья / 3000р")],-1),e("h3",{class:"schedule-item__description"},"18:00",-1)]),2))),128))])]),_:1})]))}},Oe={class:"v-home-earnings"},We={class:"v-home-earnings__progress progress-bar"},Ke={class:"caption"},Re={__name:"v-home-earnings",setup(k){const o=c({}),h=ae(()=>parseFloat(o.value.actual_earning)?`${o.value.actual_earning/parseInt(o.value.potential_earning)*100}%`:0),n=async()=>{o.value=await re()};return M(()=>{n()}),(l,p)=>(a(),i("div",Oe,[u(V,null,{title:f(()=>p[0]||(p[0]=[T("Заработок за день")])),container:f(()=>[e("div",We,[e("div",{class:"progress-bar__completed",style:ie({width:h.value})},null,4)]),e("div",Ke,g(o.value.actual_earning)+"р/"+g(o.value.potential_earning)+"р заработано ",1)]),_:1})]))}},Ze={class:"v-home-right"},qe={class:"v-home-right__container"},Ge={class:"v-home-right__block"},Je={__name:"v-home-right",setup(k){return(o,h)=>(a(),i("div",Ze,[e("div",qe,[e("div",Ge,[u(Ue),u(Re)]),u(Ee)])]))}},Qe={class:"v-home"},Xe={class:"container"},Ye={class:"loader-container"},es={key:0,class:"v-home__container layout"},ss={class:"v-home__left"},ts={class:"v-home__lesson"},os={class:"v-home__lesson-info"},ls={class:"v-home__lesson-title"},ns={class:"v-home__lesson-time"},as={class:"v-home__lesson-container"},is={class:"v-home__lesson-block"},rs={key:0,class:"v-home__lesson-problems v-home__lesson-sec"},cs={class:"v-home__lesson-problems-list"},ds={class:"v-home__lesson-themes v-home__lesson-sec"},_s={class:"v-home__lesson-themes-list"},us=["data-theme-id"],hs={class:"theme__title"},vs=["onClick"],ms={class:"v-home__lesson-current-problems v-home__lesson-sec"},ps={class:"v-home__lesson-themes-list"},gs={class:"theme__title"},ws=["onClick"],fs={class:"layout"},Ls={__name:"v-home",setup(k){const o=c([]),h=c(null),n=c([]),l=c([]),p=c(null),d=c(),v=c(!1);let m=null;const w=c([]),_=c(null),b=c(!1),C=c({files:!1}),B=()=>{const s=window.innerHeight;window.addEventListener("resize",()=>{v.value=window.innerHeight<s})},D=()=>{C.value.files=!1},W=async s=>{l.value=l.value.filter(t=>t.id!==s),await he(s)},K=async s=>{n.value=n.value.filter(t=>t.id!==s),await ve(s)},R=async s=>{if(s){const t=n.value.length>0?Math.max(...n.value.map(S=>S.id)):0;n.value.push({id:t+1,name:s});const r={lesson_id:_.value,name:s};await me(r),p.value=""}},Z=async s=>{if(s){console.log(s);const t=l.value.length>0?Math.max(...l.value.map(S=>S.id)):0;l.value.push({id:t+1,problem_text:s});const r={lesson_id:_.value,problems:[s]};await pe(r)}},q=s=>{o.value=[...s],h.value.internalFiles=s,O(()=>{var t,r;(r=(t=h.value)==null?void 0:t.$forceUpdate)==null||r.call(t)}),D()},G=async()=>{const s=await ge();if(s.permanent_lessons.length){const[t,r]=Object.entries(s.permanent_lessons[0])[0];d.value=r,_.value=t}else d.value=null;console.log(s)},J=async()=>{const s=await we(_.value);w.value=s},Q=async()=>{const s=await fe(_.value);l.value=s||[]},X=async()=>{const s=await ke(_.value);n.value=s||[]},Y=async()=>{b.value=!0,await G(),_.value&&await Promise.all([Q(),X(),J()]),b.value=!1};function H(){m=new WebSocket("wss://test-api.teacherplanner.ru/ws/lesson_notifications/"),m.onmessage=s=>{s.data!=="ping"&&console.log("Новое сообщение:",s.data)},m.onclose=()=>{console.log("Соединение закрыто, переподключение..."),setTimeout(H,1e3)},m.onerror=s=>{console.log("Ошибка сокета:",s),m.close()}}const ee=()=>{H()};return M(()=>{B(),Y(),ee()}),ce(()=>{window.removeEventListener("resize",B)}),de(()=>{}),(s,t)=>(a(),i(y,null,[u(_e,null,{default:f(()=>[e("section",Qe,[e("div",Xe,[L(e("div",Ye,t[0]||(t[0]=[e("div",{class:"loader"},null,-1)]),512),[[N,b.value]]),d.value&&!b.value?(a(),i("div",es,[e("div",ss,[e("div",ts,[e("div",os,[e("h1",ls,[t[1]||(t[1]=T(" Текущее занятие: ")),e("span",null,[T(g(d.value.student_name)+" ",1),e("span",ns,g(d.value.start_time)+" - "+g(d.value.end_time),1)])]),t[2]||(t[2]=e("div",{class:"flex gap-3"},[e("img",{class:"rotate-180 day-el",src:z,alt:""}),e("img",{class:"rotate-180 night-el",src:A,alt:""}),e("img",{class:"day-el",src:z,alt:""}),e("img",{class:"night-el",src:A,alt:""})],-1))]),e("div",as,[e("div",is,[w.value&&w.value.length?(a(),i("div",rs,[t[4]||(t[4]=e("h2",{class:"v-home__subtitle subtitle"},"Проблемы прошлого занятия",-1)),e("ul",cs,[(a(!0),i(y,null,$(w.value,r=>(a(),i("li",{class:"v-home__lesson-problems-list-item problem",key:r.id},t[3]||(t[3]=[e("div",{class:"problem__close"},[e("img",{src:xe,alt:""})],-1),e("span",{class:"problem__title"}," Не выполненно домашнее задание прошлого занятия ",-1)])))),128))])])):x("",!0),e("div",ds,[t[6]||(t[6]=e("h2",{class:"v-home__subtitle subtitle"},"Темы текущего занятия",-1)),e("ul",_s,[(a(!0),i(y,null,$(n.value,r=>(a(),i("li",{class:"v-home__lesson-themes-list-item theme","data-theme-id":r.id,key:r.id},[e("span",hs,g(r.name),1),e("div",{class:"theme__close",onClick:()=>K(r.id)},t[5]||(t[5]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 12 12",fill:"none"},[e("path",{d:"M9 3L3 9M3 3L9 9",stroke:"#1D4ECC","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"})],-1)]),8,vs)],8,us))),128))]),u(P,{placeholder:"Тема занятия",onSubmit:R})])]),e("div",ms,[t[8]||(t[8]=e("h2",{class:"v-home__subtitle subtitle"},"Проблемы текущего занятия",-1)),e("ul",ps,[(a(!0),i(y,null,$(l.value,r=>(a(),i("li",{class:"v-home__lesson-themes-list-item theme",key:r.id},[e("span",gs,g(r.problem_text),1),e("div",{class:"theme__close",onClick:()=>W(r.id)},t[7]||(t[7]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 12 12",fill:"none"},[e("path",{d:"M9 3L3 9M3 3L9 9",stroke:"#FF3A3A","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"})],-1)]),8,ws)]))),128))]),u(P,{onSubmit:Z,placeholder:"Проблема"})]),u(be)])])]),u(Je)])):x("",!0),L(e("div",fs,t[9]||(t[9]=[e("div",{class:"null-screen"},[e("h1",null,"Ещё не добавлено ни одного занятия")],-1)]),512),[[N,!d.value&&!b.value]])])])]),_:1}),u(U,{name:"fade"},{default:f(()=>[C.value.files?(a(),ue(ye,{key:0,onClose:D,onSaveFiles:q})):x("",!0)]),_:1})],64))}};export{Ls as default};

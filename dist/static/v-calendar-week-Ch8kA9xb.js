import{r as m,u as le,c as re,o as de,a as r,b as k,d as a,e as I,f as u,n as B,w as h,T as R,m as ie,v as ce,p as ue,F as b,g as D,l as _e,i as o,t as c,j as ve,q as me,k as ke,h as ye}from"./index-B8HkGvOt.js";import{f as pe,d as q,t as J,e as fe,h as we,i as ge,_ as he,a as be,b as De,j as Se,v as Te,c as $e}from"./v-modals-container-Bo8MrbaL.js";import{u as Le,_ as K,a as Ce,b as Me}from"./v-calendar-menu-ToX0Mlye.js";import{d as xe}from"./daypilot-vue.min-ffaDr3FM.js";const Ee={class:"wrapper"},We={key:0,class:"v-calendar-week"},Ie={class:"v-calendar-week__container container"},Be={key:0,class:"sec-hidden-content showing"},Re={key:0,class:"v-calendar-week__table calendar"},qe={class:"calendar-header"},Fe=["onDrop"],Oe={class:"calendar-row__item-content calendar-card"},Ne=["onClick","onDragstart"],ze={class:"v-calendar-week__break scroll-container"},Pe=["onClick"],He={class:"event-header"},Ve={class:"calendar-card__content"},je={class:"calendar-card__lesson"},Ue={key:0,class:"calendar-card__break"},Ge={key:2,class:"loader-container"},Ae={key:1,class:"v-calendar-week-mob mob-page"},Je={class:"v-calendar-week-mob__container container"},Ke={key:0,class:"v-calendar-week-mob__list"},Qe={key:0,class:"day"},Xe=["onClick"],Ye={class:"day__date"},Ze={key:0},et={class:"day__lesson"},tt={class:"day__lesson-time"},at={class:"day__lesson-name"},st={key:0,class:"day__lesson break"},nt={class:"day__lesson-block"},ot={class:"day__lesson-time"},lt={key:0,class:"title pb-4"},rt=10,Q=90,vt={__name:"v-calendar-week",setup(dt){const{isMobile:X}=Le(),y=m({}),Y=ke(),F=_e(),f=m(localStorage.getItem("breakMode")==="true"),$=m(),L=m(pe(new Date)),O=m(F.query.start_date||"01.12.2025"),N=le("modalsContainer"),l=m(),C=m({lesson:null,fromColumnIndex:null,fromLessonIndex:null}),z=m({viewType:"Week",cellDuration:15,startDate:q(O.value),allowEventOverlap:!1,eventResizeHandling:"Disabled",timeRangeSelectedHandling:"Disabled",locale:"ru-RU",headerDateFormat:"ddd, d",showNowLine:!0,nowLineColor:"#FF0000",nowLineWidth:2,touch:!0,weekStarts:1,onEventMoved:t=>{const e=t.newStart.value.split("T")[1],i=t.newEnd.value.split("T")[1],s=t.e.data.start.value.split("T")[0],d=new Date(t.newStart.value).getDay();console.log(e),t.e.data.start_time=e.slice(0,5),t.e.data.end_time=i.slice(0,5);const n={day_of_week_id:d,start_time:e,end_time:i,conducted_date:s},_=t.e.data.lesson_id;J(_,n).then(()=>{console.log("Выполнили запрос")})},onEventResized:t=>{console.log("Event resized")}}),M=async t=>{const e=[];if(t)for(let i in t.week.days)t.week.days[i].lessons.forEach(s=>{const{start_time:d,end_time:n,..._}=s,p=`${t.week.days[i].day} ${d}`.replace(/(\d{2})\.(\d{2})\.(\d{4})/,"$3-$2-$1T").replace(" ",""),W=`${t.week.days[i].day} ${n}`.replace(/(\d{2})\.(\d{2})\.(\d{4})/,"$3-$2-$1T").replace(" ","");e.push({start:p,end:W,start_time:d.slice(0,5),end_time:n.slice(0,5),..._})});console.log(e),$.value=e},x=m({0:{day_of_week:"пн",date:""},1:{day_of_week:"вт",date:""},2:{day_of_week:"ср",date:""},3:{day_of_week:"чт",date:""},4:{day_of_week:"пт",date:""},5:{day_of_week:"сб",date:""},6:{day_of_week:"вс",date:""}}),Z=(t,e,i,s)=>{C.value={lesson:e,fromColumnIndex:i,fromLessonIndex:s}},w=t=>t.slice(0,5),ee=(t,e)=>{const{lesson:i,fromColumnIndex:s,fromLessonIndex:d}=C.value;if(s!==e){const n=l.value.week.days[s].lessons,_=l.value.week.days[e].lessons,p=x.value[e].date.toISOString().split("T")[0],W={day_of_week_id:parseInt(e),start_time:i.start_time,end_time:i.end_time,conducted_date:p},g=v=>{const[T,A]=v.split(":").map(Number);return T*60+A},U=g(i.start_time),oe=g(i.end_time);for(let v of _){const T=g(v.start_time);if(!(g(v.end_time)<=U||T>=oe)){alert("В этот день уже есть занятие на данное время");return}}let G=_.length;for(let v=0;v<_.length;v++)if(g(_[v].start_time)>U){G=v;break}n.splice(d,1),_.splice(G,0,i),J(i.lesson_id,W).then(()=>{console.log("Перенос осуществлен")})}C.value={lesson:null,fromColumnIndex:null,fromLessonIndex:null}},te=t=>t===L.value,P=()=>{f.value=!f.value,localStorage.setItem("breakMode",f.value),console.log(l.value),M(l.value)},H=()=>{E()},ae=(t,e)=>{if(e==L.value){y.value[t]=!1,L.value="";return}if(!(t in y.value)){y.value[t]=!0;return}y.value[t]=!y.value[t]},V=t=>{N.value.toggleLessonModals("buttons",t)},se=t=>Math.max(Q,Q*t),j=t=>{Y.push({query:{start_date:t}}).then(()=>{E()})},ne=t=>{const[e,i,s]=t.split(".").map(Number);let d=new Date(s,i-1,e);return d=d.getDay()||7,x.value[d-1].date=new Date(s,i-1,e),`${x.value[d-1].day_of_week}, ${e}`},E=async()=>{const t=F.query;if("start_date"in t){O.value=q(t.start_date),z.value.startDate=q(t.start_date);const e=await fe(t.start_date);M(e),l.value=e}else{const e=we(new Date);window.location.search=`?start_date=${ge(e)}`}},S=re(()=>{if(l.value&&l.value.week.days){for(let t in l.value.week.days){const e=l.value.week.days[t];if(e.lessons&&e.lessons.length)return!1}return!0}return!1});return de(()=>{localStorage.removeItem("upd"),E().then(()=>{M(l.value)})}),(t,e)=>{const i=ye("router-link");return o(),r("div",Ee,[k(he),a("main",null,[I(X)?(o(),r("section",Ae,[a("div",Je,[k(K,{"is-showed-break":!0,type:"week",onSetWeek:j,onPaginateWeek:H,onToggleBreakMode:P}),l.value&&l.value.week?(o(),r("ul",Ke,[(o(!0),r(b,null,D(l.value.week.days,(s,d)=>(o(),r("li",{key:d,class:"v-calendar-week-mob__list-item"},[s?(o(),r("div",Qe,[a("div",{class:"day__header",onClick:n=>ae(d,s.day)},[a("p",Ye,c(s.day),1),e[3]||(e[3]=a("img",{src:be,class:"day-el",alt:""},null,-1)),e[4]||(e[4]=a("img",{src:De,class:"night-el",alt:""},null,-1))],8,Xe),k(R,{name:"fade"},{default:h(()=>[y.value[d]||te(s.day)?(o(),r("div",Ze,[k(i,{to:{name:"calendar-day",query:{date:s.day}}},{default:h(()=>[(o(!0),r(b,null,D(s.lessons,(n,_)=>(o(),r("div",{class:"day__content",key:n.id},[a("div",et,[a("div",tt,[e[5]||(e[5]=a("div",{class:"day__lesson-circle"},null,-1)),a("p",null,c(w(n.start_time)),1),e[6]||(e[6]=a("p",null,"-",-1)),a("p",null,c(w(n.end_time)),1)]),a("div",at,c(n.student_name),1)]),l.value.breaks&&l.value.breaks[n.lesson_id]?(o(),r("div",st,[a("div",nt,[e[8]||(e[8]=a("img",{src:Ce,class:"day-el",alt:""},null,-1)),e[9]||(e[9]=a("img",{src:Me,class:"night-el",alt:""},null,-1)),a("div",ot,[a("p",null,c(w(n.start_time)),1),e[7]||(e[7]=a("p",null,"-",-1)),a("p",null,c(I(Se)(n.start_time,l.value.breaks[n.lesson_id].duration)),1)])]),e[10]||(e[10]=a("div",{class:"day__lesson-name"},"Перерыв",-1))])):u("",!0)]))),128))]),_:2},1032,["to"]),s.lessons.length?u("",!0):(o(),r("div",lt," В этот день у вас нет уроков! "))])):u("",!0)]),_:2},1024)])):u("",!0)]))),128))])):u("",!0)])])):(o(),r("section",We,[a("div",Ie,[k(K,{"is-showed-break":!0,type:"week",onSetWeek:j,onPaginateWeek:H,onToggleBreakMode:P}),S.value?(o(),r("div",Be,e[1]||(e[1]=[a("h1",{class:"text-title text-blue"},"Еще не запланировано ни одного занятия!",-1)]))):u("",!0),!f.value&&l.value||S.value?(o(),r("div",{key:1,class:B(["v-calendar-week__content scroll-container",{blur:S.value}])},[k(R,{name:"fade"},{default:h(()=>[l.value?(o(),r("table",Re,[a("thead",null,[a("tr",qe,[(o(!0),r(b,null,D(l.value.week.days,(s,d)=>(o(),r("th",{class:"calendar-header__item",key:d},c(ne(s.day)),1))),128))])]),a("tbody",null,[l.value&&l.value.week?(o(),r("tr",{class:"calendar-row",key:l.value.week.start_date},[(o(!0),r(b,null,D(l.value.week.days,(s,d)=>(o(),r("td",{key:d,class:"calendar-row__item",onDragover:e[0]||(e[0]=ve(()=>{},["prevent"])),onDrop:n=>ee(n,d)},[a("div",Oe,[(o(!0),r(b,null,D(s.lessons,(n,_)=>(o(),r("div",{class:B(["calendar-card__content",{completed:n.completed}]),key:n.lesson_id,onClick:p=>V(n),draggable:"true",onDragstart:p=>Z(p,n,d,_)},[k(R,{name:"flip"},{default:h(()=>[n?(o(),r("div",{key:0,class:B(["calendar-card__lesson",{trial:n.trial}]),style:me({height:se(n.duration),gap:`${rt*n.duration}px`})},[a("p",null,c(w(n.start_time))+" - "+c(w(n.end_time)),1),a("p",null,c(n.student_name),1)],6)):u("",!0)]),_:2},1024)],42,Ne))),128))])],40,Fe))),128))])):u("",!0)])])):u("",!0)]),_:1})],2)):u("",!0),ie(a("div",ze,[$.value?(o(),ue(I(xe.DayPilotCalendar),{key:0,config:z.value,events:$.value,ref:"calendarRef"},{event:h(({event:s})=>[a("div",{class:"event",onClick:d=>V(s.data)},[a("div",He,[a("div",Ve,[a("div",je,[a("p",null,c(s.data.start_time)+" - "+c(s.data.end_time),1),a("p",null,c(s.data.student_name),1)]),s.data.break&&s.data.break.duration?(o(),r("div",Ue,c(s.data.break.duration),1)):u("",!0)])])],8,Pe)]),_:1},8,["config","events"])):u("",!0)],512),[[ce,f.value&&l.value&&!S.value]]),l.value?u("",!0):(o(),r("div",Ge,e[2]||(e[2]=[a("div",{class:"loader"},null,-1)])))])]))]),k(Te),k($e,{ref_key:"modalsContainer",ref:N},null,512)])}}};export{vt as default};

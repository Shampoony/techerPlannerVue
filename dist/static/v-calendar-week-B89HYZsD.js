import{r as _,x as ge,q as we,y as le,b as fe,z as $e,o as d,c as i,d as t,k as S,e as $,w as b,n as L,B as Y,f as A,l as C,H as xe,I as De,J as ce,h as m,K as Me,L as ee,M as ve,j as k,m as Se,T as te,p as Ce,F as V,N as ne,O as he,P as Le,u as Be,t as oe,E as me,Q as _e,A as Q,R as qe,C as We,D as Te,S as Ie,U as Ee}from"./index-CogWQqZT.js";import{_ as ke}from"./arrow-right-finance-Dbx55g6C.js";import{u as re}from"./useIsMobile-7Rnoap53.js";import{d as Ne,_ as Ve}from"./v-modals-container-DrNv3jKM.js";const Ue={class:"v-calendar-menu"},je={class:"v-calendar-menu__top"},Pe={class:"v-calendar-menu__buttons"},Re={class:"v-calendar-menu__block"},Fe={class:"flex gap-2"},He={class:"v-calendar-menu__picker picker"},Oe={class:"v-calendar-menu__select"},ze={class:"v-calendar-menu__select-buttons"},Qe={class:"v-calendar-menu__select-button"},Ye={key:0,class:"v-calendar-menu__checkbox flex gap-2"},Ae={class:"v-calendar-menu__meanings flex"},Ge={key:0,class:"flex justify-between"},Je={key:0,class:"v-calendar-menu__checkbox flex gap-2 mob"},Ke={key:0,class:"v-calendar-menu mob"},Xe={class:"v-calendar-menu__block"},Ze={class:"flex gap-2 items-center justify-center"},et={class:"v-calendar-menu__picker picker"},tt={class:"v-calendar-menu__date flex items-center justify-center"},at={key:0,class:"v-calendar-menu__date-text"},st={key:1},nt={class:"v-calendar-menu__date-text"},ot={class:"v-calendar-menu__meanings flex"},pe={__name:"v-calendar-menu",props:{isShowedBreak:{type:Boolean,required:!1},type:{type:String,required:!0}},emits:["toggleBreakMode","setMonth","setWeek","paginateMonth","paginateWeek"],setup(w,{emit:G}){const W=G,B=_(localStorage.getItem("breakMode")),f=_({}),x=_(),P=new Date,D=_(`${P.getFullYear()}-${String(P.getMonth()+1).padStart(2,"0")}`),c=_(D.value.slice(0,4)),T=_(),J=re(768),R=re(480),N=_(),F=_(),U=ge(),h=we(),K=w,I=_({lessons:!1,trial_lesson:!1}),X=()=>{const o=D.value.split("-")[1],e=D.value.split("-")[0],u={...h.query,selected_date:`${o}.${e}`};U.push({query:u})},H=o=>{let e=parseInt(D.value.split("-")[1]),u=parseInt(D.value.split("-")[0]);o=="next"?e===12?(e=1,u+=1):e+=1:o==="prev"&&(e===1?(e=12,u-=1):e-=1),T.value=ne(e-1),D.value=`${u}-${String(e).padStart(2,0)}`,x.value={month:e-1,year:u},W("paginateMonth",{month:e,year:u}),X()},ae=async o=>{const e={...h.query,start_date:o};await U.push({query:e})},O=async o=>{const e=new Date(f.value[0]),u=o==="next"?7:-7;e.setDate(e.getDate()+u);const n=he(e);ae(n).then(()=>{p(),W("paginateWeek")})},se=o=>{f.value=o,W("setWeek",o[0].toLocaleDateString("ru-RU"))},z=()=>{const o=h.query;if(o.start_date){const e=o.start_date.replace(/\./g,"-"),u=new Date(e.split("-").reverse().join("-")),n={day:"numeric",month:"long"};N.value=u.toLocaleDateString("ru-RU",n);const g=new Date(u);g.setDate(u.getDate()+7),F.value=g.toLocaleDateString("ru-RU",n),f.value=[u,g]}},j=()=>{v(),z()},a=o=>{I.value[o]=!I.value[o]},s=()=>{W("toggleBreakMode")},l=o=>{x.value=o,D.value=`${o.year}-${o.month+1}`,W("setMonth",o)},v=()=>{if(h.query.selected_date){const[o,e]=h.query.selected_date.split(".").map(Number);T.value=ne(o-1),!isNaN(o)&&!isNaN(e)&&(x.value={month:o-1,year:e})}else if(!h.query.selected_date){const o=new Date().getMonth(),e=new Date().getFullYear();T.value=ne(o-1),!isNaN(o)&&!isNaN(e)&&(x.value={month:o,year:e})}},r=()=>{if(h.query.modal==="modal_add"){I.value.lessons=!0;const{modal:o,...e}=h.query;U.replace({query:e})}},y=o=>{localStorage.setItem("activePage",o),console.log(o),U.push({name:o})},p=()=>{const e=h.query.start_date.replace(/\./g,"-"),u=new Date(e.split("-").reverse().join("-")),n={day:"numeric",month:"long"};N.value=u.toLocaleDateString("ru-RU",n);const g=new Date(u);g.setDate(u.getDate()+7),F.value=g.toLocaleDateString("ru-RU",n),f.value=[u,g]},M=le(()=>K.type==="home"?()=>H("next"):()=>O("next")),E=le(()=>K.type==="home"?()=>H("prev"):()=>O("prev"));return fe(()=>{j(),r()}),(o,e)=>{const u=$e("router-link");return d(),i(V,null,[t("div",Ue,[t("div",je,[e[23]||(e[23]=t("h1",{class:"text-title"},"Календарь",-1)),t("div",Pe,[t("div",{class:"v-calendar-menu__button custom-btn white",onClick:e[0]||(e[0]=n=>a("trial_lesson"))},e[21]||(e[21]=[t("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M9.99984 4.16663V15.8333M4.1665 9.99996H15.8332",stroke:"white","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),S(" Пробное занятие ")])),t("div",{class:"v-calendar-menu__button custom-btn blue",onClick:e[1]||(e[1]=n=>a("lessons"))},e[22]||(e[22]=[t("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M9.99984 4.16663V15.8333M4.1665 9.99996H15.8332",stroke:"white","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),S(" Занятие ")]))])]),t("div",Re,[t("div",Fe,[t("div",He,[$(u,{to:{name:"calendar-week"},class:L(["v-calendar-menu__picker-item picker__item",{active:w.type==="calendar-week"}]),onClick:e[2]||(e[2]=n=>y("calendar-week"))},{default:b(()=>e[24]||(e[24]=[S("Неделя")])),_:1},8,["class"]),$(u,{to:"/calendar",class:L(["v-calendar-menu__picker-item picker__item",{active:w.type==="home"}]),onClick:e[3]||(e[3]=n=>y("home"))},{default:b(()=>e[25]||(e[25]=[S("Месяц")])),_:1},8,["class"])]),t("div",Oe,[t("div",ze,[t("div",{class:"v-calendar-menu__select-button",onClick:e[4]||(e[4]=Y((...n)=>E.value&&E.value(...n),["prevent"]))},e[26]||(e[26]=[t("svg",{width:"12",height:"12",viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M9.20975 5.99989H2.42188M2.42188 5.99989L5.81581 9.39383M2.42188 5.99989L5.81581 2.60595",stroke:"#717680","stroke-width":"1.48444","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])),t("div",Qe,[w.type==="home"?(d(),A(C(ce),{key:0,"month-picker":"","month-name-format":"long",locale:C(xe),"auto-apply":!0,format:C(De),modelValue:x.value,"onUpdate:modelValue":[e[5]||(e[5]=n=>x.value=n),l]},{"clear-icon":b(({clear:n})=>e[27]||(e[27]=[])),_:1},8,["locale","format","modelValue"])):m("",!0),w.type==="calendar-week"?(d(),A(C(ce),{key:1,"week-picker":"",format:C(Me),locale:"ru-ru","auto-apply":!0,modelValue:f.value,"onUpdate:modelValue":[e[6]||(e[6]=n=>f.value=n),se]},{"clear-icon":b(({clear:n})=>e[28]||(e[28]=[])),_:1},8,["format","modelValue"])):m("",!0),e[29]||(e[29]=t("div",{class:"v-calendar-menu__select-button-image"},[t("svg",{width:"12",height:"8",viewBox:"0 0 12 8",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M1 1.5L6 6.5L11 1.5",stroke:"#717680","stroke-width":"1.66667","stroke-linecap":"round","stroke-linejoin":"round"})])],-1))]),t("div",{class:"v-calendar-menu__select-button",onClick:e[7]||(e[7]=Y((...n)=>M.value&&M.value(...n),["prevent"]))},e[30]||(e[30]=[t("svg",{class:"rotate-180",width:"12",height:"12",viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M9.20975 5.99989H2.42188M2.42188 5.99989L5.81581 9.39383M2.42188 5.99989L5.81581 2.60595",stroke:"#717680","stroke-width":"1.48444","stroke-linecap":"round","stroke-linejoin":"round"})],-1)]))])]),w.isShowedBreak?(d(),i("div",Ye,[ee(t("input",{type:"checkbox",class:"custom-checkbox-input",id:"break",onChange:s,"onUpdate:modelValue":e[8]||(e[8]=n=>B.value=n)},null,544),[[ve,B.value]]),e[31]||(e[31]=t("label",{for:"break",class:"custom-checkbox-label"},[t("span",{class:"custom-checkbox"}),t("div",{class:"v-calendar-menu__checkbox-subtitle"},"Показывать перерыв между занятиями")],-1))])):m("",!0)]),t("div",Ae,[t("div",{class:"v-calendar-menu__meaning blue",onClick:e[9]||(e[9]=n=>a("trial_lesson"))},e[32]||(e[32]=[t("div",null,null,-1),S(" Занятие ")])),t("div",{class:"v-calendar-menu__meaning green",onClick:e[10]||(e[10]=n=>a("lessons"))},e[33]||(e[33]=[t("div",null,null,-1),S(" Пробное занятие ")]))])]),C(J).isMobile?(d(),i("div",Ge,[w.isShowedBreak?(d(),i("div",Je,[ee(t("input",{type:"checkbox",class:"custom-checkbox-input",id:"mob-break",onChange:e[11]||(e[11]=n=>W("toggleBreakMode")),"onUpdate:modelValue":e[12]||(e[12]=n=>B.value=n)},null,544),[[ve,B.value]]),e[34]||(e[34]=t("label",{for:"mob-break",class:"custom-checkbox-label"},[t("span",{class:"custom-checkbox"}),t("div",{class:"v-calendar-menu__checkbox-subtitle"},"Показывать перерыв между занятиями")],-1))])):m("",!0)])):m("",!0)]),C(R).isMobile?(d(),i("div",Ke,[t("div",Xe,[t("div",Ze,[t("div",et,[$(u,{to:{name:"calendar-week"},class:L(["v-calendar-menu__picker-item picker__item",{active:w.type==="calendar-week"}]),onClick:e[13]||(e[13]=n=>y("calendar-week"))},{default:b(()=>e[35]||(e[35]=[S("Неделя")])),_:1},8,["class"]),$(u,{to:{name:"home"},class:L(["v-calendar-menu__picker-item picker__item",{active:w.type==="home"}]),onClick:e[14]||(e[14]=n=>y("home"))},{default:b(()=>e[36]||(e[36]=[S("Месяц")])),_:1},8,["class"])])]),t("div",tt,[t("a",{class:"v-calendar-menu__date-back",onClick:e[15]||(e[15]=Y((...n)=>E.value&&E.value(...n),["prevent"]))},e[37]||(e[37]=[t("img",{src:ke,alt:""},null,-1)])),w.type=="week"?(d(),i("h3",at,k(N.value)+" - "+k(F.value),1)):m("",!0),w.type=="home"?(d(),i("div",st,[t("h3",nt,k(T.value)+" "+k(c.value),1)])):m("",!0),t("a",{class:"v-calendar-menu__date-next",onClick:e[16]||(e[16]=Y((...n)=>M.value&&M.value(...n),["prevent"]))},e[38]||(e[38]=[t("img",{src:ke,alt:""},null,-1)]))]),t("div",ot,[t("div",{class:"v-calendar-menu__meaning blue",onClick:e[17]||(e[17]=n=>a("trial_lesson"))},e[39]||(e[39]=[t("div",null,null,-1),S(" Занятие ")])),t("div",{class:"v-calendar-menu__meaning green",onClick:e[18]||(e[18]=n=>a("lessons"))},e[40]||(e[40]=[t("div",null,null,-1),S(" Пробное занятие ")]))])])])):m("",!0),$(te,{name:"fade"},{default:b(()=>[I.value.lessons?(d(),A(Se,{key:0,onClose:e[19]||(e[19]=n=>a("lessons"))})):m("",!0)]),_:1}),$(te,{name:"fade"},{default:b(()=>[I.value.trial_lesson?(d(),A(Ce,{key:0,onClose:e[20]||(e[20]=n=>a("trial_lesson"))})):m("",!0)]),_:1})],64)}}},lt={class:"v-calendar-week"},rt={class:"container"},dt={class:"v-calendar-week__container layout"},it={key:0,class:"sec-hidden-content showing"},ut={key:0,class:"v-calendar-week__table calendar"},ct={class:"calendar-header"},vt={class:"calendar-header__item"},mt=["onDrop"],_t={class:"calendar-row__item-content calendar-card"},kt=["onClick","onDragstart"],pt={class:"calendar-card__lesson-time"},yt={class:"calendar-card__lesson-name"},gt={class:"v-calendar-week__break scroll-container"},wt=["onClick"],ft={class:"event-header"},ht={class:"calendar-card__lesson-time"},bt={class:"calendar-card__lesson-name"},$t={key:0,class:"calendar-card__break"},xt={key:2,class:"loader-container"},Dt={key:0,class:"v-calendar-week-mob mob-page"},Mt={class:"container"},St={class:"v-calendar-week-mob__container layout"},Ct={key:0,class:"v-calendar-week-mob__list"},Lt={key:0,class:"day"},Bt={class:"day__header"},qt={class:"day__date"},Wt={class:"day__lesson-time"},Tt={class:"day__lesson-name"},It=10,ye=90,Et={__name:"v-calendar-week",setup(w){const{isMobile:G}=re();_({});const W=ge(),B=we(),f=_(localStorage.getItem("breakMode")==="true"),x=_();_(Le(new Date));const P=_(B.query.start_date||"01.12.2025"),D=Be("modalsContainer"),c=_(),T=_({lesson:null,fromColumnIndex:null,fromLessonIndex:null}),J=_({viewType:"Week",cellDuration:15,startDate:oe(P.value),allowEventOverlap:!1,eventResizeHandling:"Disabled",timeRangeSelectedHandling:"Disabled",locale:"ru-RU",headerDateFormat:"ddd, d",showNowLine:!0,nowLineColor:"#FF0000",nowLineWidth:2,touch:!0,weekStarts:1,onEventMoved:a=>{const s=a.newStart.value.split("T")[1],l=a.newEnd.value.split("T")[1],v=a.e.data.start.value.split("T")[0],r=new Date(a.newStart.value).getDay();a.e.data.start_time=s.slice(0,5),a.e.data.end_time=l.slice(0,5);const y={day_of_week_id:r||7,start_time:s,end_time:l,conducted_date:v,in_rule:!1},p=a.e.data.lesson_id;me(p,y).then(()=>{console.log("Выполнили запрос")})},onEventResized:a=>{console.log("Event resized")}}),R=async a=>{const s=[];if(a)for(let l in a.week.days)a.week.days[l].lessons.forEach(v=>{const{start_time:r,end_time:y,...p}=v,M=`${a.week.days[l].day} ${r}`.replace(/(\d{2})\.(\d{2})\.(\d{4})/,"$3-$2-$1T").replace(" ",""),E=`${a.week.days[l].day} ${y}`.replace(/(\d{2})\.(\d{2})\.(\d{4})/,"$3-$2-$1T").replace(" ","");s.push({start:M,end:E,start_time:r.slice(0,5),end_time:y.slice(0,5),...p})});x.value=s},N=_({1:{day_of_week:"пн",date:""},2:{day_of_week:"вт",date:""},3:{day_of_week:"ср",date:""},4:{day_of_week:"чт",date:""},5:{day_of_week:"пт",date:""},6:{day_of_week:"сб",date:""},7:{day_of_week:"вс",date:""}}),F=a=>{if(B.query.start_date===void 0)return a;const s=B.query.start_date.slice(3);return Te(s,a.split(".")[0])},U=(a,s,l,v)=>{T.value={lesson:s,fromColumnIndex:l,fromLessonIndex:v}},h=a=>a.slice(0,5),K=(a,s)=>{const{lesson:l,fromColumnIndex:v,fromLessonIndex:r}=T.value;if(v!==s){const y=c.value.week.days[v].lessons,p=c.value.week.days[s].lessons,M=N.value[s].date,E=M.getFullYear(),o=String(M.getMonth()+1).padStart(2,"0"),e=String(M.getDate()).padStart(2,"0"),u=`${E}-${o}-${e}`,n={day_of_week_id:parseInt(s),start_time:l.start_time,end_time:l.end_time,conducted_date:u,in_rule:!1},g=q=>{const[Z,ue]=q.split(":").map(Number);return Z*60+ue},de=g(l.start_time),be=g(l.end_time);for(let q of p){const Z=g(q.start_time);if(!(g(q.end_time)<=de||Z>=be)){alert("В этот день уже есть занятие на данное время");return}}let ie=p.length;for(let q=0;q<p.length;q++)if(g(p[q].start_time)>de){ie=q;break}y.splice(r,1),p.splice(ie,0,l),me(l.lesson_id,n).then(()=>{console.log("Перенос осуществлен")})}T.value={lesson:null,fromColumnIndex:null,fromLessonIndex:null}},I=()=>{f.value=!f.value,localStorage.setItem("breakMode",f.value),R(c.value)},X=()=>{z()},H=a=>{D.value.toggleLessonModals("buttons",a)},ae=a=>Math.max(ye,ye*a),O=a=>{W.push({query:{start_date:a}}).then(()=>{z()})},se=a=>{const[s,l,v]=a.split(".").map(Number);let r=new Date(v,l-1,s);return r=r.getDay()||7,N.value[r].date=new Date(v,l-1,s),`${N.value[r].day_of_week}, ${s}`},z=async()=>{const a=B.query;if("start_date"in a){P.value=oe(a.start_date),J.value.startDate=oe(a.start_date);const s=await Ie(a.start_date);R(s),c.value=s}else{const s=Ee(new Date);window.location.search=`?start_date=${he(s)}`}},j=le(()=>{if(c.value&&c.value.week.days){for(let a in c.value.week.days){const s=c.value.week.days[a];if(s.lessons&&s.lessons.length)return!1}return!0}return!1});return fe(()=>{z().then(()=>{R(c.value)}),localStorage.setItem("activePage","calendar-week")}),(a,s)=>(d(),i(V,null,[$(We,null,{default:b(()=>[ee(t("section",lt,[t("div",rt,[t("div",dt,[$(pe,{"is-showed-break":!0,type:"calendar-week",onSetWeek:O,onPaginateWeek:X,onToggleBreakMode:I}),j.value?(d(),i("div",it,s[1]||(s[1]=[t("h1",{class:"text-title text-blue"},"Еще не запланировано ни одного занятия!",-1)]))):m("",!0),!f.value&&c.value||j.value?(d(),i("div",{key:1,class:L(["v-calendar-week__content scroll-container",{blur:j.value}])},[$(te,{name:"fade"},{default:b(()=>[c.value?(d(),i("table",ut,[t("thead",null,[t("tr",ct,[(d(!0),i(V,null,Q(c.value.week.days,(l,v)=>(d(),i("th",{key:v},[t("div",vt,k(se(l.day)),1)]))),128))])]),t("tbody",null,[c.value&&c.value.week?(d(),i("tr",{class:"calendar-row",key:c.value.week.start_date},[(d(!0),i(V,null,Q(c.value.week.days,(l,v)=>(d(),i("td",{key:v,class:"calendar-row__item",onDragover:s[0]||(s[0]=Y(()=>{},["prevent"])),onDrop:r=>K(r,v)},[t("div",_t,[(d(!0),i(V,null,Q(l.lessons,(r,y)=>(d(),i("div",{class:L(["calendar-card__content",{completed:r.completed}]),key:r.lesson_id,onClick:p=>H(r),draggable:"true",onDragstart:p=>U(p,r,v,y)},[$(te,{name:"flip"},{default:b(()=>[r?(d(),i("div",{key:0,class:L(["calendar-card__lesson",{trial:r.trial}]),style:qe({height:ae(r.duration),gap:`${It*r.duration}px`})},[t("p",pt,k(h(r.start_time))+" - "+k(h(r.end_time)),1),t("p",yt,k(r.student_name),1)],6)):m("",!0)]),_:2},1024)],42,kt))),128))])],40,mt))),128))])):m("",!0)])])):m("",!0)]),_:1})],2)):m("",!0),ee(t("div",gt,[x.value?(d(),A(C(Ne.DayPilotCalendar),{key:0,config:J.value,events:x.value,ref:"calendarRef"},{event:b(({event:l})=>[t("div",{class:"event",onClick:v=>H(l.data)},[t("div",ft,[t("div",{class:L(["calendar-card__content",{completed:l.data.completed}])},[t("div",{class:L(["calendar-card__lesson",{trial:l.data.trial}])},[t("p",ht,k(l.data.start_time)+" - "+k(l.data.end_time),1),t("p",bt,k(l.data.student_name),1)],2),l.data.break&&l.data.break.duration?(d(),i("div",$t,k(l.data.break.duration),1)):m("",!0)],2)])],8,wt)]),_:1},8,["config","events"])):m("",!0)],512),[[_e,f.value&&c.value&&!j.value]]),c.value?m("",!0):(d(),i("div",xt,s[2]||(s[2]=[t("div",{class:"loader"},null,-1)])))])])],512),[[_e,!C(G)]]),C(G)?(d(),i("section",Dt,[t("div",Mt,[t("div",St,[$(pe,{"is-showed-break":!0,type:"calendar-week",onSetWeek:O,onPaginateWeek:X,onToggleBreakMode:I}),c.value&&c.value.week?(d(),i("ul",Ct,[(d(!0),i(V,null,Q(c.value.week.days,(l,v)=>(d(),i("li",{key:v,class:"v-calendar-week-mob__list-item"},[l?(d(),i("div",Lt,[t("div",Bt,[t("p",qt,k(F(l.day)),1),s[3]||(s[3]=t("svg",{class:"opacity-50",width:"20",height:"20",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[t("path",{d:"M4.66663 11.3333L11.3333 4.66663M11.3333 4.66663H4.66663M11.3333 4.66663V11.3333",stroke:"#717680","stroke-width":"1.67","stroke-linecap":"round","stroke-linejoin":"round"})],-1))]),(d(!0),i(V,null,Q(l.lessons,r=>(d(),i("div",{class:"day__content",key:r.id},[t("div",{class:L(["day__lesson",{trial:r.trial}])},[s[5]||(s[5]=t("h4",{class:"day__lesson-name"}," Петров ",-1)),t("div",Wt,[t("p",null,k(r.start_time),1),s[4]||(s[4]=t("p",null,"-",-1)),t("p",null,k(r.end_time),1)]),t("div",Tt,k(r.student_name),1)],2)]))),128))])):m("",!0)]))),128))])):m("",!0)])])])):m("",!0)]),_:1}),$(Ve,{ref_key:"modalsContainer",ref:D},null,512)],64))}},Pt=Object.freeze(Object.defineProperty({__proto__:null,default:Et},Symbol.toStringTag,{value:"Module"}));export{pe as _,Et as a,Pt as v};

import{r as k,u as O,o as j,a as s,b as v,e as L,d as t,F as D,f as w,g as h,w as q,i as n,t as d,j as G,k as U,l as A}from"./index-B7C430aU.js";import{u as J,_ as K,a as Q}from"./useIsMobile-B0t24SC2.js";import{_ as X,v as Y}from"./v-header-BxzqzGvH.js";import{d as u}from"./daypilot-vue.min-BYBTTwO7.js";const Z={class:"wrapper"},ee={key:0},te={class:"v-calendar-week"},ae={class:"v-calendar-week__container container"},se={key:0,class:"v-calendar-week__content scroll-container"},ne={class:"v-calendar-week__table calendar"},oe={class:"calendar-header"},re={key:0,class:"calendar-row"},de=["onDrop"],le={class:"calendar-row__item-content calendar-card"},ie=["onClick","onDragstart"],ce={key:0,class:"calendar-card__break"},_e={key:1,class:"v-calendar-week__break scroll-container"},ue=["onClick"],me={class:"event-header"},ke={class:"calendar-card__content"},ve={class:"calendar-card__lesson"},ge={key:0,class:"calendar-card__break"},be=10,H=90,we={__name:"v-calendar-week",setup(he){const{isMobile:R}=J(),_=k(localStorage.getItem("breakMode")==="true"),f=k(),B={viewType:"Week",startDate:u.DayPilot.Date.today(),eventResizeHandling:"Disabled",timeRangeSelectedHandling:"Disabled",locale:"ru-RU",headerDateFormat:"ddd, d",allowEventOverlap:!1,touch:!0,onEventMoved:o=>{console.log("Event moved",o)},onEventResized:o=>{console.log("Event resized")}},S=async()=>{f.value=[{lesson_id:312,student_name:"Артур",start_time:"12:30",end_time:"13:00",start:u.DayPilot.Date.today().addHours(10).toString(),end:u.DayPilot.Date.today().addHours(14).toString(),duration:1,break:{break_id:1,duration:"15 минут"}},{lesson_id:316,student_name:"Тимур",start_time:"14:00",start:u.DayPilot.Date.today().addHours(15).toString(),end:u.DayPilot.Date.today().addHours(16).toString(),end_time:"15:00",duration:1}]},P=k([{title:"пн",number:20},{title:"вт",number:21},{title:"ср",number:22},{title:"чт",number:23},{title:"пт",number:24},{title:"сб",number:25},{title:"вс",number:26}]),M=O("modalsContainer"),g=k({week:{start_date:"20.01.2025",end_date:"26.01.2025",days:{1:{lessons:[]},2:{lessons:[{lesson_id:312,student_name:"Артур",start_time:"12:30:00",end_time:"13:00:00",break:{break_id:1,duration:"15 минут"}},{lesson_id:316,student_name:"Тимур",start_time:"14:00:00",end_time:"15:00:00"}]},3:{lessons:[]},4:{lessons:[{lesson_id:314,student_name:"Артур",start_time:"14:00:00",end_time:"15:00:00",break:{break_id:2,duration:"60 минут"}},{lesson_id:317,student_name:"Артур",start_time:"16:00:00",end_time:"17:00:00",break:{break_id:3,duration:"60 минут"}},{lesson_id:318,student_name:"Артур",start_time:"18:00:00",end_time:"19:00:00"}]},5:{lessons:[]},6:{lessons:[]},7:{lessons:[]}}}}),$=A(),p=k({lesson:null,fromColumnIndex:null,fromLessonIndex:null}),T=(o,c,e,r)=>{p.value={lesson:c,fromColumnIndex:e,fromLessonIndex:r}},z=(o,c)=>{const{lesson:e,fromColumnIndex:r,fromLessonIndex:a}=p.value;if(r!==c){const y=g.value.week.days[r].lessons,i=g.value.week.days[c].lessons,m=l=>{const[b,I]=l.split(":").map(Number);return b*60+I},x=m(e.start_time),W=m(e.end_time);for(let l of i){const b=m(l.start_time);if(!(m(l.end_time)<=x||b>=W)){alert("В этот день уже есть занятие на данное время");return}}let E=i.length;for(let l=0;l<i.length;l++)if(m(i[l].start_time)>x){E=l;break}y.splice(a,1),i.splice(E,0,e)}p.value={lesson:null,fromColumnIndex:null,fromLessonIndex:null}},F=()=>{_.value=!_.value,localStorage.setItem("breakMode",_.value),_.value?S():f.value=[]},C=o=>{M.value.toggleLessonModals("buttons",o)},N=o=>Math.max(H,H*o),V=o=>{$.push({query:{start_date:o}})};return j(()=>{_.value&&S()}),(o,c)=>(n(),s("div",Z,[v(X),L(R)?h("",!0):(n(),s("main",ee,[t("section",te,[t("div",ae,[v(K,{"is-showed-break":!0,type:"week",onSetWeek:V,onToggleBreakMode:F}),_.value?(n(),s("div",_e,[v(L(u.DayPilotCalendar),{config:B,events:f.value,ref:"calendarRef"},{event:q(({event:e})=>[t("div",{class:"event",onClick:r=>C(e.data)},[t("div",me,[t("div",ke,[t("div",ve,[t("p",null,d(e.data.start_time)+" - "+d(e.data.end_time),1),t("p",null,d(e.data.student_name),1)]),e.data.break?(n(),s("div",ge,d(e.data.break.duration),1)):h("",!0)])])],8,ue)]),_:1},8,["events"])])):(n(),s("div",se,[t("table",ne,[t("thead",null,[t("tr",oe,[(n(!0),s(D,null,w(P.value,(e,r)=>(n(),s("th",{class:"calendar-header__item",key:r},d(e.title)+", "+d(e.number),1))),128))])]),t("tbody",null,[g.value.week?(n(),s("tr",re,[(n(!0),s(D,null,w(g.value.week.days,(e,r)=>(n(),s("td",{key:r,class:"calendar-row__item",onDragover:c[0]||(c[0]=G(()=>{},["prevent"])),onDrop:a=>z(a,r)},[t("div",le,[(n(!0),s(D,null,w(e.lessons,(a,y)=>(n(),s("div",{class:"calendar-card__content",key:a.lesson_id,onClick:i=>C(a),draggable:"true",onDragstart:i=>T(i,a,r,y)},[t("div",{class:"calendar-card__lesson",style:U({height:N(a.duration),gap:`${be*a.duration}px`})},[t("p",null,d(a.start_time)+" - "+d(a.end_time),1),t("p",null,d(a.student_name),1)],4),a.break?(n(),s("div",ce,d(a.break.duration),1)):h("",!0)],40,ie))),128))])],40,de))),128))])):h("",!0)])])]))])])])),v(Y),v(Q,{ref_key:"modalsContainer",ref:M},null,512)]))}};export{we as default};

import{r as y,u as U,c as W,o as G,a,b,d as e,e as H,F as m,f as v,w as K,g as p,h as Q,i as n,t as d,j as X,n as x,k as ee}from"./index-BgvZipAR.js";import{g as E,_ as se,a as te,b as ae,v as ne,t as oe}from"./v-header-Ca7z2lX5.js";import{u as le,_ as F,a as re,b as de,c as ce}from"./v-modals-container-DpJnJSYW.js";const _e={class:"wrapper"},ie={key:0,class:"v-calendar-month"},ue={class:"v-calendar-month__container container"},me={key:0,class:"v-calendar-month__content scroll-container"},ve={class:"v-calendar-month__table calendar"},he={class:"calendar-header"},ye=["onDrop"],pe={key:0,class:"calendar-row__item-content calendar-card"},ke={class:"calendar-card__num"},ge=["onClick","onDragstart"],be={class:"calendar-card__lesson"},fe={key:0,class:"calendar-card__lesson break"},Se={key:1,class:"loader-container"},we={key:1,class:"v-calendar-month-mob mob-page"},Le={class:"container"},Me={class:"v-calendar-month-mob__container"},$e={class:"v-calendar-month-mob__table calendar"},Ce={class:"calendar-header"},De=["onClick"],Ne={key:0,class:"calendar-row__item-content calendar-card"},Be={class:"calendar-card__num"},Oe={class:"calendar-card__content"},Ee={key:0,class:"calendar-card__lesson break"},Fe={key:0,class:"v-calendar-month-mob__info lesson-info"},Ie={class:"v-calendar-month-mob__day day"},qe={class:"day__header"},Je={class:"day__date"},Re={class:"day__lesson"},Ve={class:"day__lesson-time"},je={class:"day__lesson-name"},Ae={key:0,class:"day__lesson break"},Pe={class:"day__lesson-block"},Te={class:"day__lesson-time"},Ye={key:0},Ge={__name:"v-calendar-month",setup(Ze){const M=y([{days_week:"Пн",id:1},{days_week:"Вт",id:2},{days_week:"Ср",id:3},{days_week:"Чт",id:4},{days_week:"Пт",id:5},{days_week:"Сб",id:6},{days_week:"Вс",id:7}]),B=y(new Date),f=y(B.value.getMonth()+1),S=y(B.value.getFullYear()),I=ee(),c=y({}),i=y([]),$=y(),{isMobile:q}=le(),O=U("modalsContainer"),J=(o,s)=>{i.value[0]=parseInt(o),i.value[1]=s,localStorage.setItem("activeDay",JSON.stringify(i.value)),console.log(JSON.parse(localStorage.getItem("activeDay")))},R=(o,s,u,t,_)=>{$.value={lesson:s,fromColumnIndex:t,fromRowIndex:u,fromLessonIndex:_}},V=(o,s,u)=>{const{lesson:t,fromColumnIndex:_,fromRowIndex:l,fromLessonIndex:r}=$.value;if(_!==s||l!==u){const T=c.value.schedule[l][_].lessons,N=c.value.schedule[u][s].lessons,k=g=>{const[w,L]=g.split(":").map(Number);return w*60+L},Y=k(t.start_time),Z=k(t.end_time);for(let g of N){const w=k(g.start_time);if(!(k(g.end_time)<=Y||w>=Z)){alert("В этот день уже есть занятие на данное время");return}}T.splice(r,1),N.push(t),N.sort((g,w)=>{const L=k(g.start_time),z=k(w.start_time);return L-z})}const C=String(c.value.schedule[u][s].day),D={start_time:t.start_time+":001Z",end_time:t.end_time+":001Z",day_of_week_id:s,conducted_date:`${S.value}-${f.value}-${C.padStart(2,0)}`};oe(t.lesson_id,D).then(()=>{console.log("Выполнили")}),$.value=null},j=o=>{O.value.toggleLessonModals("buttons",o)},A=o=>{I.push({query:{selected_date:`${String(o.month+1).padStart(2,"0")}.${o.year}`}}),f.value=o.month,S.value=o.year,console.log(o.year,o.month+1),E(o.year,o.month+1).then(s=>{c.value=s})},P=()=>{const o=new URLSearchParams(window.location.search),s=Object.fromEntries(o.entries());console.log("в функции"),"selected_date"in s?(f.value=s.selected_date.split(".")[0],S.value=s.selected_date.split(".")[1]):window.location.search=`?selected_date=${String(f.value).padStart(2,0)}.${S.value}`,E(S.value,parseInt(f.value)).then(u=>{c.value=u})},h=W(()=>{if(i.value.length&&c.value.schedule){const o=c.value.schedule[i.value[0]];if(o)return o[i.value[1]]}return null});return G(()=>{P(),i.value=JSON.parse(localStorage.getItem("activeDay"))||[]}),(o,s)=>{const u=Q("router-link");return n(),a("div",_e,[b(se),e("main",null,[H(q)?(n(),a("section",we,[e("div",Le,[e("div",Me,[b(F,{type:"month"}),e("table",$e,[e("thead",null,[e("tr",Ce,[(n(!0),a(m,null,v(M.value,t=>(n(),a("th",{class:"calendar-header__item",key:t.id},d(t.days_week),1))),128))])]),e("tbody",null,[(n(!0),a(m,null,v(c.value.schedule,(t,_)=>(n(),a("tr",{class:"calendar-row",key:_},[(n(),a(m,null,v(7,l=>e("td",{class:x(["calendar-row__item",{active:_==i.value[0]&&l==i.value[1]}]),onClick:r=>J(_,l),key:l},[t[l]?(n(),a("div",Ne,[e("div",Be,d(t[l].day),1),e("div",Oe,[(n(!0),a(m,null,v(t[l].lessons,r=>(n(),a("div",{class:"calendar-card__lesson",key:r.lesson_id}))),128)),t[l].breaks&&t[l].breaks[o.lesson.lesson_id]?(n(),a("div",Ee)):p("",!0)])])):p("",!0)],10,De)),64))]))),128))])])]),h.value?(n(),a("div",Fe,[b(u,{to:{name:"calendar-day"}},{default:K(()=>[e("div",Ie,[e("div",qe,[e("p",Je,d(h.value.day),1),s[2]||(s[2]=e("img",{src:te,class:"day-el",alt:""},null,-1)),s[3]||(s[3]=e("img",{src:ae,class:"night-el",alt:""},null,-1))]),(n(!0),a(m,null,v(h.value.lessons,t=>(n(),a("div",{class:"day__content",key:t.id},[e("div",Re,[e("div",Ve,[s[4]||(s[4]=e("div",{class:"day__lesson-circle"},null,-1)),e("p",null,d(t.start_time),1),s[5]||(s[5]=e("p",null,"-",-1)),e("p",null,d(t.end_time),1)]),e("div",je,d(t.student_name),1)]),h.value.breaks&&h.value.breaks[t.lesson_id]?(n(),a("div",Ae,[e("div",Pe,[s[7]||(s[7]=e("img",{src:re,class:"day-el",alt:""},null,-1)),s[8]||(s[8]=e("img",{src:de,class:"night-el",alt:""},null,-1)),e("div",Te,[e("p",null,d(h.value.breaks[t.lesson_id].start_time),1),s[6]||(s[6]=e("p",null,"-",-1)),e("p",null,d(h.value.breaks[t.lesson_id].end_time),1)])]),s[9]||(s[9]=e("div",{class:"day__lesson-name"},"Перерыв",-1))])):p("",!0)]))),128)),h.value.lessons.length?p("",!0):(n(),a("div",Ye,s[10]||(s[10]=[e("h2",{class:"title pb-7"},"В этот день у вас нет уроков",-1)])))])]),_:1})])):p("",!0)])])):(n(),a("section",ie,[e("div",ue,[b(F,{type:"month",onSetMonth:A}),c.value.schedule&&M.value?(n(),a("div",me,[e("table",ve,[e("thead",null,[e("tr",he,[(n(!0),a(m,null,v(M.value,t=>(n(),a("th",{class:"calendar-header__item",key:t.id},d(t.days_week),1))),128))])]),e("tbody",null,[(n(!0),a(m,null,v(c.value.schedule,(t,_)=>(n(),a("tr",{class:"calendar-row",key:_},[(n(),a(m,null,v(7,l=>e("td",{class:"calendar-row__item",key:l,onDragover:s[0]||(s[0]=X(()=>{},["prevent"])),onDrop:r=>V(r,l,_)},[t[l]?(n(),a("div",pe,[e("div",ke,d(t[l].day),1),(n(!0),a(m,null,v(t[l].lessons,(r,C)=>(n(),a("div",{class:"calendar-card__content",key:r.lesson_id,onClick:()=>j(r),draggable:"true",onDragstart:D=>R(D,r,_,l,C)},[e("div",be,d(r.start_time)+" - "+d(r.end_time)+" "+d(r.student_name),1),c.value.breaks&&c.value.breaks[r.lesson_id]?(n(),a("div",fe,d(c.value.breaks[r.lesson_id].start_time)+" - "+d(c.value.breaks[r.lesson_id].end_time)+" "+d(r.student_name),1)):p("",!0)],40,ge))),128))])):p("",!0)],40,ye)),64))]))),128))])])])):(n(),a("div",Se,s[1]||(s[1]=[e("div",{class:"loader"},null,-1)])))])]))]),b(ce,{ref_key:"modalsContainer",ref:O},null,512),b(ne)])}}};export{Ge as default};

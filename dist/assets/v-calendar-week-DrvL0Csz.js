import{r as y,u as j,o as q,a,b as u,d as e,e as R,F as g,f as b,g as p,w as G,i as n,t as r,j as U,k as A,l as J}from"./index-CkjInQhv.js";import{_ as K,a as Q,b as X,v as Y}from"./v-header-BIt_ad7y.js";import{u as Z,_ as x,a as ee,b as te,c as se}from"./useIsMobile-B2_vk4Cw.js";import{d as m}from"./daypilot-vue.min-DsmjEuIk.js";const ae={class:"wrapper"},ne={key:0,class:"v-calendar-week"},oe={class:"v-calendar-week__container container"},le={key:0,class:"v-calendar-week__content scroll-container"},re={class:"v-calendar-week__table calendar"},de={class:"calendar-header"},ie={key:0,class:"calendar-row"},_e=["onDrop"],ce={class:"calendar-row__item-content calendar-card"},ue=["onClick","onDragstart"],me={key:0,class:"calendar-card__break"},ve={key:1,class:"v-calendar-week__break scroll-container"},ke=["onClick"],ye={class:"event-header"},ge={class:"calendar-card__content"},be={class:"calendar-card__lesson"},pe={key:0,class:"calendar-card__break"},fe={key:1,class:"v-calendar-menu-mob-week"},he={class:"v-calendar-menu-mob-week__container"},we={class:"v-calendar-menu-mob-week__list"},De={class:"day__header"},Le={class:"day__date"},Se={class:"day__lesson"},Me={class:"day__lesson-time"},Ce={class:"day__lesson-name"},Ee={key:0,class:"day__lesson break"},Ie={class:"day__lesson-block"},He={class:"day__lesson-time"},Be={key:0},Re=10,P=90,ze={__name:"v-calendar-week",setup(xe){const{isMobile:T}=Z(),c=y(localStorage.getItem("breakMode")==="true"),h=y(),$={viewType:"Week",startDate:m.DayPilot.Date.today(),eventResizeHandling:"Disabled",timeRangeSelectedHandling:"Disabled",locale:"ru-RU",headerDateFormat:"ddd, d",allowEventOverlap:!1,touch:!0,onEventMoved:l=>{console.log("Event moved",l)},onEventResized:l=>{console.log("Event resized")}},L=async()=>{h.value=[{lesson_id:312,student_name:"Артур",start_time:"12:30",end_time:"13:00",start:m.DayPilot.Date.today().addHours(10).toString(),end:m.DayPilot.Date.today().addHours(14).toString(),duration:1,break:{break_id:1,duration:"15 минут"}},{lesson_id:316,student_name:"Тимур",start_time:"14:00",start:m.DayPilot.Date.today().addHours(15).toString(),end:m.DayPilot.Date.today().addHours(16).toString(),end_time:"15:00",duration:1}]},W=y([{title:"пн",number:20},{title:"вт",number:21},{title:"ср",number:22},{title:"чт",number:23},{title:"пт",number:24},{title:"сб",number:25},{title:"вс",number:26}]),S=j("modalsContainer"),v=y({week:{start_date:"20.01.2025",end_date:"26.01.2025",days:{1:{lessons:[]},2:{lessons:[{lesson_id:312,student_name:"Артур",start_time:"12:30:00",end_time:"13:00:00",break:{break_id:1,duration:"15 минут"}},{lesson_id:316,student_name:"Тимур",start_time:"14:00:00",end_time:"15:00:00"}]},3:{lessons:[]},4:{lessons:[{lesson_id:314,student_name:"Артур",start_time:"14:00:00",end_time:"15:00:00",break:{break_id:2,duration:"60 минут"}},{lesson_id:317,student_name:"Артур",start_time:"16:00:00",end_time:"17:00:00",break:{break_id:3,duration:"60 минут"}},{lesson_id:318,student_name:"Артур",start_time:"18:00:00",end_time:"19:00:00"}]},5:{lessons:[]},6:{lessons:[]},7:{lessons:[]}}}}),z=J(),w=y({lesson:null,fromColumnIndex:null,fromLessonIndex:null}),F=(l,t,s,o)=>{w.value={lesson:t,fromColumnIndex:s,fromLessonIndex:o}},N=(l,t)=>{const{lesson:s,fromColumnIndex:o,fromLessonIndex:d}=w.value;if(o!==t){const D=v.value.week.days[o].lessons,_=v.value.week.days[t].lessons,k=i=>{const[f,B]=i.split(":").map(Number);return f*60+B},I=k(s.start_time),O=k(s.end_time);for(let i of _){const f=k(i.start_time);if(!(k(i.end_time)<=I||f>=O)){alert("В этот день уже есть занятие на данное время");return}}let H=_.length;for(let i=0;i<_.length;i++)if(k(_[i].start_time)>I){H=i;break}D.splice(d,1),_.splice(H,0,s)}w.value={lesson:null,fromColumnIndex:null,fromLessonIndex:null}},M=()=>{c.value=!c.value,localStorage.setItem("breakMode",c.value),c.value?L():h.value=[]},C=l=>{S.value.toggleLessonModals("buttons",l)},V=l=>Math.max(P,P*l),E=l=>{z.push({query:{start_date:l}})};return q(()=>{c.value&&L()}),(l,t)=>(n(),a("div",ae,[u(K),e("main",null,[R(T)?(n(),a("section",fe,[e("div",he,[u(x,{"is-showed-break":!0,type:"week",onSetWeek:E,onToggleBreakMode:M}),e("ul",we,[(n(!0),a(g,null,b(v.value.week.lessons,s=>(n(),a("li",{class:"v-calendar-menu-mob-week__list-item day",key:s.id},[e("div",De,[e("p",Le,r(l.activeDayLessons.day),1),t[1]||(t[1]=e("img",{src:Q,class:"day-el",alt:""},null,-1)),t[2]||(t[2]=e("img",{src:X,class:"night-el",alt:""},null,-1))]),(n(!0),a(g,null,b(s.lessons,o=>(n(),a("div",{class:"day__content",key:o.id},[e("div",Se,[e("div",Me,[t[3]||(t[3]=e("div",{class:"day__lesson-circle"},null,-1)),e("p",null,r(o.start_time),1),t[4]||(t[4]=e("p",null,"-",-1)),e("p",null,r(o.end_time),1)]),e("div",Ce,r(o.student_name),1)]),l.activeDayLessons.breaks&&l.activeDayLessons.breaks[o.lesson_id]?(n(),a("div",Ee,[e("div",Ie,[t[6]||(t[6]=e("img",{src:ee,class:"day-el",alt:""},null,-1)),t[7]||(t[7]=e("img",{src:te,class:"night-el",alt:""},null,-1)),e("div",He,[e("p",null,r(l.activeDayLessons.breaks[o.lesson_id].start_time),1),t[5]||(t[5]=e("p",null,"-",-1)),e("p",null,r(l.activeDayLessons.breaks[o.lesson_id].end_time),1)])]),t[8]||(t[8]=e("div",{class:"day__lesson-name"},"Перерыв",-1))])):p("",!0)]))),128)),l.activeDayLessons.lessons.length?p("",!0):(n(),a("div",Be,t[9]||(t[9]=[e("h2",{class:"title pb-7"},"В этот день у вас нет уроков",-1)])))]))),128))])])])):(n(),a("section",ne,[e("div",oe,[u(x,{"is-showed-break":!0,type:"week",onSetWeek:E,onToggleBreakMode:M}),c.value?(n(),a("div",ve,[u(R(m.DayPilotCalendar),{config:$,events:h.value,ref:"calendarRef"},{event:G(({event:s})=>[e("div",{class:"event",onClick:o=>C(s.data)},[e("div",ye,[e("div",ge,[e("div",be,[e("p",null,r(s.data.start_time)+" - "+r(s.data.end_time),1),e("p",null,r(s.data.student_name),1)]),s.data.break?(n(),a("div",pe,r(s.data.break.duration),1)):p("",!0)])])],8,ke)]),_:1},8,["events"])])):(n(),a("div",le,[e("table",re,[e("thead",null,[e("tr",de,[(n(!0),a(g,null,b(W.value,(s,o)=>(n(),a("th",{class:"calendar-header__item",key:o},r(s.title)+", "+r(s.number),1))),128))])]),e("tbody",null,[v.value.week?(n(),a("tr",ie,[(n(!0),a(g,null,b(v.value.week.days,(s,o)=>(n(),a("td",{key:o,class:"calendar-row__item",onDragover:t[0]||(t[0]=U(()=>{},["prevent"])),onDrop:d=>N(d,o)},[e("div",ce,[(n(!0),a(g,null,b(s.lessons,(d,D)=>(n(),a("div",{class:"calendar-card__content",key:d.lesson_id,onClick:_=>C(d),draggable:"true",onDragstart:_=>F(_,d,o,D)},[e("div",{class:"calendar-card__lesson",style:A({height:V(d.duration),gap:`${Re*d.duration}px`})},[e("p",null,r(d.start_time)+" - "+r(d.end_time),1),e("p",null,r(d.student_name),1)],4),d.break?(n(),a("div",me,r(d.break.duration),1)):p("",!0)],40,ue))),128))])],40,_e))),128))])):p("",!0)])])]))])]))]),u(Y),u(se,{ref_key:"modalsContainer",ref:S},null,512)]))}};export{ze as default};

import{r as v,u as V,o as O,a as s,b as k,e as L,d as t,F as y,f as D,w as W,g as w,i as n,t as r,j,k as G}from"./index-DzmL5RbY.js";import{u as U,_ as q,a as A}from"./useIsMobile-Czn4nfK-.js";import{_ as J,v as K}from"./v-header-BlTfSyKl.js";import{d as u}from"./daypilot-vue.min-DLJoI6lR.js";const Q={class:"wrapper"},X={key:0},Y={class:"v-calendar-week"},Z={class:"v-calendar-week__container container"},ee={key:0,class:"v-calendar-week__content scroll-container"},te={class:"v-calendar-week__table calendar"},ae={class:"calendar-header"},se={class:"calendar-row"},ne=["onDrop"],oe={class:"calendar-row__item-content calendar-card"},re=["onClick","onDragstart"],de={key:0,class:"calendar-card__break"},le={key:1,class:"v-calendar-week__break scroll-container"},ie=["onClick"],ce={class:"event-header"},_e={class:"calendar-card__content"},ue={class:"calendar-card__lesson"},me={key:0,class:"calendar-card__break"},ve=10,H=90,pe={__name:"v-calendar-week",setup(ke){const{isMobile:B}=U(),_=v(localStorage.getItem("breakMode")==="true"),b=v(),P={viewType:"Week",startDate:u.DayPilot.Date.today(),eventResizeHandling:"Disabled",timeRangeSelectedHandling:"Disabled",locale:"ru-RU",headerDateFormat:"ddd, d",allowEventOverlap:!1,touch:!0,onEventMoved:d=>{console.log("Event moved",d)},onEventResized:d=>{console.log("Event resized")}},M=async()=>{b.value=[{lesson_id:312,student_name:"Артур",start_time:"12:30",end_time:"13:00",start:u.DayPilot.Date.today().addHours(10).toString(),end:u.DayPilot.Date.today().addHours(14).toString(),duration:1,break:{break_id:1,duration:"15 минут"}},{lesson_id:316,student_name:"Тимур",start_time:"14:00",start:u.DayPilot.Date.today().addHours(15).toString(),end:u.DayPilot.Date.today().addHours(16).toString(),end_time:"15:00",duration:1}]},R=v([{title:"пн",number:20},{title:"вт",number:21},{title:"ср",number:22},{title:"чт",number:23},{title:"пт",number:24},{title:"сб",number:25},{title:"вс",number:26}]),S=V("modalsContainer"),f=v({week:{start_date:"20.01.2025",end_date:"26.01.2025",days:{1:{lessons:[]},2:{lessons:[{lesson_id:312,student_name:"Артур",start_time:"12:30:00",end_time:"13:00:00",break:{break_id:1,duration:"15 минут"}},{lesson_id:316,student_name:"Тимур",start_time:"14:00:00",end_time:"15:00:00"}]},3:{lessons:[]},4:{lessons:[{lesson_id:314,student_name:"Артур",start_time:"14:00:00",end_time:"15:00:00",break:{break_id:2,duration:"60 минут"}},{lesson_id:317,student_name:"Артур",start_time:"16:00:00",end_time:"17:00:00",break:{break_id:3,duration:"60 минут"}},{lesson_id:318,student_name:"Артур",start_time:"18:00:00",end_time:"19:00:00"}]},5:{lessons:[]},6:{lessons:[]},7:{lessons:[]}}}}),h=v({lesson:null,fromColumnIndex:null,fromLessonIndex:null}),$=(d,c,e,o)=>{h.value={lesson:c,fromColumnIndex:e,fromLessonIndex:o}},T=(d,c)=>{const{lesson:e,fromColumnIndex:o,fromLessonIndex:a}=h.value;if(o!==c){const p=f.value.week.days[o].lessons,i=f.value.week.days[c].lessons,m=l=>{const[g,I]=l.split(":").map(Number);return g*60+I},x=m(e.start_time),N=m(e.end_time);for(let l of i){const g=m(l.start_time);if(!(m(l.end_time)<=x||g>=N)){alert("В этот день уже есть занятие на данное время");return}}let E=i.length;for(let l=0;l<i.length;l++)if(m(i[l].start_time)>x){E=l;break}p.splice(a,1),i.splice(E,0,e)}h.value={lesson:null,fromColumnIndex:null,fromLessonIndex:null}},z=()=>{_.value=!_.value,localStorage.setItem("breakMode",_.value),_.value?M():b.value=[]},C=d=>{S.value.toggleLessonModals("buttons",d)},F=d=>Math.max(H,H*d);return O(()=>{_.value&&M()}),(d,c)=>(n(),s("div",Q,[k(J),L(B)?w("",!0):(n(),s("main",X,[t("section",Y,[t("div",Z,[k(q,{"is-showed-break":!0,type:"week",onToggleBreakMode:z}),_.value?(n(),s("div",le,[k(L(u.DayPilotCalendar),{config:P,events:b.value,ref:"calendarRef"},{event:W(({event:e})=>[t("div",{class:"event",onClick:o=>C(e.data)},[t("div",ce,[t("div",_e,[t("div",ue,[t("p",null,r(e.data.start_time)+" - "+r(e.data.end_time),1),t("p",null,r(e.data.student_name),1)]),e.data.break?(n(),s("div",me,r(e.data.break.duration),1)):w("",!0)])])],8,ie)]),_:1},8,["events"])])):(n(),s("div",ee,[t("table",te,[t("thead",null,[t("tr",ae,[(n(!0),s(y,null,D(R.value,(e,o)=>(n(),s("th",{class:"calendar-header__item",key:o},r(e.title)+", "+r(e.number),1))),128))])]),t("tbody",null,[t("tr",se,[(n(!0),s(y,null,D(f.value.week.days,(e,o)=>(n(),s("td",{key:o,class:"calendar-row__item",onDragover:c[0]||(c[0]=j(()=>{},["prevent"])),onDrop:a=>T(a,o)},[t("div",oe,[(n(!0),s(y,null,D(e.lessons,(a,p)=>(n(),s("div",{class:"calendar-card__content",key:a.lesson_id,onClick:i=>C(a),draggable:"true",onDragstart:i=>$(i,a,o,p)},[t("div",{class:"calendar-card__lesson",style:G({height:F(a.duration),gap:`${ve*a.duration}px`})},[t("p",null,r(a.start_time)+" - "+r(a.end_time),1),t("p",null,r(a.student_name),1)],4),a.break?(n(),s("div",de,r(a.break.duration),1)):w("",!0)],40,re))),128))])],40,ne))),128))])])])]))])])])),k(K),k(A,{ref_key:"modalsContainer",ref:S},null,512)]))}};export{pe as default};

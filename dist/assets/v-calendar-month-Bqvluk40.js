import{r as y,u as G,c as H,o as K,a,b as f,d as s,e as Q,F as m,f as h,w as X,g as p,h as x,i as n,t as c,j as ee,n as se,k as te,l as ae}from"./index-CAzfu9s5.js";import{g as N,_ as ne,a as oe,b as le,v as re,t as de}from"./v-header-Di5yUs8e.js";import{u as ce,_ as E,a as ie,b as _e,c as ue}from"./v-modals-container-BjdnUCfW.js";const ve={class:"wrapper"},me={key:0,class:"v-calendar-month"},he={class:"v-calendar-month__container container"},ye={key:0,class:"v-calendar-month__content scroll-container"},pe={class:"v-calendar-month__table calendar"},ge={class:"calendar-header"},ke=["onDrop"],fe={class:"calendar-row__item-container"},be={key:0,class:"calendar-row__item-content calendar-card"},Se={class:"calendar-card__num"},we=["onClick","onDragstart"],Me={class:"calendar-card__lesson"},Le={key:0,class:"calendar-card__lesson break"},De={key:1,class:"loader-container"},$e={key:1,class:"v-calendar-month-mob mob-page"},Ce={class:"container"},Ne={class:"v-calendar-month-mob__container"},Oe={class:"v-calendar-month-mob__table calendar"},Be={class:"calendar-header"},qe=["onClick"],Ee={key:0,class:"calendar-row__item-content calendar-card"},Fe={class:"calendar-card__num"},Pe={class:"calendar-card__content"},Je={key:0,class:"calendar-card__lesson break"},Re={key:0,class:"v-calendar-month-mob__info lesson-info"},Ve={class:"v-calendar-month-mob__day day"},je={class:"day__header"},Ae={class:"day__date"},Ie={class:"day__lesson"},Te={class:"day__lesson-time"},Ye={class:"day__lesson-name"},Ze={key:0,class:"day__lesson break"},ze={class:"day__lesson-block"},Ue={class:"day__lesson-time"},We={key:0},Xe={__name:"v-calendar-month",setup(Ge){const D=y([{days_week:"Пн",id:1},{days_week:"Вт",id:2},{days_week:"Ср",id:3},{days_week:"Чт",id:4},{days_week:"Пт",id:5},{days_week:"Сб",id:6},{days_week:"Вс",id:7}]),O=y(new Date),w=y(O.value.getMonth()+1),M=y(O.value.getFullYear()),F=te(),P=ae(),d=y({}),u=y([]),$=y(),{isMobile:J}=ce(),B=G("modalsContainer"),R=o=>{const e=P.query.selected_date;return`${String(o).padStart(2,0)}.${e}`},V=(o,e)=>{u.value[0]=parseInt(o),u.value[1]=e,localStorage.setItem("activeDay",JSON.stringify(u.value)),console.log(JSON.parse(localStorage.getItem("activeDay")))},j=(o,e,_,t,i)=>{$.value={lesson:e,fromColumnIndex:t,fromRowIndex:_,fromLessonIndex:i}},A=(o,e,_)=>{const{lesson:t,fromColumnIndex:i,fromRowIndex:l,fromLessonIndex:r}=$.value;if(i!==e||l!==_)if(!d.value.schedule[_][e])alert("Интерактивным способом вы можете переносить урок только в пределах месяца");else{console.log("в else");const C=d.value.schedule[l][i].lessons,b=d.value.schedule[_][e].lessons,g=k=>{const[S,L]=k.split(":").map(Number);return S*60+L},Z=g(t.start_time),z=g(t.end_time);for(let k of b){const S=g(k.start_time);if(!(g(k.end_time)<=Z||S>=z)){alert("В этот день уже есть занятие на данное время");return}}C.splice(r,1),b.push(t),b.sort((k,S)=>{const L=g(k.start_time),W=g(S.start_time);return L-W}),String(d.value.schedule[_][e].day);const U={day_of_week_id:e-1,start_time:"16:03:44.361Z",end_time:"17:03:44.361Z",conducted_date:"2025-02-04"};de(t.lesson_id,U).then(()=>{console.log("Выполнили")}),$.value=null}},I=o=>{B.value.toggleLessonModals("buttons",o)},T=o=>{console.log("Зашли"),F.push({query:{selected_date:`${String(o.month+1).padStart(2,"0")}.${o.year}`}}),w.value=o.month,M.value=o.year,console.log(o.year,o.month+1),N(o.year,o.month+1).then(e=>{d.value=e})},q=o=>{console.log("Зашли"),N(o.year,o.month).then(e=>{d.value=e,console.log(e)})},Y=()=>{const o=new URLSearchParams(window.location.search),e=Object.fromEntries(o.entries());console.log("в функции"),"selected_date"in e?(w.value=e.selected_date.split(".")[0],M.value=e.selected_date.split(".")[1]):window.location.search=`?selected_date=${String(w.value).padStart(2,0)}.${M.value}`,N(M.value,parseInt(w.value)).then(_=>{d.value=_})},v=H(()=>{if(u.value.length&&d.value.schedule){const o=d.value.schedule[u.value[0]];if(o)return o[u.value[1]]}return null});return K(()=>{Y(),u.value=JSON.parse(localStorage.getItem("activeDay"))||[]}),(o,e)=>{const _=x("router-link");return n(),a("div",ve,[f(ne),s("main",null,[Q(J)?(n(),a("section",$e,[s("div",Ce,[s("div",Ne,[f(E,{type:"month",onPaginateMonth:q}),s("table",Oe,[s("thead",null,[s("tr",Be,[(n(!0),a(m,null,h(D.value,t=>(n(),a("th",{class:"calendar-header__item",key:t.id},c(t.days_week),1))),128))])]),s("tbody",null,[(n(!0),a(m,null,h(d.value.schedule,(t,i)=>(n(),a("tr",{class:"calendar-row",key:i},[(n(),a(m,null,h(7,l=>s("td",{class:se(["calendar-row__item",{active:i==u.value[0]&&l==u.value[1]}]),onClick:r=>V(i,l),key:l},[t[l]?(n(),a("div",Ee,[s("div",Fe,c(t[l].day),1),s("div",Pe,[(n(!0),a(m,null,h(t[l].lessons,r=>(n(),a("div",{class:"calendar-card__lesson",key:r.lesson_id}))),128)),t[l].breaks&&t[l].breaks[o.lesson.lesson_id]?(n(),a("div",Je)):p("",!0)])])):p("",!0)],10,qe)),64))]))),128))])])]),v.value?(n(),a("div",Re,[f(_,{to:{name:"calendar-day",query:{date:R(v.value.day)}}},{default:X(()=>[s("div",Ve,[s("div",je,[s("p",Ae,c(v.value.day),1),e[2]||(e[2]=s("img",{src:oe,class:"day-el",alt:""},null,-1)),e[3]||(e[3]=s("img",{src:le,class:"night-el",alt:""},null,-1))]),(n(!0),a(m,null,h(v.value.lessons,t=>(n(),a("div",{class:"day__content",key:t.id},[s("div",Ie,[s("div",Te,[e[4]||(e[4]=s("div",{class:"day__lesson-circle"},null,-1)),s("p",null,c(t.start_time),1),e[5]||(e[5]=s("p",null,"-",-1)),s("p",null,c(t.end_time),1)]),s("div",Ye,c(t.student_name),1)]),v.value.breaks&&v.value.breaks[t.lesson_id]?(n(),a("div",Ze,[s("div",ze,[e[7]||(e[7]=s("img",{src:ie,class:"day-el",alt:""},null,-1)),e[8]||(e[8]=s("img",{src:_e,class:"night-el",alt:""},null,-1)),s("div",Ue,[s("p",null,c(v.value.breaks[t.lesson_id].start_time),1),e[6]||(e[6]=s("p",null,"-",-1)),s("p",null,c(v.value.breaks[t.lesson_id].end_time),1)])]),e[9]||(e[9]=s("div",{class:"day__lesson-name"},"Перерыв",-1))])):p("",!0)]))),128)),v.value.lessons.length?p("",!0):(n(),a("div",We,e[10]||(e[10]=[s("h2",{class:"title pb-7"},"В этот день у вас нет уроков",-1)])))])]),_:1},8,["to"])])):p("",!0)])])):(n(),a("section",me,[s("div",he,[f(E,{type:"month",onSetMonth:T,onPaginateMonth:q}),d.value.schedule&&D.value?(n(),a("div",ye,[s("table",pe,[s("thead",null,[s("tr",ge,[(n(!0),a(m,null,h(D.value,t=>(n(),a("th",{class:"calendar-header__item",key:t.id},c(t.days_week),1))),128))])]),s("tbody",null,[(n(!0),a(m,null,h(d.value.schedule,(t,i)=>(n(),a("tr",{class:"calendar-row",key:i},[(n(),a(m,null,h(7,l=>s("td",{class:"calendar-row__item",key:l,onDragover:e[0]||(e[0]=ee(()=>{},["prevent"])),onDrop:r=>A(r,l,i)},[s("div",fe,[t[l]?(n(),a("div",be,[s("div",Se,c(t[l].day),1),(n(!0),a(m,null,h(t[l].lessons,(r,C)=>(n(),a("div",{class:"calendar-card__content",key:r.lesson_id,onClick:()=>I(r),draggable:"true",onDragstart:b=>j(b,r,i,l,C)},[s("div",Me,c(r.start_time)+" - "+c(r.end_time)+" "+c(r.student_name),1),d.value.breaks&&d.value.breaks[r.lesson_id]?(n(),a("div",Le,c(d.value.breaks[r.lesson_id].start_time)+" - "+c(d.value.breaks[r.lesson_id].end_time)+" "+c(r.student_name),1)):p("",!0)],40,we))),128))])):p("",!0)])],40,ke)),64))]))),128))])])])):(n(),a("div",De,e[1]||(e[1]=[s("div",{class:"loader"},null,-1)])))])]))]),f(ue,{ref_key:"modalsContainer",ref:B},null,512),f(re)])}}};export{Xe as default};

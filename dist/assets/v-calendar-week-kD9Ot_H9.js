import{r as m,u as ne,o as oe,a as l,b as k,d as a,e as U,w,T as L,g as _,m as le,F as h,f as b,l as re,i as o,t as i,j as de,n as ie,p as ce,k as _e,h as ue}from"./index-CQSsgW6I.js";import{f as me,c as x,d as ve,e as ke,h as ye,_ as fe,a as pe,b as ge,v as we,t as he}from"./v-header-GdKTnw4W.js";import{u as be,_ as j,a as De,b as Se,c as $e}from"./v-modals-container-X9hnWvU9.js";import{d as Te}from"./daypilot-vue.min-DOe6XYKP.js";const Me={class:"wrapper"},Ce={key:0,class:"v-calendar-week"},Ee={class:"v-calendar-week__container container"},Le={key:0,class:"v-calendar-week__content scroll-container"},xe={key:0,class:"v-calendar-week__table calendar"},Ie={class:"calendar-header"},We={key:0,class:"calendar-row"},Be=["onDrop"],Oe={class:"calendar-row__item-content calendar-card"},Re=["onClick","onDragstart"],qe={key:0,class:"calendar-card__break"},ze={key:1,class:"v-calendar-week__break scroll-container"},Fe=["onClick"],Ne={class:"event-header"},He={class:"calendar-card__content"},Pe={class:"calendar-card__lesson"},Ve={key:0,class:"calendar-card__break"},Ue={key:2,class:"loader-container"},je={key:1,class:"v-calendar-week-mob mob-page"},Ge={class:"v-calendar-week-mob__container container"},Ae={key:0,class:"v-calendar-week-mob__list"},Je={key:0,class:"day"},Ke=["onClick"],Qe={class:"day__date"},Xe={key:0},Ye={class:"day__lesson"},Ze={class:"day__lesson-time"},et={class:"day__lesson-name"},tt={key:0,class:"day__lesson break"},at={class:"day__lesson-block"},st={class:"day__lesson-time"},nt={key:0,class:"title pb-4"},ot=10,G=90,_t={__name:"v-calendar-week",setup(lt){const{isMobile:A}=be(),y=m({}),J=_e(),I=re(),p=m(localStorage.getItem("breakMode")==="true"),$=m(),T=m(me(new Date)),W=m(I.query.start_date||"01.12.2025"),B=m({viewType:"Week",cellDuration:15,startDate:x(W.value),allowEventOverlap:!1,eventResizeHandling:"Disabled",timeRangeSelectedHandling:"Disabled",locale:"ru-RU",headerDateFormat:"ddd, d",touch:!0,weekStarts:1,onEventMoved:t=>{console.log("Event moved",t);const e=t.newStart.value,d=t.newStart.value,r=new Date(e).getDay(),n={start_time:e,end_time:d,day_of_week:r-1},u=t.e.data.lesson_id;console.log(n,u)},onEventResized:t=>{console.log("Event resized")}}),K=async t=>{const e=[];if(t)for(let d in t.week.days)t.week.days[d].lessons.forEach(s=>{const{start_time:r,end_time:n,...u}=s,f=`${t.week.days[d].day} ${r}`.replace(/(\d{2})\.(\d{2})\.(\d{4})/,"$3-$2-$1T").replace(" ",""),E=`${t.week.days[d].day} ${n}`.replace(/(\d{2})\.(\d{2})\.(\d{4})/,"$3-$2-$1T").replace(" ","");e.push({start:f,end:E,start_time:r.slice(0,5),end_time:n.slice(0,5),...u})});console.log(e),$.value=e},M=m({0:{day_of_week:"пн",date:""},1:{day_of_week:"вт",date:""},2:{day_of_week:"ср",date:""},3:{day_of_week:"чт",date:""},4:{day_of_week:"пт",date:""},5:{day_of_week:"сб",date:""},6:{day_of_week:"вс",date:""}}),O=ne("modalsContainer"),c=m(),R=m({}),C=m({lesson:null,fromColumnIndex:null,fromLessonIndex:null}),Q=(t,e,d,s)=>{C.value={lesson:e,fromColumnIndex:d,fromLessonIndex:s}},q=t=>t.slice(0,5),X=(t,e)=>{const{lesson:d,fromColumnIndex:s,fromLessonIndex:r}=C.value;if(s!==e){const n=c.value.week.days[s].lessons,u=c.value.week.days[e].lessons,f=M.value[e].date.toISOString().split("T")[0],E={day_of_week_id:parseInt(e),start_time:d.start_time,end_time:d.end_time,conducted_date:f},g=v=>{const[S,V]=v.split(":").map(Number);return S*60+V},H=g(d.start_time),se=g(d.end_time);for(let v of u){const S=g(v.start_time);if(!(g(v.end_time)<=H||S>=se)){alert("В этот день уже есть занятие на данное время");return}}let P=u.length;for(let v=0;v<u.length;v++)if(g(u[v].start_time)>H){P=v;break}n.splice(r,1),u.splice(P,0,d),he(d.lesson_id,E).then(()=>{console.log("Перенос осуществлен")})}C.value={lesson:null,fromColumnIndex:null,fromLessonIndex:null}},Y=t=>t===T.value,z=()=>{p.value=!p.value,localStorage.setItem("breakMode",p.value),D()},Z=()=>{D()},ee=(t,e)=>{if(e==T.value){y.value[t]=!1,T.value="";return}if(!(t in y.value)){y.value[t]=!0;return}y.value[t]=!y.value[t]},F=t=>{O.value.toggleLessonModals("buttons",t)},te=t=>Math.max(G,G*t),N=t=>{J.push({query:{start_date:t}}).then(()=>{D()})},ae=t=>{const[e,d,s]=t.split(".").map(Number);let r=new Date(s,d-1,e);return r=r.getDay()||7,M.value[r-1].date=new Date(s,d-1,e),`${M.value[r-1].day_of_week}, ${e}`},D=()=>{const t=I.query;if("start_date"in t)W.value=x(t.start_date),B.value.startDate=x(t.start_date),ve(t.start_date).then(e=>{console.log("Загружаем"),K(e),R.value=e,c.value=e});else{const e=ke(new Date);window.location.search=`?start_date=${ye(e)}`}console.log(R.value)};return oe(()=>{D()}),(t,e)=>{const d=ue("router-link");return o(),l("div",Me,[k(fe),a("main",null,[U(A)?(o(),l("section",je,[a("div",Ge,[k(j,{"is-showed-break":!0,type:"week",onSetWeek:N,onToggleBreakMode:z}),c.value&&c.value.week?(o(),l("ul",Ae,[(o(!0),l(h,null,b(c.value.week.days,(s,r)=>(o(),l("li",{key:r,class:"v-calendar-week-mob__list-item"},[s?(o(),l("div",Je,[a("div",{class:"day__header",onClick:n=>ee(r,s.day)},[a("p",Qe,i(s.day),1),e[2]||(e[2]=a("img",{src:pe,class:"day-el",alt:""},null,-1)),e[3]||(e[3]=a("img",{src:ge,class:"night-el",alt:""},null,-1))],8,Ke),k(L,{name:"fade"},{default:w(()=>[y.value[r]||Y(s.day)?(o(),l("div",Xe,[k(d,{to:{name:"calendar-day",query:{date:s.day}}},{default:w(()=>[(o(!0),l(h,null,b(s.lessons,(n,u)=>(o(),l("div",{class:"day__content",key:n.id},[a("div",Ye,[a("div",Ze,[e[4]||(e[4]=a("div",{class:"day__lesson-circle"},null,-1)),a("p",null,i(n.start_time),1),e[5]||(e[5]=a("p",null,"-",-1)),a("p",null,i(n.end_time),1)]),a("div",et,i(n.student_name),1)]),n.breaks?(o(),l("div",tt,[a("div",at,[e[7]||(e[7]=a("img",{src:De,class:"day-el",alt:""},null,-1)),e[8]||(e[8]=a("img",{src:Se,class:"night-el",alt:""},null,-1)),a("div",st,[a("p",null,i(n.breaks.start_time),1),e[6]||(e[6]=a("p",null,"-",-1)),a("p",null,i(n.breaks.end_time),1)])]),e[9]||(e[9]=a("div",{class:"day__lesson-name"},"Перерыв",-1))])):_("",!0)]))),128))]),_:2},1032,["to"]),s.lessons.length?_("",!0):(o(),l("div",nt," В этот день у вас нет уроков! "))])):_("",!0)]),_:2},1024)])):_("",!0)]))),128))])):_("",!0)])])):(o(),l("section",Ce,[a("div",Ee,[k(j,{"is-showed-break":!0,type:"week",onSetWeek:N,onPaginateWeek:Z,onToggleBreakMode:z}),!p.value&&c.value?(o(),l("div",Le,[k(L,{name:"fade"},{default:w(()=>[c.value?(o(),l("table",xe,[a("thead",null,[a("tr",Ie,[(o(!0),l(h,null,b(c.value.week.days,(s,r)=>(o(),l("th",{class:"calendar-header__item",key:r},i(ae(s.day)),1))),128))])]),a("tbody",null,[k(L,{name:"fade"},{default:w(()=>[c.value&&c.value.week?(o(),l("tr",We,[(o(!0),l(h,null,b(c.value.week.days,(s,r)=>(o(),l("td",{key:r,class:"calendar-row__item",onDragover:e[0]||(e[0]=de(()=>{},["prevent"])),onDrop:n=>X(n,r)},[a("div",Oe,[(o(!0),l(h,null,b(s.lessons,(n,u)=>(o(),l("div",{class:ie(["calendar-card__content",{completed:n.completed}]),key:n.lesson_id,onClick:f=>F(n),draggable:"true",onDragstart:f=>Q(f,n,r,u)},[a("div",{class:"calendar-card__lesson",style:ce({height:te(n.duration),gap:`${ot*n.duration}px`})},[a("p",null,i(q(n.start_time))+" - "+i(q(n.end_time)),1),a("p",null,i(n.student_name),1)],4),n.break&&n.break.duration?(o(),l("div",qe,i(n.break.duration),1)):_("",!0)],42,Re))),128))])],40,Be))),128))])):_("",!0)]),_:1})])])):_("",!0)]),_:1})])):_("",!0),p.value&&c.value?(o(),l("div",ze,[$.value.length?(o(),le(U(Te.DayPilotCalendar),{key:0,config:B.value,events:$.value,ref:"calendarRef"},{event:w(({event:s})=>[a("div",{class:"event",onClick:r=>F(s.data)},[a("div",Ne,[a("div",He,[a("div",Pe,[a("p",null,i(s.data.start_time)+" - "+i(s.data.end_time),1),a("p",null,i(s.data.student_name),1)]),s.data.break&&s.data.break.duration?(o(),l("div",Ve,i(s.data.break.duration),1)):_("",!0)])])],8,Fe)]),_:1},8,["config","events"])):_("",!0)])):_("",!0),c.value?_("",!0):(o(),l("div",Ue,e[1]||(e[1]=[a("div",{class:"loader"},null,-1)])))])]))]),k(we),k($e,{ref_key:"modalsContainer",ref:O},null,512)])}}};export{_t as default};

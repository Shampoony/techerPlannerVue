import{r as m,u as se,o as ne,a as l,b as k,d as a,e as V,F as w,f as h,g as _,m as oe,w as E,l as le,i as o,t as i,j as re,n as de,p as ie,T as ce,k as _e,h as ue}from"./index-W8Mn46Oq.js";import{f as me,c as L,d as ve,e as ke,h as ye,_ as pe,a as fe,b as ge,v as we,t as he}from"./v-header-Dk-KWUzs.js";import{u as be,_ as U,a as De,b as Se,c as $e}from"./v-modals-container-Cs-Pmo-N.js";import{d as Te}from"./daypilot-vue.min-B7YnrDl3.js";const Me={class:"wrapper"},Ce={key:0,class:"v-calendar-week"},Ee={class:"v-calendar-week__container container"},Le={key:0,class:"v-calendar-week__content scroll-container"},xe={key:0,class:"v-calendar-week__table calendar"},Ie={class:"calendar-header"},We={key:0,class:"calendar-row"},Be=["onDrop"],Oe={class:"calendar-row__item-content calendar-card"},Re=["onClick","onDragstart"],qe={key:0,class:"calendar-card__break"},ze={key:1,class:"v-calendar-week__break scroll-container"},Fe=["onClick"],Ne={class:"event-header"},He={class:"calendar-card__content"},Pe={class:"calendar-card__lesson"},Ve={key:0,class:"calendar-card__break"},Ue={key:2,class:"loader-container"},je={key:1,class:"v-calendar-week-mob mob-page"},Ge={class:"v-calendar-week-mob__container container"},Ae={key:0,class:"v-calendar-week-mob__list"},Je={key:0,class:"day"},Ke=["onClick"],Qe={class:"day__date"},Xe={key:0},Ye={class:"day__lesson"},Ze={class:"day__lesson-time"},et={class:"day__lesson-name"},tt={key:0,class:"day__lesson break"},at={class:"day__lesson-block"},st={class:"day__lesson-time"},nt={key:0,class:"title pb-4"},ot=10,j=90,_t={__name:"v-calendar-week",setup(lt){const{isMobile:G}=be(),y=m({}),A=_e(),x=le(),f=m(localStorage.getItem("breakMode")==="true"),S=m(),$=m(me(new Date)),I=m(x.query.start_date||"01.12.2025"),W=m({viewType:"Week",startDate:L(I.value),allowEventOverlap:!1,eventResizeHandling:"Disabled",timeRangeSelectedHandling:"Disabled",locale:"ru-RU",headerDateFormat:"ddd, d",touch:!0,weekStarts:1,onEventMoved:t=>{console.log("Event moved",t);const e=t.newStart.value,d=t.newStart.value,r=new Date(e).getDay(),s={start_time:e,end_time:d,day_of_week:r-1},u=t.e.data.lesson_id;console.log(s,u)},onEventResized:t=>{console.log("Event resized")}}),J=async t=>{const e=[];if(t)for(let d in t.week.days)t.week.days[d].lessons.forEach(n=>{const{start_time:r,end_time:s,...u}=n,p=`${t.week.days[d].day} ${r}`.replace(/(\d{2})\.(\d{2})\.(\d{4})/,"$3-$2-$1T").replace(" ",""),C=`${t.week.days[d].day} ${s}`.replace(/(\d{2})\.(\d{2})\.(\d{4})/,"$3-$2-$1T").replace(" ","");e.push({start:p,end:C,start_time:s.slice(0,5),end_time:s.slice(0,5),...u})});console.log(e),S.value=e},T=m({0:{day_of_week:"пн",date:""},1:{day_of_week:"вт",date:""},2:{day_of_week:"ср",date:""},3:{day_of_week:"чт",date:""},4:{day_of_week:"пт",date:""},5:{day_of_week:"сб",date:""},6:{day_of_week:"вс",date:""}}),B=se("modalsContainer"),c=m(),O=m({}),M=m({lesson:null,fromColumnIndex:null,fromLessonIndex:null}),K=(t,e,d,n)=>{M.value={lesson:e,fromColumnIndex:d,fromLessonIndex:n}},R=t=>t.slice(0,5),Q=(t,e)=>{const{lesson:d,fromColumnIndex:n,fromLessonIndex:r}=M.value;if(n!==e){const s=c.value.week.days[n].lessons,u=c.value.week.days[e].lessons,p=T.value[e].date.toISOString().split("T")[0],C={day_of_week_id:parseInt(e),start_time:d.start_time,end_time:d.end_time,conducted_date:p},g=v=>{const[D,P]=v.split(":").map(Number);return D*60+P},N=g(d.start_time),ae=g(d.end_time);for(let v of u){const D=g(v.start_time);if(!(g(v.end_time)<=N||D>=ae)){alert("В этот день уже есть занятие на данное время");return}}let H=u.length;for(let v=0;v<u.length;v++)if(g(u[v].start_time)>N){H=v;break}s.splice(r,1),u.splice(H,0,d),he(d.lesson_id,C).then(()=>{console.log("Перенос осуществлен")})}M.value={lesson:null,fromColumnIndex:null,fromLessonIndex:null}},X=t=>t===$.value,q=()=>{f.value=!f.value,localStorage.setItem("breakMode",f.value),b()},Y=()=>{b()},Z=(t,e)=>{if(e==$.value){y.value[t]=!1,$.value="";return}if(!(t in y.value)){y.value[t]=!0;return}y.value[t]=!y.value[t]},z=t=>{B.value.toggleLessonModals("buttons",t)},ee=t=>Math.max(j,j*t),F=t=>{A.push({query:{start_date:t}}).then(()=>{b()})},te=t=>{const[e,d,n]=t.split(".").map(Number);let r=new Date(n,d-1,e);return r=r.getDay()||7,T.value[r-1].date=new Date(n,d-1,e),`${T.value[r-1].day_of_week}, ${e}`},b=()=>{const t=x.query;if("start_date"in t)I.value=L(t.start_date),W.value.startDate=L(t.start_date),ve(t.start_date).then(e=>{console.log("Загружаем"),J(e),O.value=e,c.value=e});else{const e=ke(new Date);window.location.search=`?start_date=${ye(e)}`}console.log(O.value)};return ne(()=>{b()}),(t,e)=>{const d=ue("router-link");return o(),l("div",Me,[k(pe),a("main",null,[V(G)?(o(),l("section",je,[a("div",Ge,[k(U,{"is-showed-break":!0,type:"week",onSetWeek:F,onToggleBreakMode:q}),c.value&&c.value.week?(o(),l("ul",Ae,[(o(!0),l(w,null,h(c.value.week.days,(n,r)=>(o(),l("li",{key:r,class:"v-calendar-week-mob__list-item"},[n?(o(),l("div",Je,[a("div",{class:"day__header",onClick:s=>Z(r,n.day)},[a("p",Qe,i(n.day),1),e[2]||(e[2]=a("img",{src:fe,class:"day-el",alt:""},null,-1)),e[3]||(e[3]=a("img",{src:ge,class:"night-el",alt:""},null,-1))],8,Ke),k(ce,{name:"fade"},{default:E(()=>[y.value[r]||X(n.day)?(o(),l("div",Xe,[k(d,{to:{name:"calendar-day",query:{date:n.day}}},{default:E(()=>[(o(!0),l(w,null,h(n.lessons,(s,u)=>(o(),l("div",{class:"day__content",key:s.id},[a("div",Ye,[a("div",Ze,[e[4]||(e[4]=a("div",{class:"day__lesson-circle"},null,-1)),a("p",null,i(s.start_time),1),e[5]||(e[5]=a("p",null,"-",-1)),a("p",null,i(s.end_time),1)]),a("div",et,i(s.student_name),1)]),s.breaks?(o(),l("div",tt,[a("div",at,[e[7]||(e[7]=a("img",{src:De,class:"day-el",alt:""},null,-1)),e[8]||(e[8]=a("img",{src:Se,class:"night-el",alt:""},null,-1)),a("div",st,[a("p",null,i(s.breaks.start_time),1),e[6]||(e[6]=a("p",null,"-",-1)),a("p",null,i(s.breaks.end_time),1)])]),e[9]||(e[9]=a("div",{class:"day__lesson-name"},"Перерыв",-1))])):_("",!0)]))),128))]),_:2},1032,["to"]),n.lessons.length?_("",!0):(o(),l("div",nt," В этот день у вас нет уроков! "))])):_("",!0)]),_:2},1024)])):_("",!0)]))),128))])):_("",!0)])])):(o(),l("section",Ce,[a("div",Ee,[k(U,{"is-showed-break":!0,type:"week",onSetWeek:F,onPaginateWeek:Y,onToggleBreakMode:q}),!f.value&&c.value?(o(),l("div",Le,[c.value?(o(),l("table",xe,[a("thead",null,[a("tr",Ie,[(o(!0),l(w,null,h(c.value.week.days,(n,r)=>(o(),l("th",{class:"calendar-header__item",key:r},i(te(n.day)),1))),128))])]),a("tbody",null,[c.value&&c.value.week?(o(),l("tr",We,[(o(!0),l(w,null,h(c.value.week.days,(n,r)=>(o(),l("td",{key:r,class:"calendar-row__item",onDragover:e[0]||(e[0]=re(()=>{},["prevent"])),onDrop:s=>Q(s,r)},[a("div",Oe,[(o(!0),l(w,null,h(n.lessons,(s,u)=>(o(),l("div",{class:de(["calendar-card__content",{completed:s.completed}]),key:s.lesson_id,onClick:p=>z(s),draggable:"true",onDragstart:p=>K(p,s,r,u)},[a("div",{class:"calendar-card__lesson",style:ie({height:ee(s.duration),gap:`${ot*s.duration}px`})},[a("p",null,i(R(s.start_time))+" - "+i(R(s.end_time)),1),a("p",null,i(s.student_name),1)],4),s.break&&s.break.duration?(o(),l("div",qe,i(s.break.duration),1)):_("",!0)],42,Re))),128))])],40,Be))),128))])):_("",!0)])])):_("",!0)])):_("",!0),f.value&&c.value?(o(),l("div",ze,[S.value.length?(o(),oe(V(Te.DayPilotCalendar),{key:0,config:W.value,events:S.value,ref:"calendarRef"},{event:E(({event:n})=>[a("div",{class:"event",onClick:r=>z(n.data)},[a("div",Ne,[a("div",He,[a("div",Pe,[a("p",null,i(n.data.start_time)+" - "+i(n.data.end_time),1),a("p",null,i(n.data.student_name),1)]),n.data.break&&n.data.break.duration?(o(),l("div",Ve,i(n.data.break.duration),1)):_("",!0)])])],8,Fe)]),_:1},8,["config","events"])):_("",!0)])):_("",!0),c.value?_("",!0):(o(),l("div",Ue,e[1]||(e[1]=[a("div",{class:"loader"},null,-1)])))])]))]),k(we),k($e,{ref_key:"modalsContainer",ref:B},null,512)])}}};export{_t as default};

import{r as v,u as le,c as re,o as de,a as l,b as k,d as a,e as j,f as c,n as G,w,T as L,m as ie,F as h,g as b,l as ce,i as o,t as u,j as ue,p as _e,k as ve,h as me}from"./index-16oa0n4K.js";import{f as ke,c as I,d as ye,e as fe,h as pe,_ as ge,a as we,b as he,v as be,t as De}from"./v-header-igxqSMpB.js";import{u as Se,_ as A,a as $e,b as Te,c as Me}from"./v-modals-container-DRtIT18M.js";import{d as xe}from"./daypilot-vue.min-Dsp7BjJ2.js";const Ce={class:"wrapper"},Ee={key:0,class:"v-calendar-week"},Le={class:"v-calendar-week__container container"},Ie={key:0,class:"sec-hidden-content showing"},We={key:0,class:"v-calendar-week__table calendar"},Be={class:"calendar-header"},Oe=["onDrop"],Re={class:"calendar-row__item-content calendar-card"},qe=["onClick","onDragstart"],ze={key:2,class:"v-calendar-week__break scroll-container"},Fe=["onClick"],Ne={class:"event-header"},He={class:"calendar-card__content"},Pe={class:"calendar-card__lesson"},Ve={key:0,class:"calendar-card__break"},Ue={key:3,class:"loader-container"},je={key:1,class:"v-calendar-week-mob mob-page"},Ge={class:"v-calendar-week-mob__container container"},Ae={key:0,class:"v-calendar-week-mob__list"},Je={key:0,class:"day"},Ke=["onClick"],Qe={class:"day__date"},Xe={key:0},Ye={class:"day__lesson"},Ze={class:"day__lesson-time"},et={class:"day__lesson-name"},tt={key:0,class:"day__lesson break"},at={class:"day__lesson-block"},st={class:"day__lesson-time"},nt={key:0,class:"title pb-4"},ot=10,J=90,ut={__name:"v-calendar-week",setup(lt){const{isMobile:K}=Se(),y=v({}),Q=ve(),W=ce(),p=v(localStorage.getItem("breakMode")==="true"),T=v(),M=v(ke(new Date)),B=v(W.query.start_date||"01.12.2025"),O=v({viewType:"Week",cellDuration:15,startDate:I(B.value),allowEventOverlap:!1,eventResizeHandling:"Disabled",timeRangeSelectedHandling:"Disabled",locale:"ru-RU",headerDateFormat:"ddd, d",touch:!0,weekStarts:1,onEventMoved:t=>{console.log("Event moved",t);const e=t.newStart.value,i=t.newStart.value,r=new Date(e).getDay(),n={start_time:e,end_time:i,day_of_week:r-1},_=t.e.data.lesson_id;console.log(n,_)},onEventResized:t=>{console.log("Event resized")}}),X=async t=>{const e=[];if(t)for(let i in t.week.days)t.week.days[i].lessons.forEach(s=>{const{start_time:r,end_time:n,..._}=s,f=`${t.week.days[i].day} ${r}`.replace(/(\d{2})\.(\d{2})\.(\d{4})/,"$3-$2-$1T").replace(" ",""),E=`${t.week.days[i].day} ${n}`.replace(/(\d{2})\.(\d{2})\.(\d{4})/,"$3-$2-$1T").replace(" ","");e.push({start:f,end:E,start_time:r.slice(0,5),end_time:n.slice(0,5),..._})});console.log(e),T.value=e},x=v({0:{day_of_week:"пн",date:""},1:{day_of_week:"вт",date:""},2:{day_of_week:"ср",date:""},3:{day_of_week:"чт",date:""},4:{day_of_week:"пт",date:""},5:{day_of_week:"сб",date:""},6:{day_of_week:"вс",date:""}}),R=le("modalsContainer"),d=v(),q=v({}),C=v({lesson:null,fromColumnIndex:null,fromLessonIndex:null}),Y=(t,e,i,s)=>{C.value={lesson:e,fromColumnIndex:i,fromLessonIndex:s}},z=t=>t.slice(0,5),Z=(t,e)=>{const{lesson:i,fromColumnIndex:s,fromLessonIndex:r}=C.value;if(s!==e){const n=d.value.week.days[s].lessons,_=d.value.week.days[e].lessons,f=x.value[e].date.toISOString().split("T")[0],E={day_of_week_id:parseInt(e),start_time:i.start_time,end_time:i.end_time,conducted_date:f},g=m=>{const[$,U]=m.split(":").map(Number);return $*60+U},P=g(i.start_time),oe=g(i.end_time);for(let m of _){const $=g(m.start_time);if(!(g(m.end_time)<=P||$>=oe)){alert("В этот день уже есть занятие на данное время");return}}let V=_.length;for(let m=0;m<_.length;m++)if(g(_[m].start_time)>P){V=m;break}n.splice(r,1),_.splice(V,0,i),De(i.lesson_id,E).then(()=>{console.log("Перенос осуществлен")})}C.value={lesson:null,fromColumnIndex:null,fromLessonIndex:null}},ee=t=>t===M.value,F=()=>{p.value=!p.value,localStorage.setItem("breakMode",p.value),D()},te=()=>{D()},ae=(t,e)=>{if(e==M.value){y.value[t]=!1,M.value="";return}if(!(t in y.value)){y.value[t]=!0;return}y.value[t]=!y.value[t]},N=t=>{R.value.toggleLessonModals("buttons",t)},se=t=>Math.max(J,J*t),H=t=>{Q.push({query:{start_date:t}}).then(()=>{D()})},ne=t=>{const[e,i,s]=t.split(".").map(Number);let r=new Date(s,i-1,e);return r=r.getDay()||7,x.value[r-1].date=new Date(s,i-1,e),`${x.value[r-1].day_of_week}, ${e}`},D=()=>{const t=W.query;if("start_date"in t)B.value=I(t.start_date),O.value.startDate=I(t.start_date),ye(t.start_date).then(e=>{console.log("Загружаем"),X(e),q.value=e,d.value=e});else{const e=fe(new Date);window.location.search=`?start_date=${pe(e)}`}console.log(q.value)},S=re(()=>{if(d.value&&d.value.week.days){for(let t in d.value.week.days){const e=d.value.week.days[t];if(e.lessons&&e.lessons.length)return!1}return!0}return!1});return de(()=>{D()}),(t,e)=>{const i=me("router-link");return o(),l("div",Ce,[k(ge),a("main",null,[j(K)?(o(),l("section",je,[a("div",Ge,[k(A,{"is-showed-break":!0,type:"week",onSetWeek:H,onToggleBreakMode:F}),d.value&&d.value.week?(o(),l("ul",Ae,[(o(!0),l(h,null,b(d.value.week.days,(s,r)=>(o(),l("li",{key:r,class:"v-calendar-week-mob__list-item"},[s?(o(),l("div",Je,[a("div",{class:"day__header",onClick:n=>ae(r,s.day)},[a("p",Qe,u(s.day),1),e[3]||(e[3]=a("img",{src:we,class:"day-el",alt:""},null,-1)),e[4]||(e[4]=a("img",{src:he,class:"night-el",alt:""},null,-1))],8,Ke),k(L,{name:"fade"},{default:w(()=>[y.value[r]||ee(s.day)?(o(),l("div",Xe,[k(i,{to:{name:"calendar-day",query:{date:s.day}}},{default:w(()=>[(o(!0),l(h,null,b(s.lessons,(n,_)=>(o(),l("div",{class:"day__content",key:n.id},[a("div",Ye,[a("div",Ze,[e[5]||(e[5]=a("div",{class:"day__lesson-circle"},null,-1)),a("p",null,u(n.start_time),1),e[6]||(e[6]=a("p",null,"-",-1)),a("p",null,u(n.end_time),1)]),a("div",et,u(n.student_name),1)]),n.breaks?(o(),l("div",tt,[a("div",at,[e[8]||(e[8]=a("img",{src:$e,class:"day-el",alt:""},null,-1)),e[9]||(e[9]=a("img",{src:Te,class:"night-el",alt:""},null,-1)),a("div",st,[a("p",null,u(n.breaks.start_time),1),e[7]||(e[7]=a("p",null,"-",-1)),a("p",null,u(n.breaks.end_time),1)])]),e[10]||(e[10]=a("div",{class:"day__lesson-name"},"Перерыв",-1))])):c("",!0)]))),128))]),_:2},1032,["to"]),s.lessons.length?c("",!0):(o(),l("div",nt," В этот день у вас нет уроков! "))])):c("",!0)]),_:2},1024)])):c("",!0)]))),128))])):c("",!0)])])):(o(),l("section",Ee,[a("div",Le,[k(A,{"is-showed-break":!0,type:"week",onSetWeek:H,onPaginateWeek:te,onToggleBreakMode:F}),S.value?(o(),l("div",Ie,e[1]||(e[1]=[a("h1",{class:"text-title text-blue"},"Еще не запланировано ни одного занятия!",-1)]))):c("",!0),!p.value&&d.value||S.value?(o(),l("div",{key:1,class:G(["v-calendar-week__content scroll-container",{blur:S.value}])},[k(L,{name:"fade"},{default:w(()=>[d.value?(o(),l("table",We,[a("thead",null,[a("tr",Be,[(o(!0),l(h,null,b(d.value.week.days,(s,r)=>(o(),l("th",{class:"calendar-header__item",key:r},u(ne(s.day)),1))),128))])]),a("tbody",null,[d.value&&d.value.week?(o(),l("tr",{class:"calendar-row",key:d.value.week.start_date},[(o(!0),l(h,null,b(d.value.week.days,(s,r)=>(o(),l("td",{key:r,class:"calendar-row__item",onDragover:e[0]||(e[0]=ue(()=>{},["prevent"])),onDrop:n=>Z(n,r)},[a("div",Re,[(o(!0),l(h,null,b(s.lessons,(n,_)=>(o(),l("div",{class:G(["calendar-card__content",{completed:n.completed}]),key:n.lesson_id,onClick:f=>N(n),draggable:"true",onDragstart:f=>Y(f,n,r,_)},[k(L,{name:"flip"},{default:w(()=>[n?(o(),l("div",{key:0,class:"calendar-card__lesson",style:_e({height:se(n.duration),gap:`${ot*n.duration}px`})},[a("p",null,u(z(n.start_time))+" - "+u(z(n.end_time)),1),a("p",null,u(n.student_name),1)],4)):c("",!0)]),_:2},1024)],42,qe))),128))])],40,Oe))),128))])):c("",!0)])])):c("",!0)]),_:1})],2)):c("",!0),p.value&&d.value&&!S.value?(o(),l("div",ze,[T.value.length?(o(),ie(j(xe.DayPilotCalendar),{key:0,config:O.value,events:T.value,ref:"calendarRef"},{event:w(({event:s})=>[a("div",{class:"event",onClick:r=>N(s.data)},[a("div",Ne,[a("div",He,[a("div",Pe,[a("p",null,u(s.data.start_time)+" - "+u(s.data.end_time),1),a("p",null,u(s.data.student_name),1)]),s.data.break&&s.data.break.duration?(o(),l("div",Ve,u(s.data.break.duration),1)):c("",!0)])])],8,Fe)]),_:1},8,["config","events"])):c("",!0)])):c("",!0),d.value?c("",!0):(o(),l("div",Ue,e[2]||(e[2]=[a("div",{class:"loader"},null,-1)])))])]))]),k(be),k(Me,{ref_key:"modalsContainer",ref:R},null,512)])}}};export{ut as default};

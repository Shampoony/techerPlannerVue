import{r as p,u as Q,c as I,o as X,a,b as f,d as s,e as ee,f as y,n as $,F as m,g as h,w as se,h as te,i as n,t as c,j as ae,k as ne,l as le}from"./index-D_rhgoPn.js";import{g as O,_ as oe,a as re,b as de,v as ce,t as ie}from"./v-header-nTjlccc4.js";import{u as _e,_ as J,a as ue,b as ve,c as me}from"./v-modals-container-gQVqI9yj.js";const he={class:"wrapper"},ye={key:0,class:"v-calendar-month"},pe={class:"v-calendar-month__container container"},ge={key:0,class:"v-calendar-month__content scroll-container"},ke={key:0,class:"sec-hidden-content showing"},fe={class:"calendar-header"},be=["onDrop"],Se={class:"calendar-row__item-container"},we={key:0,class:"calendar-row__item-content calendar-card"},Me={class:"calendar-card__num"},Le=["onClick","onDragstart"],$e={key:0,class:"calendar-card__lesson break"},De={key:1,class:"loader-container"},Ce={key:1,class:"v-calendar-month-mob mob-page"},Ne={class:"container"},Oe={class:"v-calendar-month-mob__container"},Be={class:"v-calendar-month-mob__table calendar"},Ee={class:"calendar-header"},qe=["onClick"],Fe={key:0,class:"calendar-row__item-content calendar-card"},Pe={class:"calendar-card__num"},Ie={class:"calendar-card__content"},Je={key:0,class:"calendar-card__lesson break"},Re={key:0,class:"v-calendar-month-mob__info lesson-info"},Ve={class:"v-calendar-month-mob__day day"},je={class:"day__header"},Ae={class:"day__date"},Te={class:"day__lesson"},Ye={class:"day__lesson-time"},Ze={class:"day__lesson-name"},xe={key:0,class:"day__lesson break"},ze={class:"day__lesson-block"},Ue={class:"day__lesson-time"},We={key:0},Xe={__name:"v-calendar-month",setup(Ge){const D=p([{days_week:"Пн",id:1},{days_week:"Вт",id:2},{days_week:"Ср",id:3},{days_week:"Чт",id:4},{days_week:"Пт",id:5},{days_week:"Сб",id:6},{days_week:"Вс",id:7}]),B=p(new Date),b=p(B.value.getMonth()+1),S=p(B.value.getFullYear()),R=ne(),V=le(),o=p({}),u=p([]),C=p(),{isMobile:j}=_e(),E=Q("modalsContainer"),q=l=>{const e=V.query.selected_date;return`${String(l).padStart(2,0)}.${e}`},A=(l,e)=>{u.value[0]=parseInt(l),u.value[1]=e,localStorage.setItem("activeDay",JSON.stringify(u.value)),console.log(JSON.parse(localStorage.getItem("activeDay")))},T=(l,e,i,t,_)=>{C.value={lesson:e,fromColumnIndex:t,fromRowIndex:i,fromLessonIndex:_}},Y=(l,e,i)=>{const{lesson:t,fromColumnIndex:_,fromRowIndex:d,fromLessonIndex:r}=C.value;if(_!==e||d!==i)if(!o.value.schedule[i][e])alert("Интерактивным способом вы можете переносить урок только в пределах месяца");else{console.log("в else");const N=o.value.schedule[d][_].lessons,w=o.value.schedule[i][e].lessons,g=k=>{const[M,L]=k.split(":").map(Number);return M*60+L},U=g(t.start_time),W=g(t.end_time);for(let k of w){const M=g(k.start_time);if(!(g(k.end_time)<=U||M>=W)){alert("В этот день уже есть занятие на данное время");return}}N.splice(r,1),w.push(t),w.sort((k,M)=>{const L=g(k.start_time),K=g(M.start_time);return L-K});const G=String(o.value.schedule[i][e].day),H={day_of_week_id:e-1,start_time:t.start_time+":00.001Z",end_time:t.end_time+":00.001Z",conducted_date:`${S.value}-${b.value}-${G.padStart(2,0)}`};ie(t.lesson_id,H).then(()=>{console.log("Выполнили")}),C.value=null}},Z=l=>{E.value.toggleLessonModals("buttons",l)},x=l=>{console.log("Зашли"),R.push({query:{selected_date:`${String(l.month+1).padStart(2,"0")}.${l.year}`}}),b.value=l.month,S.value=l.year,console.log(l.year,l.month+1),O(l.year,l.month+1).then(e=>{o.value=e})},F=l=>{console.log("Зашли"),O(l.year,l.month).then(e=>{o.value=e,u.value=[]})},z=()=>{const l=new URLSearchParams(window.location.search),e=Object.fromEntries(l.entries());console.log("в функции"),"selected_date"in e?(b.value=e.selected_date.split(".")[0],S.value=e.selected_date.split(".")[1]):window.location.search=`?selected_date=${String(b.value).padStart(2,0)}.${S.value}`,O(S.value,parseInt(b.value)).then(i=>{o.value=i})},v=I(()=>{if(u.value.length&&o.value.schedule){const l=o.value.schedule[u.value[0]];if(l)return l[u.value[1]]}return null}),P=I(()=>{if(o.value&&o.value.schedule){for(let l in o.value.schedule){const e=o.value.schedule[l];for(let i in e)if(console.log(e[i]),e[i].lessons.length)return!1}return!0}return console.log("лол"),!1});return X(()=>{z(),u.value=JSON.parse(localStorage.getItem("activeDay"))||[]}),(l,e)=>{const i=te("router-link");return n(),a("div",he,[f(oe),s("main",null,[ee(j)?(n(),a("section",Ce,[s("div",Ne,[s("div",Oe,[f(J,{type:"month",onPaginateMonth:F}),s("table",Be,[s("thead",null,[s("tr",Ee,[(n(!0),a(m,null,h(D.value,t=>(n(),a("th",{class:"calendar-header__item",key:t.id},c(t.days_week),1))),128))])]),s("tbody",null,[(n(!0),a(m,null,h(o.value.schedule,(t,_)=>(n(),a("tr",{class:"calendar-row",key:_},[(n(),a(m,null,h(7,d=>s("td",{class:$(["calendar-row__item",{active:_==u.value[0]&&d==u.value[1]}]),onClick:r=>A(_,d),key:d},[t[d]?(n(),a("div",Fe,[s("div",Pe,c(t[d].day),1),s("div",Ie,[(n(!0),a(m,null,h(t[d].lessons,r=>(n(),a("div",{class:"calendar-card__lesson",key:r.lesson_id}))),128)),t[d].breaks&&t[d].breaks[l.lesson.lesson_id]?(n(),a("div",Je)):y("",!0)])])):y("",!0)],10,qe)),64))]))),128))])])]),v.value?(n(),a("div",Re,[f(i,{to:{name:"calendar-day",query:{date:q(v.value.day)}}},{default:se(()=>[s("div",Ve,[s("div",je,[s("p",Ae,c(q(v.value.day)),1),e[3]||(e[3]=s("img",{src:re,class:"day-el",alt:""},null,-1)),e[4]||(e[4]=s("img",{src:de,class:"night-el",alt:""},null,-1))]),(n(!0),a(m,null,h(v.value.lessons,t=>(n(),a("div",{class:"day__content",key:t.id},[s("div",Te,[s("div",Ye,[e[5]||(e[5]=s("div",{class:"day__lesson-circle"},null,-1)),s("p",null,c(t.start_time),1),e[6]||(e[6]=s("p",null,"-",-1)),s("p",null,c(t.end_time),1)]),s("div",Ze,c(t.student_name),1)]),v.value.breaks&&v.value.breaks[t.lesson_id]?(n(),a("div",xe,[s("div",ze,[e[8]||(e[8]=s("img",{src:ue,class:"day-el",alt:""},null,-1)),e[9]||(e[9]=s("img",{src:ve,class:"night-el",alt:""},null,-1)),s("div",Ue,[s("p",null,c(v.value.breaks[t.lesson_id].start_time),1),e[7]||(e[7]=s("p",null,"-",-1)),s("p",null,c(v.value.breaks[t.lesson_id].end_time),1)])]),e[10]||(e[10]=s("div",{class:"day__lesson-name"},"Перерыв",-1))])):y("",!0)]))),128)),v.value.lessons.length?y("",!0):(n(),a("div",We,e[11]||(e[11]=[s("h2",{class:"title pb-7"},"В этот день у вас нет уроков",-1)])))])]),_:1},8,["to"])])):y("",!0)])])):(n(),a("section",ye,[s("div",pe,[f(J,{type:"month",onSetMonth:x,onPaginateMonth:F}),o.value.schedule&&D.value?(n(),a("div",ge,[P.value?(n(),a("div",ke,e[1]||(e[1]=[s("h1",{class:"text-title text-blue"},"Еще не запланировано ни одного занятия!",-1)]))):y("",!0),s("table",{class:$(["v-calendar-month__table calendar",{blur:P.value}])},[s("thead",null,[s("tr",fe,[(n(!0),a(m,null,h(D.value,t=>(n(),a("th",{class:"calendar-header__item",key:t.id},c(t.days_week),1))),128))])]),s("tbody",null,[(n(!0),a(m,null,h(o.value.schedule,(t,_)=>(n(),a("tr",{class:"calendar-row",key:_},[(n(),a(m,null,h(7,d=>s("td",{class:"calendar-row__item",key:d,onDragover:e[0]||(e[0]=ae(()=>{},["prevent"])),onDrop:r=>Y(r,d,_)},[s("div",Se,[t[d]?(n(),a("div",we,[s("div",Me,c(t[d].day),1),(n(!0),a(m,null,h(t[d].lessons,(r,N)=>(n(),a("div",{class:$(["calendar-card__content",{completed:r.completed}]),key:r.lesson_id,onClick:()=>Z(r),draggable:"true",onDragstart:w=>T(w,r,_,d,N)},[s("div",{class:$(["calendar-card__lesson",{trial:r.one_time}])},c(r.start_time)+" - "+c(r.end_time)+" "+c(r.student_name),3),o.value.breaks&&o.value.breaks[r.lesson_id]&&o.value.breaks[r.lesson_id].start_time!==o.value.breaks[r.lesson_id].end_time?(n(),a("div",$e,c(o.value.breaks[r.lesson_id].start_time)+" - "+c(o.value.breaks[r.lesson_id].end_time)+" "+c(r.student_name),1)):y("",!0)],42,Le))),128))])):y("",!0)])],40,be)),64))]))),128))])],2)])):(n(),a("div",De,e[2]||(e[2]=[s("div",{class:"loader"},null,-1)])))])]))]),f(me,{ref_key:"modalsContainer",ref:E},null,512),f(ce)])}}};export{Xe as default};

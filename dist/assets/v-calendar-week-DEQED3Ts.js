import{r as m,u as Z,o as ee,a as o,b as k,d as t,e as V,F as g,f as w,g as v,w as P,l as te,i as l,t as d,j as ae,m as se,T as ne,k as oe}from"./index-BgvZipAR.js";import{c as E,d as le,f as re,_ as de,a as ie,b as ce,v as _e,t as ue}from"./v-header-Ca7z2lX5.js";import{u as me,_ as U,a as ve,b as ke,c as ye}from"./v-modals-container-DpJnJSYW.js";import{d as fe}from"./daypilot-vue.min-DbJWk4Di.js";const pe={class:"wrapper"},ge={key:0,class:"v-calendar-week"},we={class:"v-calendar-week__container container"},he={key:0,class:"v-calendar-week__content scroll-container"},be={key:0,class:"v-calendar-week__table calendar"},De={class:"calendar-header"},$e={key:0,class:"calendar-row"},Se=["onDrop"],Te={class:"calendar-row__item-content calendar-card"},Me=["onClick","onDragstart"],Ee={key:0,class:"calendar-card__break"},Le={key:1,class:"v-calendar-week__break scroll-container"},Ce=["onClick"],Ie={class:"event-header"},xe={class:"calendar-card__content"},Be={class:"calendar-card__lesson"},Oe={key:0,class:"calendar-card__break"},Re={key:1,class:"v-calendar-week-mob mob-page"},We={class:"v-calendar-week-mob__container container"},qe={key:0,class:"v-calendar-week-mob__list"},Fe={key:0,class:"day"},Ne=["onClick"],ze={class:"day__date"},He={key:0},Ve={class:"day__lesson"},Pe={class:"day__lesson-time"},Ue={class:"day__lesson-name"},je={key:0,class:"day__lesson break"},Ge={class:"day__lesson-block"},Ae={class:"day__lesson-time"},Je=10,j=90,et={__name:"v-calendar-week",setup(Ke){const{isMobile:G}=me(),y=m({}),L=oe(),C=te(),f=m(localStorage.getItem("breakMode")==="true"),b=m();m(new Date);const I=m(C.query.start_date||"01.12.2025"),x={viewType:"Week",startDate:E(I.value),eventResizeHandling:"Disabled",timeRangeSelectedHandling:"Disabled",locale:"ru-RU",headerDateFormat:"ddd, d",allowEventOverlap:!1,touch:!0,weekStarts:1,onEventMoved:a=>{console.log("Event moved",a);const e=a.newStart.value,n=a.newStart.value,s=new Date(e).getDay(),_={start_time:e,end_time:n,day_of_week:s},i=a.e.data.lesson_id;console.log(_,i)},onEventResized:a=>{console.log("Event resized")}},B=async a=>{const e=[];if(a)for(let n in a.week.days)a.week.days[n].lessons.forEach(r=>{const{start_time:s,end_time:_,...i}=r,T=`${a.week.days[n].day} ${s}`.replace(/(\d{2})\.(\d{2})\.(\d{4})/,"$3-$2-$1T").replace(" ",""),M=`${a.week.days[n].day} ${_}`.replace(/(\d{2})\.(\d{2})\.(\d{4})/,"$3-$2-$1T").replace(" ","");console.log(s),e.push({start:T,end:M,start_time:_.slice(0,5),end_time:_.slice(0,5),...i})});console.log(e,a),b.value=e},D=m({0:{day_of_week:"пн",date:""},1:{day_of_week:"вт",date:""},2:{day_of_week:"ср",date:""},3:{day_of_week:"чт",date:""},4:{day_of_week:"пт",date:""},5:{day_of_week:"сб",date:""},6:{day_of_week:"вс",date:""}}),O=Z("modalsContainer"),c=m(),R=m({}),$=m({lesson:null,fromColumnIndex:null,fromLessonIndex:null}),A=(a,e,n,r)=>{$.value={lesson:e,fromColumnIndex:n,fromLessonIndex:r}},J=(a,e)=>{const{lesson:n,fromColumnIndex:r,fromLessonIndex:s}=$.value;if(r!==e){const _=c.value.week.days[r].lessons,i=c.value.week.days[e].lessons,T=D.value[e].date.toISOString().split("T")[0],M={day_of_week_id:parseInt(e),start_time:n.start_time,end_time:n.end_time,conducted_date:T},p=u=>{const[h,H]=u.split(":").map(Number);return h*60+H},N=p(n.start_time),Y=p(n.end_time);for(let u of i){const h=p(u.start_time);if(!(p(u.end_time)<=N||h>=Y)){alert("В этот день уже есть занятие на данное время");return}}let z=i.length;for(let u=0;u<i.length;u++)if(p(i[u].start_time)>N){z=u;break}_.splice(s,1),i.splice(z,0,n),ue(n.lesson_id,M).then(()=>{console.log("Перенос осуществлен")})}$.value={lesson:null,fromColumnIndex:null,fromLessonIndex:null}},W=()=>{f.value=!f.value,localStorage.setItem("breakMode",f.value),S(),f.value?B():b.value=[]},K=a=>{if(!(a in y.value)){y.value[a]=!0;return}y.value[a]=!y.value[a]},q=a=>{O.value.toggleLessonModals("buttons",a)},Q=a=>Math.max(j,j*a),F=a=>{L.push({query:{start_date:a}}),S().then(()=>{L.go(0)})},X=a=>{const[e,n,r]=a.split(".").map(Number);let s=new Date(r,n-1,e);return s=s.getDay()||7,D.value[s-1].date=new Date(r,n-1,e),`${D.value[s-1].day_of_week}, ${e}`},S=()=>{const a=C.query;if("start_date"in a)I.value=E(a.start_date),x.startDate=E(a.start_date),le(a.start_date).then(e=>{B(e),R.value=e,c.value=e});else{const e=new Date;window.location.search=`?start_date=${re(e)}`}console.log(R.value)};return ee(()=>{S()}),(a,e)=>(l(),o("div",pe,[k(de),t("main",null,[V(G)?(l(),o("section",Re,[t("div",We,[k(U,{"is-showed-break":!0,type:"week",onSetWeek:F,onToggleBreakMode:W}),c.value&&c.value.week?(l(),o("ul",qe,[(l(!0),o(g,null,w(c.value.week.days,(n,r)=>(l(),o("li",{key:r,class:"v-calendar-week-mob__list-item"},[n?(l(),o("div",Fe,[t("div",{class:"day__header",onClick:s=>K(r)},[t("p",ze,d(n.day),1),e[1]||(e[1]=t("img",{src:ie,class:"day-el",alt:""},null,-1)),e[2]||(e[2]=t("img",{src:ce,class:"night-el",alt:""},null,-1))],8,Ne),k(ne,{name:"fade"},{default:P(()=>[y.value[r]?(l(),o("div",He,[(l(!0),o(g,null,w(n.lessons,(s,_)=>(l(),o("div",{class:"day__content",key:s.id},[t("div",Ve,[t("div",Pe,[e[3]||(e[3]=t("div",{class:"day__lesson-circle"},null,-1)),t("p",null,d(s.start_time),1),e[4]||(e[4]=t("p",null,"-",-1)),t("p",null,d(s.end_time),1)]),t("div",Ue,d(s.student_name),1)]),s.breaks?(l(),o("div",je,[t("div",Ge,[e[6]||(e[6]=t("img",{src:ve,class:"day-el",alt:""},null,-1)),e[7]||(e[7]=t("img",{src:ke,class:"night-el",alt:""},null,-1)),t("div",Ae,[t("p",null,d(s.breaks.start_time),1),e[5]||(e[5]=t("p",null,"-",-1)),t("p",null,d(s.breaks.end_time),1)])]),e[8]||(e[8]=t("div",{class:"day__lesson-name"},"Перерыв",-1))])):v("",!0)]))),128))])):v("",!0)]),_:2},1024)])):v("",!0)]))),128))])):v("",!0)])])):(l(),o("section",ge,[t("div",we,[k(U,{"is-showed-break":!0,type:"week",onSetWeek:F,onToggleBreakMode:W}),f.value?(l(),o("div",Le,[k(V(fe.DayPilotCalendar),{config:x,events:b.value,ref:"calendarRef"},{event:P(({event:n})=>[t("div",{class:"event",onClick:r=>q(n.data)},[t("div",Ie,[t("div",xe,[t("div",Be,[t("p",null,d(n.data.start_time)+" - "+d(n.data.end_time),1),t("p",null,d(n.data.student_name),1)]),n.data.break?(l(),o("div",Oe,d(n.data.break.duration),1)):v("",!0)])])],8,Ce)]),_:1},8,["events"])])):(l(),o("div",he,[c.value?(l(),o("table",be,[t("thead",null,[t("tr",De,[(l(!0),o(g,null,w(c.value.week.days,(n,r)=>(l(),o("th",{class:"calendar-header__item",key:r},d(X(n.day)),1))),128))])]),t("tbody",null,[c.value&&c.value.week?(l(),o("tr",$e,[(l(!0),o(g,null,w(c.value.week.days,(n,r)=>(l(),o("td",{key:r,class:"calendar-row__item",onDragover:e[0]||(e[0]=ae(()=>{},["prevent"])),onDrop:s=>J(s,r)},[t("div",Te,[(l(!0),o(g,null,w(n.lessons,(s,_)=>(l(),o("div",{class:"calendar-card__content",key:s.lesson_id,onClick:i=>q(s),draggable:"true",onDragstart:i=>A(i,s,r,_)},[t("div",{class:"calendar-card__lesson",style:se({height:Q(s.duration),gap:`${Je*s.duration}px`})},[t("p",null,d(s.start_time)+" - "+d(s.end_time),1),t("p",null,d(s.student_name),1)],4),s.break?(l(),o("div",Ee,d(s.break.duration),1)):v("",!0)],40,Me))),128))])],40,Se))),128))])):v("",!0)])])):v("",!0)]))])]))]),k(_e),k(ye,{ref_key:"modalsContainer",ref:O},null,512)]))}};export{et as default};

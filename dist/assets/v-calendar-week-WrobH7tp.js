import{r as v,u as re,c as de,o as ie,a as l,b as k,d as a,e as G,f as c,n as L,w,T as W,m as ce,F as h,g as b,l as ue,i as o,t as u,j as _e,p as ve,q as me,k as ke,h as ye}from"./index-qwOFd5_A.js";import{f as fe,c as I,t as A,d as pe,e as ge,h as we,_ as he,a as be,b as De,v as Te}from"./v-header-ggxa7KvD.js";import{u as Se,_ as J,a as $e,b as xe,c as Me}from"./v-modals-container-oR44kkGH.js";import{d as Ce}from"./daypilot-vue.min-C-IYBjAT.js";const Ee={class:"wrapper"},Le={key:0,class:"v-calendar-week"},We={class:"v-calendar-week__container container"},Ie={key:0,class:"sec-hidden-content showing"},Be={key:0,class:"v-calendar-week__table calendar"},Oe={class:"calendar-header"},Re=["onDrop"],qe={class:"calendar-row__item-content calendar-card"},Ne=["onClick","onDragstart"],ze={key:2,class:"v-calendar-week__break scroll-container"},Fe=["onClick"],Ve={class:"event-header"},He={class:"calendar-card__content"},Pe={class:"calendar-card__lesson"},Ue={key:0,class:"calendar-card__break"},je={key:3,class:"loader-container"},Ge={key:1,class:"v-calendar-week-mob mob-page"},Ae={class:"v-calendar-week-mob__container container"},Je={key:0,class:"v-calendar-week-mob__list"},Ke={key:0,class:"day"},Qe=["onClick"],Xe={class:"day__date"},Ye={key:0},Ze={class:"day__lesson"},et={class:"day__lesson-time"},tt={class:"day__lesson-name"},at={key:0,class:"day__lesson break"},st={class:"day__lesson-block"},nt={class:"day__lesson-time"},ot={key:0,class:"title pb-4"},lt=10,K=90,_t={__name:"v-calendar-week",setup(rt){const{isMobile:Q}=Se(),y=v({}),X=ke(),B=ue(),p=v(localStorage.getItem("breakMode")==="true"),x=v(),M=v(fe(new Date)),O=v(B.query.start_date||"01.12.2025"),R=v({viewType:"Week",cellDuration:15,startDate:I(O.value),allowEventOverlap:!1,eventResizeHandling:"Disabled",timeRangeSelectedHandling:"Disabled",locale:"ru-RU",headerDateFormat:"ddd, d",touch:!0,weekStarts:1,onEventMoved:t=>{console.log("Event moved",t);const e=t.newStart.value.split("T")[1],i=t.newStart.value.split("T")[1],s=t.e.data.start.value.split("T")[0],n={day_of_week_id:new Date(t.newStart.value).getDay(),start_time:e,end_time:i,conducted_date:s},_=t.e.data.lesson_id;A(_,n).then(()=>{console.log("Выполнили запрос")})},onEventResized:t=>{console.log("Event resized")}}),Y=async t=>{const e=[];if(t)for(let i in t.week.days)t.week.days[i].lessons.forEach(s=>{const{start_time:r,end_time:n,..._}=s,f=`${t.week.days[i].day} ${r}`.replace(/(\d{2})\.(\d{2})\.(\d{4})/,"$3-$2-$1T").replace(" ",""),S=`${t.week.days[i].day} ${n}`.replace(/(\d{2})\.(\d{2})\.(\d{4})/,"$3-$2-$1T").replace(" ","");e.push({start:f,end:S,start_time:r.slice(0,5),end_time:n.slice(0,5),..._})});console.log(e),x.value=e},C=v({0:{day_of_week:"пн",date:""},1:{day_of_week:"вт",date:""},2:{day_of_week:"ср",date:""},3:{day_of_week:"чт",date:""},4:{day_of_week:"пт",date:""},5:{day_of_week:"сб",date:""},6:{day_of_week:"вс",date:""}}),q=re("modalsContainer"),d=v(),N=v({}),E=v({lesson:null,fromColumnIndex:null,fromLessonIndex:null}),Z=(t,e,i,s)=>{E.value={lesson:e,fromColumnIndex:i,fromLessonIndex:s}},z=t=>t.slice(0,5),ee=(t,e)=>{const{lesson:i,fromColumnIndex:s,fromLessonIndex:r}=E.value;if(s!==e){const n=d.value.week.days[s].lessons,_=d.value.week.days[e].lessons,f=C.value[e].date.toISOString().split("T")[0],S={day_of_week_id:parseInt(e),start_time:i.start_time,end_time:i.end_time,conducted_date:f},g=m=>{const[$,j]=m.split(":").map(Number);return $*60+j},P=g(i.start_time),le=g(i.end_time);for(let m of _){const $=g(m.start_time);if(!(g(m.end_time)<=P||$>=le)){alert("В этот день уже есть занятие на данное время");return}}let U=_.length;for(let m=0;m<_.length;m++)if(g(_[m].start_time)>P){U=m;break}n.splice(r,1),_.splice(U,0,i),console.log(S),A(i.lesson_id,S).then(()=>{console.log("Перенос осуществлен")})}E.value={lesson:null,fromColumnIndex:null,fromLessonIndex:null}},te=t=>t===M.value,F=()=>{p.value=!p.value,localStorage.setItem("breakMode",p.value),D()},ae=()=>{D()},se=(t,e)=>{if(e==M.value){y.value[t]=!1,M.value="";return}if(!(t in y.value)){y.value[t]=!0;return}y.value[t]=!y.value[t]},V=t=>{q.value.toggleLessonModals("buttons",t)},ne=t=>Math.max(K,K*t),H=t=>{X.push({query:{start_date:t}}).then(()=>{D()})},oe=t=>{const[e,i,s]=t.split(".").map(Number);let r=new Date(s,i-1,e);return r=r.getDay()||7,C.value[r-1].date=new Date(s,i-1,e),`${C.value[r-1].day_of_week}, ${e}`},D=()=>{const t=B.query;if("start_date"in t)O.value=I(t.start_date),R.value.startDate=I(t.start_date),pe(t.start_date).then(e=>{console.log("Загружаем"),Y(e),N.value=e,d.value=e});else{const e=ge(new Date);window.location.search=`?start_date=${we(e)}`}console.log(N.value)},T=de(()=>{if(d.value&&d.value.week.days){for(let t in d.value.week.days){const e=d.value.week.days[t];if(e.lessons&&e.lessons.length)return!1}return!0}return!1});return ie(()=>{D()}),(t,e)=>{const i=ye("router-link");return o(),l("div",Ee,[k(he),a("main",null,[G(Q)?(o(),l("section",Ge,[a("div",Ae,[k(J,{"is-showed-break":!0,type:"week",onSetWeek:H,onToggleBreakMode:F}),d.value&&d.value.week?(o(),l("ul",Je,[(o(!0),l(h,null,b(d.value.week.days,(s,r)=>(o(),l("li",{key:r,class:"v-calendar-week-mob__list-item"},[e[11]||(e[11]=me(" {} ")),s?(o(),l("div",Ke,[a("div",{class:"day__header",onClick:n=>se(r,s.day)},[a("p",Xe,u(s.day),1),e[3]||(e[3]=a("img",{src:be,class:"day-el",alt:""},null,-1)),e[4]||(e[4]=a("img",{src:De,class:"night-el",alt:""},null,-1))],8,Qe),k(W,{name:"fade"},{default:w(()=>[y.value[r]||te(s.day)?(o(),l("div",Ye,[k(i,{to:{name:"calendar-day",query:{date:s.day}}},{default:w(()=>[(o(!0),l(h,null,b(s.lessons,(n,_)=>(o(),l("div",{class:"day__content",key:n.id},[a("div",Ze,[a("div",et,[e[5]||(e[5]=a("div",{class:"day__lesson-circle"},null,-1)),a("p",null,u(n.start_time),1),e[6]||(e[6]=a("p",null,"-",-1)),a("p",null,u(n.end_time),1)]),a("div",tt,u(n.student_name),1)]),n.breaks?(o(),l("div",at,[a("div",st,[e[8]||(e[8]=a("img",{src:$e,class:"day-el",alt:""},null,-1)),e[9]||(e[9]=a("img",{src:xe,class:"night-el",alt:""},null,-1)),a("div",nt,[a("p",null,u(n.breaks.start_time),1),e[7]||(e[7]=a("p",null,"-",-1)),a("p",null,u(n.breaks.end_time),1)])]),e[10]||(e[10]=a("div",{class:"day__lesson-name"},"Перерыв",-1))])):c("",!0)]))),128))]),_:2},1032,["to"]),s.lessons.length?c("",!0):(o(),l("div",ot," В этот день у вас нет уроков! "))])):c("",!0)]),_:2},1024)])):c("",!0)]))),128))])):c("",!0)])])):(o(),l("section",Le,[a("div",We,[k(J,{"is-showed-break":!0,type:"week",onSetWeek:H,onPaginateWeek:ae,onToggleBreakMode:F}),T.value?(o(),l("div",Ie,e[1]||(e[1]=[a("h1",{class:"text-title text-blue"},"Еще не запланировано ни одного занятия!",-1)]))):c("",!0),!p.value&&d.value||T.value?(o(),l("div",{key:1,class:L(["v-calendar-week__content scroll-container",{blur:T.value}])},[k(W,{name:"fade"},{default:w(()=>[d.value?(o(),l("table",Be,[a("thead",null,[a("tr",Oe,[(o(!0),l(h,null,b(d.value.week.days,(s,r)=>(o(),l("th",{class:"calendar-header__item",key:r},u(oe(s.day)),1))),128))])]),a("tbody",null,[d.value&&d.value.week?(o(),l("tr",{class:"calendar-row",key:d.value.week.start_date},[(o(!0),l(h,null,b(d.value.week.days,(s,r)=>(o(),l("td",{key:r,class:"calendar-row__item",onDragover:e[0]||(e[0]=_e(()=>{},["prevent"])),onDrop:n=>ee(n,r)},[a("div",qe,[(o(!0),l(h,null,b(s.lessons,(n,_)=>(o(),l("div",{class:L(["calendar-card__content",{completed:n.completed}]),key:n.lesson_id,onClick:f=>V(n),draggable:"true",onDragstart:f=>Z(f,n,r,_)},[k(W,{name:"flip"},{default:w(()=>[n?(o(),l("div",{key:0,class:L(["calendar-card__lesson",{trial:n.trial}]),style:ve({height:ne(n.duration),gap:`${lt*n.duration}px`})},[a("p",null,u(z(n.start_time))+" - "+u(z(n.end_time)),1),a("p",null,u(n.student_name),1)],6)):c("",!0)]),_:2},1024)],42,Ne))),128))])],40,Re))),128))])):c("",!0)])])):c("",!0)]),_:1})],2)):c("",!0),p.value&&d.value&&!T.value?(o(),l("div",ze,[x.value.length?(o(),ce(G(Ce.DayPilotCalendar),{key:0,config:R.value,events:x.value,ref:"calendarRef"},{event:w(({event:s})=>[a("div",{class:"event",onClick:r=>V(s.data)},[a("div",Ve,[a("div",He,[a("div",Pe,[a("p",null,u(s.data.start_time)+" - "+u(s.data.end_time),1),a("p",null,u(s.data.student_name),1)]),s.data.break&&s.data.break.duration?(o(),l("div",Ue,u(s.data.break.duration),1)):c("",!0)])])],8,Fe)]),_:1},8,["config","events"])):c("",!0)])):c("",!0),d.value?c("",!0):(o(),l("div",je,e[2]||(e[2]=[a("div",{class:"loader"},null,-1)])))])]))]),k(Te),k(Me,{ref_key:"modalsContainer",ref:q},null,512)])}}};export{_t as default};

import{r as m,u as te,o as ae,a as l,b as k,d as t,e as P,F as w,f as h,g as u,m as se,w as C,l as ne,i as o,t as i,j as oe,p as le,T as re,k as de,h as ie}from"./index-CAzfu9s5.js";import{c as E,d as ce,f as _e,_ as ue,a as me,b as ve,v as ke,t as ye}from"./v-header-Di5yUs8e.js";import{u as fe,_ as U,a as pe,b as ge,c as we}from"./v-modals-container-BjdnUCfW.js";import{d as he}from"./daypilot-vue.min-JWEU1-IW.js";const be={class:"wrapper"},De={key:0,class:"v-calendar-week"},$e={class:"v-calendar-week__container container"},Se={key:0,class:"v-calendar-week__content scroll-container"},Te={key:0,class:"v-calendar-week__table calendar"},Me={class:"calendar-header"},Ce={key:0,class:"calendar-row"},Ee=["onDrop"],Le={class:"calendar-row__item-content calendar-card"},Ie=["onClick","onDragstart"],xe={key:0,class:"calendar-card__break"},We={key:1,class:"v-calendar-week__break scroll-container"},Be=["onClick"],Oe={class:"event-header"},Re={class:"calendar-card__content"},qe={class:"calendar-card__lesson"},Fe={key:0,class:"calendar-card__break"},Ne={key:2,class:"loader-container"},ze={key:1,class:"v-calendar-week-mob mob-page"},He={class:"v-calendar-week-mob__container container"},Ve={key:0,class:"v-calendar-week-mob__list"},Pe={key:0,class:"day"},Ue=["onClick"],je={class:"day__date"},Ge={key:0},Ae={class:"day__lesson"},Je={class:"day__lesson-time"},Ke={class:"day__lesson-name"},Qe={key:0,class:"day__lesson break"},Xe={class:"day__lesson-block"},Ye={class:"day__lesson-time"},Ze=10,j=90,ot={__name:"v-calendar-week",setup(et){const{isMobile:G}=fe(),p=m({}),A=de(),L=ne(),y=m(localStorage.getItem("breakMode")==="true"),b=m();m(new Date);const I=m(L.query.start_date||"01.12.2025"),x=m({viewType:"Week",startDate:E(I.value),allowEventOverlap:!1,eventResizeHandling:"Disabled",timeRangeSelectedHandling:"Disabled",locale:"ru-RU",headerDateFormat:"ddd, d",touch:!0,weekStarts:1,onEventMoved:a=>{console.log("Event moved",a);const e=a.newStart.value,d=a.newStart.value,r=new Date(e).getDay(),s={start_time:e,end_time:d,day_of_week:r},_=a.e.data.lesson_id;console.log(s,_)},onEventResized:a=>{console.log("Event resized")}}),W=async a=>{const e=[];if(a)for(let d in a.week.days)a.week.days[d].lessons.forEach(n=>{const{start_time:r,end_time:s,..._}=n,f=`${a.week.days[d].day} ${r}`.replace(/(\d{2})\.(\d{2})\.(\d{4})/,"$3-$2-$1T").replace(" ",""),M=`${a.week.days[d].day} ${s}`.replace(/(\d{2})\.(\d{2})\.(\d{4})/,"$3-$2-$1T").replace(" ","");e.push({start:f,end:M,start_time:s.slice(0,5),end_time:s.slice(0,5),..._})});b.value=e},S=m({0:{day_of_week:"пн",date:""},1:{day_of_week:"вт",date:""},2:{day_of_week:"ср",date:""},3:{day_of_week:"чт",date:""},4:{day_of_week:"пт",date:""},5:{day_of_week:"сб",date:""},6:{day_of_week:"вс",date:""}}),B=te("modalsContainer"),c=m(),O=m({}),T=m({lesson:null,fromColumnIndex:null,fromLessonIndex:null}),J=(a,e,d,n)=>{T.value={lesson:e,fromColumnIndex:d,fromLessonIndex:n}},R=a=>a.slice(0,5),K=(a,e)=>{const{lesson:d,fromColumnIndex:n,fromLessonIndex:r}=T.value;if(n!==e){const s=c.value.week.days[n].lessons,_=c.value.week.days[e].lessons,f=S.value[e].date.toISOString().split("T")[0],M={day_of_week_id:parseInt(e),start_time:d.start_time,end_time:d.end_time,conducted_date:f},g=v=>{const[$,V]=v.split(":").map(Number);return $*60+V},z=g(d.start_time),ee=g(d.end_time);for(let v of _){const $=g(v.start_time);if(!(g(v.end_time)<=z||$>=ee)){alert("В этот день уже есть занятие на данное время");return}}let H=_.length;for(let v=0;v<_.length;v++)if(g(_[v].start_time)>z){H=v;break}s.splice(r,1),_.splice(H,0,d),ye(d.lesson_id,M).then(()=>{console.log("Перенос осуществлен")})}T.value={lesson:null,fromColumnIndex:null,fromLessonIndex:null}},q=()=>{y.value=!y.value,localStorage.setItem("breakMode",y.value),D(),y.value?W():b.value=[]},Q=()=>{D()},X=a=>{if(!(a in p.value)){p.value[a]=!0;return}p.value[a]=!p.value[a]},F=a=>{B.value.toggleLessonModals("buttons",a)},Y=a=>Math.max(j,j*a),N=a=>{A.push({query:{start_date:a}}).then(()=>{D()})},Z=a=>{const[e,d,n]=a.split(".").map(Number);let r=new Date(n,d-1,e);return r=r.getDay()||7,S.value[r-1].date=new Date(n,d-1,e),`${S.value[r-1].day_of_week}, ${e}`},D=()=>{const a=L.query;if("start_date"in a)I.value=E(a.start_date),x.value.startDate=E(a.start_date),ce(a.start_date).then(e=>{W(e),O.value=e,c.value=e});else{const e=new Date;window.location.search=`?start_date=${_e(e)}`}console.log(O.value)};return ae(()=>{D()}),(a,e)=>{const d=ie("router-link");return o(),l("div",be,[k(ue),t("main",null,[P(G)?(o(),l("section",ze,[t("div",He,[k(U,{"is-showed-break":!0,type:"week",onSetWeek:N,onToggleBreakMode:q}),c.value&&c.value.week?(o(),l("ul",Ve,[(o(!0),l(w,null,h(c.value.week.days,(n,r)=>(o(),l("li",{key:r,class:"v-calendar-week-mob__list-item"},[n?(o(),l("div",Pe,[t("div",{class:"day__header",onClick:s=>X(r)},[t("p",je,i(n.day),1),e[2]||(e[2]=t("img",{src:me,class:"day-el",alt:""},null,-1)),e[3]||(e[3]=t("img",{src:ve,class:"night-el",alt:""},null,-1))],8,Ue),k(re,{name:"fade"},{default:C(()=>[p.value[r]?(o(),l("div",Ge,[k(d,{to:{name:"calendar-day",query:{date:n.day}}},{default:C(()=>[(o(!0),l(w,null,h(n.lessons,(s,_)=>(o(),l("div",{class:"day__content",key:s.id},[t("div",Ae,[t("div",Je,[e[4]||(e[4]=t("div",{class:"day__lesson-circle"},null,-1)),t("p",null,i(s.start_time),1),e[5]||(e[5]=t("p",null,"-",-1)),t("p",null,i(s.end_time),1)]),t("div",Ke,i(s.student_name),1)]),s.breaks?(o(),l("div",Qe,[t("div",Xe,[e[7]||(e[7]=t("img",{src:pe,class:"day-el",alt:""},null,-1)),e[8]||(e[8]=t("img",{src:ge,class:"night-el",alt:""},null,-1)),t("div",Ye,[t("p",null,i(s.breaks.start_time),1),e[6]||(e[6]=t("p",null,"-",-1)),t("p",null,i(s.breaks.end_time),1)])]),e[9]||(e[9]=t("div",{class:"day__lesson-name"},"Перерыв",-1))])):u("",!0)]))),128))]),_:2},1032,["to"])])):u("",!0)]),_:2},1024)])):u("",!0)]))),128))])):u("",!0)])])):(o(),l("section",De,[t("div",$e,[k(U,{"is-showed-break":!0,type:"week",onSetWeek:N,onPaginateWeek:Q,onToggleBreakMode:q}),!y.value&&c.value?(o(),l("div",Se,[c.value?(o(),l("table",Te,[t("thead",null,[t("tr",Me,[(o(!0),l(w,null,h(c.value.week.days,(n,r)=>(o(),l("th",{class:"calendar-header__item",key:r},i(Z(n.day)),1))),128))])]),t("tbody",null,[c.value&&c.value.week?(o(),l("tr",Ce,[(o(!0),l(w,null,h(c.value.week.days,(n,r)=>(o(),l("td",{key:r,class:"calendar-row__item",onDragover:e[0]||(e[0]=oe(()=>{},["prevent"])),onDrop:s=>K(s,r)},[t("div",Le,[(o(!0),l(w,null,h(n.lessons,(s,_)=>(o(),l("div",{class:"calendar-card__content",key:s.lesson_id,onClick:f=>F(s),draggable:"true",onDragstart:f=>J(f,s,r,_)},[t("div",{class:"calendar-card__lesson",style:le({height:Y(s.duration),gap:`${Ze*s.duration}px`})},[t("p",null,i(R(s.start_time))+" - "+i(R(s.end_time)),1),t("p",null,i(s.student_name),1)],4),s.break&&s.break.duration?(o(),l("div",xe,i(s.break.duration),1)):u("",!0)],40,Ie))),128))])],40,Ee))),128))])):u("",!0)])])):u("",!0)])):u("",!0),y.value&&c.value?(o(),l("div",We,[b.value.length?(o(),se(P(he.DayPilotCalendar),{key:0,config:x.value,events:b.value,ref:"calendarRef"},{event:C(({event:n})=>[t("div",{class:"event",onClick:r=>F(n.data)},[t("div",Oe,[t("div",Re,[t("div",qe,[t("p",null,i(n.data.start_time)+" - "+i(n.data.end_time),1),t("p",null,i(n.data.student_name),1)]),n.data.break&&n.data.break.duration?(o(),l("div",Fe,i(n.data.break.duration),1)):u("",!0)])])],8,Be)]),_:1},8,["config","events"])):u("",!0)])):u("",!0),c.value?u("",!0):(o(),l("div",Ne,e[1]||(e[1]=[t("div",{class:"loader"},null,-1)])))])]))]),k(ke),k(we,{ref_key:"modalsContainer",ref:B},null,512)])}}};export{ot as default};

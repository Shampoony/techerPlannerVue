import{r as k,u as le,c as re,o as de,a as l,b as v,d as a,e as A,f as c,n as W,w as p,T as I,m as ie,F as h,g as b,l as ce,h as ue,i as o,t as u,j as _e,p as ve,q as me,k as ke}from"./index-D_rhgoPn.js";import{f as ye,c as B,t as J,d as fe,e as pe,h as ge,_ as we,a as he,b as be,v as De}from"./v-header-nTjlccc4.js";import{u as Te,_ as K,a as Se,b as $e,c as xe}from"./v-modals-container-gQVqI9yj.js";import{d as Me}from"./daypilot-vue.min-CCORk1S1.js";const Ce={class:"wrapper"},Ee={key:0,class:"v-calendar-week"},Le={class:"v-calendar-week__container container"},We={key:0,class:"sec-hidden-content showing"},Ie={key:0,class:"v-calendar-week__table calendar"},Be={class:"calendar-header"},qe=["onDrop"],Oe={class:"calendar-row__item-content calendar-card"},Re=["onClick","onDragstart"],Ne={key:2,class:"v-calendar-week__break scroll-container"},ze=["onClick"],Fe={class:"event-header"},Pe={class:"calendar-card__content"},Ve={class:"calendar-card__lesson"},He={key:0,class:"calendar-card__break"},Ue={key:3,class:"loader-container"},je={key:1,class:"v-calendar-week-mob mob-page"},Ge={class:"v-calendar-week-mob__container container"},Ae={key:0,class:"v-calendar-week-mob__list"},Je={key:0,class:"day"},Ke=["onClick"],Qe={class:"day__date"},Xe={key:0},Ye={class:"day__lesson"},Ze={class:"day__lesson-time"},et={class:"day__lesson-name"},tt={key:0,class:"day__lesson break"},at={class:"day__lesson-block"},st={class:"day__lesson-time"},nt={key:0,class:"title pb-4"},ot=10,Q=90,ut={__name:"v-calendar-week",setup(lt){const{isMobile:X}=Te(),y=k({}),Y=ke(),q=ce(),g=k(localStorage.getItem("breakMode")==="true"),$=k(),x=k(ye(new Date)),O=k(q.query.start_date||"01.12.2025"),R=k({viewType:"Week",cellDuration:15,startDate:B(O.value),allowEventOverlap:!1,eventResizeHandling:"Disabled",timeRangeSelectedHandling:"Disabled",locale:"ru-RU",headerDateFormat:"ddd, d",touch:!0,weekStarts:1,onEventMoved:t=>{console.log("Event moved",t);const e=t.newStart.value.split("T")[1],i=t.newStart.value.split("T")[1],s=t.e.data.start.value.split("T")[0],n={day_of_week_id:new Date(t.newStart.value).getDay(),start_time:e,end_time:i,conducted_date:s},_=t.e.data.id;J(_,n).then(()=>{console.log("Выполнили запрос")})},onEventResized:t=>{console.log("Event resized")}}),M=async t=>{const e=[];if(t)for(let i in t.week.days)t.week.days[i].lessons.forEach(s=>{const{start_time:d,end_time:n,..._}=s,f=`${t.week.days[i].day} ${d}`.replace(/(\d{2})\.(\d{2})\.(\d{4})/,"$3-$2-$1T").replace(" ",""),T=`${t.week.days[i].day} ${n}`.replace(/(\d{2})\.(\d{2})\.(\d{4})/,"$3-$2-$1T").replace(" ","");e.push({id:s.id,start:f,end:T,start_time:d.slice(0,5),end_time:n.slice(0,5),..._})});console.log(e),$.value=e},C=k({0:{day_of_week:"пн",date:""},1:{day_of_week:"вт",date:""},2:{day_of_week:"ср",date:""},3:{day_of_week:"чт",date:""},4:{day_of_week:"пт",date:""},5:{day_of_week:"сб",date:""},6:{day_of_week:"вс",date:""}}),N=le("modalsContainer"),r=k(),E=k({lesson:null,fromColumnIndex:null,fromLessonIndex:null}),Z=(t,e,i,s)=>{E.value={lesson:e,fromColumnIndex:i,fromLessonIndex:s}},z=t=>t.slice(0,5),ee=(t,e)=>{const{lesson:i,fromColumnIndex:s,fromLessonIndex:d}=E.value;if(s!==e){const n=r.value.week.days[s].lessons,_=r.value.week.days[e].lessons,f=C.value[e].date.toISOString().split("T")[0],T={day_of_week_id:parseInt(e),start_time:i.start_time,end_time:i.end_time,conducted_date:f},w=m=>{const[S,G]=m.split(":").map(Number);return S*60+G},U=w(i.start_time),oe=w(i.end_time);for(let m of _){const S=w(m.start_time);if(!(w(m.end_time)<=U||S>=oe)){alert("В этот день уже есть занятие на данное время");return}}let j=_.length;for(let m=0;m<_.length;m++)if(w(_[m].start_time)>U){j=m;break}n.splice(d,1),_.splice(j,0,i),console.log(T),J(i.lesson_id,T).then(()=>{console.log("Перенос осуществлен")})}E.value={lesson:null,fromColumnIndex:null,fromLessonIndex:null}},te=t=>t===x.value,F=()=>{g.value=!g.value,localStorage.setItem("breakMode",g.value),console.log(r.value),M(r.value)},P=()=>{console.log("Зашли"),L()},ae=(t,e)=>{if(e==x.value){y.value[t]=!1,x.value="";return}if(!(t in y.value)){y.value[t]=!0;return}y.value[t]=!y.value[t]},V=t=>{N.value.toggleLessonModals("buttons",t)},se=t=>Math.max(Q,Q*t),H=t=>{Y.push({query:{start_date:t}}).then(()=>{L()})},ne=t=>{const[e,i,s]=t.split(".").map(Number);let d=new Date(s,i-1,e);return d=d.getDay()||7,C.value[d-1].date=new Date(s,i-1,e),`${C.value[d-1].day_of_week}, ${e}`},L=async()=>{const t=q.query;if("start_date"in t){O.value=B(t.start_date),R.value.startDate=B(t.start_date);const e=await fe(t.start_date);M(e),r.value=e}else{const e=pe(new Date);window.location.search=`?start_date=${ge(e)}`}},D=re(()=>{if(r.value&&r.value.week.days){for(let t in r.value.week.days){const e=r.value.week.days[t];if(e.lessons&&e.lessons.length)return!1}return!0}return!1});return de(()=>{L().then(()=>{M(r.value)})}),(t,e)=>{const i=ue("router-link");return o(),l("div",Ce,[v(we),a("main",null,[A(X)?(o(),l("section",je,[v(i,{to:{name:"calendar-day",query:{date:"06.02.2025"}}},{default:p(()=>e[3]||(e[3]=[me(" день ")])),_:1}),a("div",Ge,[v(K,{"is-showed-break":!0,type:"week",onSetWeek:H,onPaginateWeek:P,onToggleBreakMode:F}),r.value&&r.value.week?(o(),l("ul",Ae,[(o(!0),l(h,null,b(r.value.week.days,(s,d)=>(o(),l("li",{key:d,class:"v-calendar-week-mob__list-item"},[s?(o(),l("div",Je,[a("div",{class:"day__header",onClick:n=>ae(d,s.day)},[a("p",Qe,u(s.day),1),e[4]||(e[4]=a("img",{src:he,class:"day-el",alt:""},null,-1)),e[5]||(e[5]=a("img",{src:be,class:"night-el",alt:""},null,-1))],8,Ke),v(I,{name:"fade"},{default:p(()=>[y.value[d]||te(s.day)?(o(),l("div",Xe,[v(i,{to:{name:"calendar-day",query:{date:s.day}}},{default:p(()=>[(o(!0),l(h,null,b(s.lessons,(n,_)=>(o(),l("div",{class:"day__content",key:n.id},[a("div",Ye,[a("div",Ze,[e[6]||(e[6]=a("div",{class:"day__lesson-circle"},null,-1)),a("p",null,u(n.start_time),1),e[7]||(e[7]=a("p",null,"-",-1)),a("p",null,u(n.end_time),1)]),a("div",et,u(n.student_name),1)]),n.breaks?(o(),l("div",tt,[a("div",at,[e[9]||(e[9]=a("img",{src:Se,class:"day-el",alt:""},null,-1)),e[10]||(e[10]=a("img",{src:$e,class:"night-el",alt:""},null,-1)),a("div",st,[a("p",null,u(n.breaks.start_time),1),e[8]||(e[8]=a("p",null,"-",-1)),a("p",null,u(n.breaks.end_time),1)])]),e[11]||(e[11]=a("div",{class:"day__lesson-name"},"Перерыв",-1))])):c("",!0)]))),128))]),_:2},1032,["to"]),s.lessons.length?c("",!0):(o(),l("div",nt," В этот день у вас нет уроков! "))])):c("",!0)]),_:2},1024)])):c("",!0)]))),128))])):c("",!0)])])):(o(),l("section",Ee,[a("div",Le,[v(K,{"is-showed-break":!0,type:"week",onSetWeek:H,onPaginateWeek:P,onToggleBreakMode:F}),D.value?(o(),l("div",We,e[1]||(e[1]=[a("h1",{class:"text-title text-blue"},"Еще не запланировано ни одного занятия!",-1)]))):c("",!0),!g.value&&r.value||D.value?(o(),l("div",{key:1,class:W(["v-calendar-week__content scroll-container",{blur:D.value}])},[v(I,{name:"fade"},{default:p(()=>[r.value?(o(),l("table",Ie,[a("thead",null,[a("tr",Be,[(o(!0),l(h,null,b(r.value.week.days,(s,d)=>(o(),l("th",{class:"calendar-header__item",key:d},u(ne(s.day)),1))),128))])]),a("tbody",null,[r.value&&r.value.week?(o(),l("tr",{class:"calendar-row",key:r.value.week.start_date},[(o(!0),l(h,null,b(r.value.week.days,(s,d)=>(o(),l("td",{key:d,class:"calendar-row__item",onDragover:e[0]||(e[0]=_e(()=>{},["prevent"])),onDrop:n=>ee(n,d)},[a("div",Oe,[(o(!0),l(h,null,b(s.lessons,(n,_)=>(o(),l("div",{class:W(["calendar-card__content",{completed:n.completed}]),key:n.lesson_id,onClick:f=>V(n),draggable:"true",onDragstart:f=>Z(f,n,d,_)},[v(I,{name:"flip"},{default:p(()=>[n?(o(),l("div",{key:0,class:W(["calendar-card__lesson",{trial:n.trial}]),style:ve({height:se(n.duration),gap:`${ot*n.duration}px`})},[a("p",null,u(z(n.start_time))+" - "+u(z(n.end_time)),1),a("p",null,u(n.student_name),1)],6)):c("",!0)]),_:2},1024)],42,Re))),128))])],40,qe))),128))])):c("",!0)])])):c("",!0)]),_:1})],2)):c("",!0),g.value&&r.value&&!D.value?(o(),l("div",Ne,[$.value.length?(o(),ie(A(Me.DayPilotCalendar),{key:0,config:R.value,events:$.value,ref:"calendarRef"},{event:p(({event:s})=>[a("div",{class:"event",onClick:d=>V(s.data)},[a("div",Fe,[a("div",Pe,[a("div",Ve,[a("p",null,u(s.data.start_time)+" - "+u(s.data.end_time),1),a("p",null,u(s.data.student_name),1)]),s.data.break&&s.data.break.duration?(o(),l("div",He,u(s.data.break.duration),1)):c("",!0)])])],8,ze)]),_:1},8,["config","events"])):c("",!0)])):c("",!0),r.value?c("",!0):(o(),l("div",Ue,e[2]||(e[2]=[a("div",{class:"loader"},null,-1)])))])]))]),v(De),v(xe,{ref_key:"modalsContainer",ref:N},null,512)])}}};export{ut as default};

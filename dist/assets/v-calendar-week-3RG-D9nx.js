import{r as m,u as _e,l as ve,o as me,c as r,d as k,b as a,m as J,v as K,g as M,h as c,n as h,w as b,T as F,f as ke,F as D,p as S,i as ye,k as l,t as u,q as pe,s as fe,j as ge,x as we}from"./index-CZHak2PW.js";import{f as he,t as R,h as Q,i as be,j as De,k as Se,b as $e,_ as Te,a as Le,l as Me,v as xe,e as Ce}from"./v-modals-container-CmeDGtnj.js";import{_ as X,a as Ee,b as We}from"./v-calendar-menu-B6FcLM-I.js";import{u as Ie}from"./useIsMobile-DwS4u68s.js";import{d as Be}from"./daypilot-vue.min-D9Yf7zC3.js";const Fe={class:"wrapper"},Re={class:"v-calendar-week"},qe={class:"v-calendar-week__container container"},Ne={key:0,class:"sec-hidden-content showing"},Oe={key:0,class:"v-calendar-week__table calendar"},ze={class:"calendar-header"},Pe=["onDrop"],He={class:"calendar-row__item-content calendar-card"},Ve=["onClick","onDragstart"],je={class:"v-calendar-week__break scroll-container"},Ue=["onClick"],Ge={class:"event-header"},Ye={class:"calendar-card__content"},Ae={key:0,class:"calendar-card__break"},Je={key:2,class:"loader-container"},Ke={key:0,class:"v-calendar-week-mob mob-page"},Qe={class:"v-calendar-week-mob__container container"},Xe={key:0,class:"v-calendar-week-mob__list"},Ze={key:0,class:"day"},et=["onClick"],tt={class:"day__date"},at={key:0},st={class:"day__lesson"},nt={class:"day__lesson-name"},ot={key:0,class:"day__lesson break"},lt={class:"day__lesson-block"},rt={class:"day__lesson-time"},dt={key:0,class:"title pb-4"},it=10,Z=90,yt={__name:"v-calendar-week",setup(ct){const{isMobile:q}=Ie(),p=m({}),ee=ge(),N=ye(),f=m(localStorage.getItem("breakMode")==="true"),x=m(),C=m(he(new Date)),O=m(N.query.start_date||"01.12.2025"),z=_e("modalsContainer"),o=m(),E=m({lesson:null,fromColumnIndex:null,fromLessonIndex:null}),P=m({viewType:"Week",cellDuration:15,startDate:R(O.value),allowEventOverlap:!1,eventResizeHandling:"Disabled",timeRangeSelectedHandling:"Disabled",locale:"ru-RU",headerDateFormat:"ddd, d",showNowLine:!0,nowLineColor:"#FF0000",nowLineWidth:2,touch:!0,weekStarts:1,onEventMoved:t=>{const e=t.newStart.value.split("T")[1],i=t.newEnd.value.split("T")[1],n=t.e.data.start.value.split("T")[0],d=new Date(t.newStart.value).getDay();console.log(d||7),t.e.data.start_time=e.slice(0,5),t.e.data.end_time=i.slice(0,5);const s={day_of_week_id:d||7,start_time:e,end_time:i,conducted_date:n,in_rule:!1},_=t.e.data.lesson_id;Q(_,s).then(()=>{console.log("Выполнили запрос")})},onEventResized:t=>{console.log("Event resized")}}),W=async t=>{const e=[];if(t)for(let i in t.week.days)t.week.days[i].lessons.forEach(n=>{const{start_time:d,end_time:s,..._}=n,y=`${t.week.days[i].day} ${d}`.replace(/(\d{2})\.(\d{2})\.(\d{4})/,"$3-$2-$1T").replace(" ",""),B=`${t.week.days[i].day} ${s}`.replace(/(\d{2})\.(\d{2})\.(\d{4})/,"$3-$2-$1T").replace(" ","");e.push({start:y,end:B,start_time:d.slice(0,5),end_time:s.slice(0,5),..._})});console.log(e),x.value=e},$=m({1:{day_of_week:"пн",date:""},2:{day_of_week:"вт",date:""},3:{day_of_week:"ср",date:""},4:{day_of_week:"чт",date:""},5:{day_of_week:"пт",date:""},6:{day_of_week:"сб",date:""},7:{day_of_week:"вс",date:""}}),te=(t,e,i,n)=>{E.value={lesson:e,fromColumnIndex:i,fromLessonIndex:n}},g=t=>t.slice(0,5),ae=(t,e)=>{const{lesson:i,fromColumnIndex:n,fromLessonIndex:d}=E.value;if(n!==e){const s=o.value.week.days[n].lessons,_=o.value.week.days[e].lessons;console.log($.value);const y=$.value[e].date,B=y.getFullYear(),re=String(y.getMonth()+1).padStart(2,"0"),de=String(y.getDate()).padStart(2,"0"),ie=`${B}-${re}-${de}`,ce={day_of_week_id:parseInt(e),start_time:i.start_time,end_time:i.end_time,conducted_date:ie,in_rule:!1},w=v=>{const[L,A]=v.split(":").map(Number);return L*60+A},G=w(i.start_time),ue=w(i.end_time);for(let v of _){const L=w(v.start_time);if(!(w(v.end_time)<=G||L>=ue)){alert("В этот день уже есть занятие на данное время");return}}let Y=_.length;for(let v=0;v<_.length;v++)if(w(_[v].start_time)>G){Y=v;break}s.splice(d,1),_.splice(Y,0,i),Q(i.lesson_id,ce).then(()=>{console.log("Перенос осуществлен")})}E.value={lesson:null,fromColumnIndex:null,fromLessonIndex:null}},se=t=>t===C.value,H=()=>{f.value=!f.value,localStorage.setItem("breakMode",f.value),console.log(o.value),W(o.value)},V=()=>{I()},ne=(t,e)=>{if(e==C.value){p.value[t]=!1,C.value="";return}if(!(t in p.value)){p.value[t]=!0;return}p.value[t]=!p.value[t]},j=t=>{z.value.toggleLessonModals("buttons",t)},oe=t=>Math.max(Z,Z*t),U=t=>{ee.push({query:{start_date:t}}).then(()=>{I()})},le=t=>{const[e,i,n]=t.split(".").map(Number);let d=new Date(n,i-1,e);return d=d.getDay()||7,$.value[d].date=new Date(n,i-1,e),`${$.value[d].day_of_week}, ${e}`},I=async()=>{const t=N.query;if("start_date"in t){O.value=R(t.start_date),P.value.startDate=R(t.start_date);const e=await be(t.start_date);W(e),o.value=e}else{const e=De(new Date);window.location.search=`?start_date=${Se(e)}`}},T=ve(()=>{if(o.value&&o.value.week.days){for(let t in o.value.week.days){const e=o.value.week.days[t];if(e.lessons&&e.lessons.length)return!1}return!0}return!1});return me(()=>{localStorage.removeItem("upd"),I().then(()=>{W(o.value)})}),(t,e)=>{const i=we("router-link");return l(),r("div",Fe,[k($e),a("main",null,[J(a("section",Re,[a("div",qe,[k(X,{"is-showed-break":!0,type:"week",onSetWeek:U,onPaginateWeek:V,onToggleBreakMode:H}),T.value?(l(),r("div",Ne,e[1]||(e[1]=[a("h1",{class:"text-title text-blue"},"Еще не запланировано ни одного занятия!",-1)]))):c("",!0),!f.value&&o.value||T.value?(l(),r("div",{key:1,class:h(["v-calendar-week__content scroll-container",{blur:T.value}])},[k(F,{name:"fade"},{default:b(()=>[o.value?(l(),r("table",Oe,[a("thead",null,[a("tr",ze,[(l(!0),r(D,null,S(o.value.week.days,(n,d)=>(l(),r("th",{class:"calendar-header__item",key:d},u(le(n.day)),1))),128))])]),a("tbody",null,[o.value&&o.value.week?(l(),r("tr",{class:"calendar-row",key:o.value.week.start_date},[(l(!0),r(D,null,S(o.value.week.days,(n,d)=>(l(),r("td",{key:d,class:"calendar-row__item",onDragover:e[0]||(e[0]=pe(()=>{},["prevent"])),onDrop:s=>ae(s,d)},[a("div",He,[(l(!0),r(D,null,S(n.lessons,(s,_)=>(l(),r("div",{class:h(["calendar-card__content",{completed:s.completed}]),key:s.lesson_id,onClick:y=>j(s),draggable:"true",onDragstart:y=>te(y,s,d,_)},[k(F,{name:"flip"},{default:b(()=>[s?(l(),r("div",{key:0,class:h(["calendar-card__lesson",{trial:s.trial}]),style:fe({height:oe(s.duration),gap:`${it*s.duration}px`})},[a("p",null,u(g(s.start_time))+" - "+u(g(s.end_time)),1),a("p",null,u(s.student_name),1)],6)):c("",!0)]),_:2},1024)],42,Ve))),128))])],40,Pe))),128))])):c("",!0)])])):c("",!0)]),_:1})],2)):c("",!0),J(a("div",je,[x.value?(l(),ke(M(Be.DayPilotCalendar),{key:0,config:P.value,events:x.value,ref:"calendarRef"},{event:b(({event:n})=>[a("div",{class:"event",onClick:d=>j(n.data)},[a("div",Ge,[a("div",Ye,[a("div",{class:h(["calendar-card__lesson",{trial:n.data.trial}])},[a("p",null,u(n.data.start_time)+" - "+u(n.data.end_time),1),a("p",null,u(n.data.student_name),1)],2),n.data.break&&n.data.break.duration?(l(),r("div",Ae,u(n.data.break.duration),1)):c("",!0)])])],8,Ue)]),_:1},8,["config","events"])):c("",!0)],512),[[K,f.value&&o.value&&!T.value]]),o.value?c("",!0):(l(),r("div",Je,e[2]||(e[2]=[a("div",{class:"loader"},null,-1)])))])],512),[[K,!M(q)]]),M(q)?(l(),r("section",Ke,[a("div",Qe,[k(X,{"is-showed-break":!0,type:"week",onSetWeek:U,onPaginateWeek:V,onToggleBreakMode:H}),o.value&&o.value.week?(l(),r("ul",Xe,[(l(!0),r(D,null,S(o.value.week.days,(n,d)=>(l(),r("li",{key:d,class:"v-calendar-week-mob__list-item"},[n?(l(),r("div",Ze,[a("div",{class:"day__header",onClick:s=>ne(d,n.day)},[a("p",tt,u(n.day),1),e[3]||(e[3]=a("img",{src:Te,class:"day-el",alt:""},null,-1)),e[4]||(e[4]=a("img",{src:Le,class:"night-el",alt:""},null,-1))],8,et),k(F,{name:"fade"},{default:b(()=>[p.value[d]||se(n.day)?(l(),r("div",at,[k(i,{to:{name:"calendar-day",query:{date:n.day}}},{default:b(()=>[(l(!0),r(D,null,S(n.lessons,(s,_)=>(l(),r("div",{class:"day__content",key:s.id},[a("div",st,[a("div",{class:h(["day__lesson-time",{trial:s.trial}])},[e[5]||(e[5]=a("div",{class:"day__lesson-circle"},null,-1)),a("p",null,u(g(s.start_time)),1),e[6]||(e[6]=a("p",null,"-",-1)),a("p",null,u(g(s.end_time)),1)],2),a("div",nt,u(s.student_name),1)]),o.value.breaks&&o.value.breaks[s.lesson_id]&&o.value.breaks[s.lesson_id].start_time!==o.value.breaks[s.lesson_id].end_time?(l(),r("div",ot,[a("div",lt,[e[8]||(e[8]=a("img",{src:Ee,class:"day-el",alt:""},null,-1)),e[9]||(e[9]=a("img",{src:We,class:"night-el",alt:""},null,-1)),a("div",rt,[a("p",null,u(g(s.start_time)),1),e[7]||(e[7]=a("p",null,"-",-1)),a("p",null,u(M(Me)(s.start_time,o.value.breaks[s.lesson_id].duration)),1)])]),e[10]||(e[10]=a("div",{class:"day__lesson-name"},"Перерыв",-1))])):c("",!0)]))),128))]),_:2},1032,["to"]),n.lessons.length?c("",!0):(l(),r("div",dt," В этот день у вас нет уроков! "))])):c("",!0)]),_:2},1024)])):c("",!0)]))),128))])):c("",!0)])])):c("",!0)]),k(xe),k(Ce,{ref_key:"modalsContainer",ref:z},null,512)])}}};export{yt as default};

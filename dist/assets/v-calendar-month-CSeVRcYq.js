import{r as p,u as Q,l as I,o as X,c as a,d as g,b as t,g as ee,h as y,n as b,F as m,p as h,w as te,x as se,k as n,t as i,q as ae,j as ne,i as le}from"./index-D4B2iUaK.js";import{m as B,b as oe,_ as re,a as de,e as ie,v as ce,h as _e}from"./v-modals-container-DJq70_vU.js";import{_ as R,a as ue,b as ve}from"./v-calendar-menu-DPjBH6Pt.js";import{u as me}from"./useIsMobile-ClIXufby.js";const he={class:"wrapper"},ye={key:0,class:"v-calendar-month"},pe={class:"v-calendar-month__container container"},ke={key:0,class:"v-calendar-month__content scroll-container"},fe={key:0,class:"sec-hidden-content showing"},ge={class:"calendar-header"},be=["onDrop"],we={class:"calendar-row__item-container"},Se={key:0,class:"calendar-row__item-content calendar-card"},Me={class:"calendar-card__num"},Le=["onClick","onDragstart"],$e={key:0,class:"calendar-card__lesson break"},De={key:1,class:"loader-container"},Ce={key:1,class:"v-calendar-month-mob mob-page"},qe={class:"container"},Be={class:"v-calendar-month-mob__container"},Ee={class:"v-calendar-month-mob__table calendar"},Ne={class:"calendar-header"},Oe=["onClick"],Fe={key:0,class:"calendar-row__item-content calendar-card"},Pe={class:"calendar-card__num"},Ie={class:"calendar-card__content"},Re={key:0,class:"calendar-card__lesson break"},Ve={key:0,class:"v-calendar-month-mob__info lesson-info"},je={class:"v-calendar-month-mob__day day"},xe={class:"day__header"},Ae={class:"day__date"},Je={class:"day__lesson"},Te={class:"day__lesson-name"},Ye={key:0,class:"day__lesson break"},Ze={class:"day__lesson-block"},ze={class:"day__lesson-time"},Ue={key:0},Xe={__name:"v-calendar-month",setup(We){const D=p([{days_week:"Пн",id:1},{days_week:"Вт",id:2},{days_week:"Ср",id:3},{days_week:"Чт",id:4},{days_week:"Пт",id:5},{days_week:"Сб",id:6},{days_week:"Вс",id:7}]),E=p(new Date),w=p(E.value.getMonth()+1),S=p(E.value.getFullYear()),V=ne(),j=le(),o=p({}),u=p([]),C=p(),{isMobile:x}=me(),N=Q("modalsContainer"),O=l=>{const e=j.query.selected_date;return`${String(l).padStart(2,0)}.${e}`},A=(l,e)=>{u.value[0]=parseInt(l),u.value[1]=e,localStorage.setItem("activeDay",JSON.stringify(u.value))},J=(l,e,c,s,_)=>{C.value={lesson:e,fromColumnIndex:s,fromRowIndex:c,fromLessonIndex:_}},T=(l,e,c)=>{const{lesson:s,fromColumnIndex:_,fromRowIndex:d,fromLessonIndex:r}=C.value;if(_!==e||d!==c)if(!o.value.schedule[c][e])alert("Интерактивным способом вы можете переносить урок только в пределах месяца");else{const q=o.value.schedule[d][_].lessons,M=o.value.schedule[c][e].lessons,k=f=>{const[L,$]=f.split(":").map(Number);return L*60+$},U=k(s.start_time),W=k(s.end_time);for(let f of M){const L=k(f.start_time);if(!(k(f.end_time)<=U||L>=W)){alert("В этот день уже есть занятие на данное время");return}}q.splice(r,1),M.push(s),M.sort((f,L)=>{const $=k(f.start_time),K=k(L.start_time);return $-K});const G=String(o.value.schedule[c][e].day),H={day_of_week_id:e,start_time:s.start_time+":00.001Z",end_time:s.end_time+":00.001Z",conducted_date:`${S.value}-${w.value}-${G.padStart(2,0)}`,in_rule:!1};_e(s.lesson_id,H).then(()=>{}),C.value=null}},Y=l=>{N.value.toggleLessonModals("buttons",l)},Z=l=>{V.push({query:{selected_date:`${String(l.month+1).padStart(2,"0")}.${l.year}`}}),w.value=l.month,S.value=l.year,B(l.year,l.month+1).then(e=>{o.value=e})},F=l=>{B(l.year,l.month).then(e=>{o.value=e,u.value=[]})},z=()=>{const l=new URLSearchParams(window.location.search),e=Object.fromEntries(l.entries());"selected_date"in e?(w.value=e.selected_date.split(".")[0],S.value=e.selected_date.split(".")[1]):window.location.search=`?selected_date=${String(w.value).padStart(2,0)}.${S.value}`,B(S.value,parseInt(w.value)).then(c=>{o.value=c})},v=I(()=>{if(u.value.length&&o.value.schedule){const l=o.value.schedule[u.value[0]];if(l)return l[u.value[1]]}return null}),P=I(()=>{if(o.value&&o.value.schedule){for(let l in o.value.schedule){const e=o.value.schedule[l];for(let c in e)if(e[c].lessons.length)return!1}return!0}return!1});return X(()=>{z(),localStorage.setItem("upd",1),u.value=JSON.parse(localStorage.getItem("activeDay"))||[]}),(l,e)=>{const c=se("router-link");return n(),a("div",he,[g(oe),t("main",null,[ee(x)?(n(),a("section",Ce,[t("div",qe,[t("div",Be,[g(R,{type:"month",onPaginateMonth:F}),t("table",Ee,[t("thead",null,[t("tr",Ne,[(n(!0),a(m,null,h(D.value,s=>(n(),a("th",{class:"calendar-header__item",key:s.id},i(s.days_week),1))),128))])]),t("tbody",null,[(n(!0),a(m,null,h(o.value.schedule,(s,_)=>(n(),a("tr",{class:"calendar-row",key:_},[(n(),a(m,null,h(7,d=>t("td",{class:b(["calendar-row__item",{active:_==u.value[0]&&d==u.value[1]}]),onClick:r=>A(_,d),key:d},[s[d]?(n(),a("div",Fe,[t("div",Pe,i(s[d].day),1),t("div",Ie,[(n(!0),a(m,null,h(s[d].lessons,r=>(n(),a("div",{class:b(["calendar-card__lesson",{trial:r.trial}]),key:r.lesson_id},null,2))),128)),s[d].breaks&&s[d].breaks[l.lesson.lesson_id]?(n(),a("div",Re)):y("",!0)])])):y("",!0)],10,Oe)),64))]))),128))])])]),v.value?(n(),a("div",Ve,[g(c,{to:{name:"calendar-day",query:{date:O(v.value.day)}}},{default:te(()=>[t("div",je,[t("div",xe,[t("p",Ae,i(O(v.value.day)),1),e[3]||(e[3]=t("img",{src:re,class:"day-el",alt:""},null,-1)),e[4]||(e[4]=t("img",{src:de,class:"night-el",alt:""},null,-1))]),(n(!0),a(m,null,h(v.value.lessons,s=>(n(),a("div",{class:"day__content",key:s.id},[t("div",Je,[t("div",{class:b(["day__lesson-time",{trial:s.trial}])},[e[5]||(e[5]=t("div",{class:"day__lesson-circle"},null,-1)),t("p",null,i(s.start_time),1),e[6]||(e[6]=t("p",null,"-",-1)),t("p",null,i(s.end_time),1)],2),t("div",Te,i(s.student_name),1)]),v.value.breaks&&v.value.breaks[s.lesson_id]?(n(),a("div",Ye,[t("div",Ze,[e[8]||(e[8]=t("img",{src:ue,class:"day-el",alt:""},null,-1)),e[9]||(e[9]=t("img",{src:ve,class:"night-el",alt:""},null,-1)),t("div",ze,[t("p",null,i(v.value.breaks[s.lesson_id].start_time),1),e[7]||(e[7]=t("p",null,"-",-1)),t("p",null,i(v.value.breaks[s.lesson_id].end_time),1)])]),e[10]||(e[10]=t("div",{class:"day__lesson-name"},"Перерыв",-1))])):y("",!0)]))),128)),v.value.lessons.length?y("",!0):(n(),a("div",Ue,e[11]||(e[11]=[t("h2",{class:"title pb-7"},"В этот день у вас нет уроков",-1)])))])]),_:1},8,["to"])])):y("",!0)])])):(n(),a("section",ye,[t("div",pe,[g(R,{type:"month",onSetMonth:Z,onPaginateMonth:F}),o.value.schedule&&D.value?(n(),a("div",ke,[P.value?(n(),a("div",fe,e[1]||(e[1]=[t("h1",{class:"text-title text-blue"},"Еще не запланировано ни одного занятия!",-1)]))):y("",!0),t("table",{class:b(["v-calendar-month__table calendar",{blur:P.value}])},[t("thead",null,[t("tr",ge,[(n(!0),a(m,null,h(D.value,s=>(n(),a("th",{class:"calendar-header__item",key:s.id},i(s.days_week),1))),128))])]),t("tbody",null,[(n(!0),a(m,null,h(o.value.schedule,(s,_)=>(n(),a("tr",{class:"calendar-row",key:_},[(n(),a(m,null,h(7,d=>t("td",{class:"calendar-row__item",key:d,onDragover:e[0]||(e[0]=ae(()=>{},["prevent"])),onDrop:r=>T(r,d,_)},[t("div",we,[s[d]?(n(),a("div",Se,[t("div",Me,i(s[d].day),1),(n(!0),a(m,null,h(s[d].lessons,(r,q)=>(n(),a("div",{class:b(["calendar-card__content",{completed:r.completed}]),key:r.lesson_id,onClick:()=>Y(r),draggable:"true",onDragstart:M=>J(M,r,_,d,q)},[t("div",{class:b(["calendar-card__lesson",{trial:r.trial}])},i(r.start_time)+" - "+i(r.end_time)+" "+i(r.student_name),3),o.value.breaks&&o.value.breaks[r.lesson_id]&&o.value.breaks[r.lesson_id].start_time!==o.value.breaks[r.lesson_id].end_time?(n(),a("div",$e,i(o.value.breaks[r.lesson_id].start_time)+" - "+i(o.value.breaks[r.lesson_id].end_time)+" "+i(r.student_name),1)):y("",!0)],42,Le))),128))])):y("",!0)])],40,be)),64))]))),128))])],2)])):(n(),a("div",De,e[2]||(e[2]=[t("div",{class:"loader"},null,-1)])))])]))]),g(ie,{ref_key:"modalsContainer",ref:N},null,512),g(ce)])}}};export{Xe as default};
